<!-- HTML header for doxygen 1.8.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>Example Implementation of an MDL Browser</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="images/arcicon.ico" rel="shortcut icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_custom_stylesheet_1_8_4.css" rel="stylesheet" type="text/css"/>
<link rel='stylesheet' href='webfonts/librebaskerville/stylesheet.css' type='text/css'/>
<link rel='stylesheet' href='webfonts/sourcesanspro/stylesheet.css' type='text/css'/>
<!--ARC-->
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="blackheader">
<span id="blackheader_title">MDL SDK API</span>
<span>
<img src="images/nvidia_logo_transpbg.gif" alt="nvidia_logo_transpbg.gif" style=" height:1.25em; width:6.806em;"/></span>
<span id="blackheader_uplink">
<a href='../index.html' class='top_page_nav'>Up</a>
</span>
</div>
<!--
<div id="titlearea">
   <span id="projectname">
     <a id="titlelink" href="../../index.html">
       MDL SDK API
     </a>
   </span>
     <a id="projectlogo" href="http://www.nvidia-arc.com">
       <img alt="NVIDIA logo" src="images/nvidia_logo.png" style="height:2em;">
       </a>
     <a href='../index.html' class='top_page_nav'>Up</a>
</div>
-->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('mi_neuray_example_mdl_browser.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Example Implementation of an MDL Browser </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div align="right"> [<a class="el" href="mi_neuray_example_discovery.html">Previous</a>] [<a class="el" href="mi_neuray_examples.html">Up</a>] [<a class="el" href="mi_neuray_example_mdle.html">Next</a>] </div><p>This example demonstrates how a material selection dialogue that emphasizes the package and module structure could look like. The <a class="el" href="classmi_1_1neuraylib_1_1IMdl__discovery__api.html" title="Interface for the discovery API. ">mi::neuraylib::IMdl_discovery_api</a> is used to get a holistic view of the modules that are installed on the system, independent of the of individually configured search paths.</p>
<h1><a class="anchor" id="example_mdl_browser_new"></a>
New Topics</h1>
<ul>
<li>Caching of information on packages, modules, and materials</li>
<li>Illustration of how we believe MDL materials should be presented to the user</li>
</ul>
<h1><a class="anchor" id="example_mdl_browser_descr"></a>
Detailed Description</h1>
<dl>
<dt><b>Discovering modules and caching of information</b> </dt>
<dd><p class="startdd"><br/>
 When starting the application, the <a class="el" href="classmi_1_1neuraylib_1_1IMdl__discovery__api.html" title="Interface for the discovery API. ">mi::neuraylib::IMdl_discovery_api</a> is used the get the current package and module structure installed on the system. This includes the handling of admin and user space search paths as well as modules inside of MDL Archives. As demonstrated in the <a class="el" href="mi_neuray_example_discovery.html">Discovery Example</a>, this gives us a holistic tree of <a class="el" href="classmi_1_1neuraylib_1_1IMdl__info.html" title="Abstract interface for a discovery graph node. ">mi::neuraylib::IMdl_info</a> objects with basic information on the modules and packages, e.g., simple and qualified name, the search path they have been found in and whether a module is located in an MDL Archive or not. To get information on materials or functions that are exported by individual modules, we need to load the modules and iterate over the exported elements. Since that can take a lot of time for large material libraries or libraries that are for instance stored on network drives, we try to minimize the loading time by storing the gathered information in a persistent cache file that can be loaded much faster.</p>
<p>The MDL browser contains an example implementation of such a cache that follows the MDL API design. Like the result of the <a class="el" href="classmi_1_1neuraylib_1_1IMdl__discovery__api.html" title="Interface for the discovery API. ">mi::neuraylib::IMdl_discovery_api</a>, it is also organized in a tree structure with materials and functions as leaf nodes, while modules and packages are represented by inner nodes. Each node in the tree can save various information in form of key-value-pairs. This allows us to store names, authors, descriptions or other data, mainly gathered from annotations, for each exported material or function. The example also contains an implementation of the IMdl_cache_serializer, which exports the cache to a xml file and imports it back again when the application is started the next time.</p>
<p>In the current implementation, all modules that are not already in the cache, are loaded and analyzed at the first start of the MDL Browser. This can take several seconds up to minutes, depending on the number of modules installed on the system. Modules that are present in the cache are checked for updates. Therefore, we store the file path and the time of the last modification in the cache. In case the module (or archive) has changed, we load and analyze the content again. We also check if the resolved file path provided by the <a class="el" href="classmi_1_1neuraylib_1_1IMdl__discovery__api.html" title="Interface for the discovery API. ">mi::neuraylib::IMdl_discovery_api</a> matches the one stored in the cache to detect if a module originates from a different search path. This can happen due to new shadowing modules or after resolving previously existing shadows. </p>
<p class="enddd"></p>
</dd>
<dt><b>Usage of the Package Explorer</b> </dt>
<dd><p class="startdd"><br/>
 On the left side of the MDL Browser window there is a Package Explorer that allows to navigate the package and module structure. Every time the user clicks on a package it is expanded to show its content. At the same time, the main selection pane on the right is filtered to only show materials that are exported by modules of the current navigation level or deeper levels in the hierarchy. This way the user can narrow down the module he or she is looking for. To go up the hierarchy, there is a back button at the left edge of the screen and breadcrumbs at the top of the Package Explorer. Every time the user goes up, the filtering on the right side is updated to again show all materials for the current or deeper levels. Selecting a module in the Package Explorer, illustrated by a piece of a puzzle, the selection pane shows only materials that are exported by that module. Selecting the same module once more, or picking the last breadcrumb, removes this restriction again.</p>
<p>Please note, that always showing all possible materials in the selection pane might not scale arbitrarily. Furthermore, it would make sense to introduce pages, similar to many web shops, or to only show the materials that are exported by the modules of the current level <code>--</code> and not deeper levels <code>--</code> of the hierarchy. </p>
<p class="enddd"></p>
</dd>
<dt><b>Searching for materials based on the cached information</b> </dt>
<dd><p class="startdd"><br/>
 For reasonable large material libraries, the navigation of packages using only the Package Explorer is starting to get a tedious task, especially if the user already knows which material or at least which type of material he or she wants. Therefore, it is necessary to offer a search mechanism that allows to filter the set of materials to select from. Adding multiple search terms allows to further narrow down the list of candidates.</p>
<p>To realize such a search mechanism, a very basic inverse index structure is used. Each material or function acts as document that can be retrieved by the search and all the text information we store in the cache is treated as content of the individual documents. This content is split into single words and each word can be weighted based on the type of information, as a word appearing in the name might be more descriptive than a word in the description or in the author’s name. During the construction of the index structure, each document is processed into a list of pairs containing all words and their relevance for the document. The index itself consists of a hash map that is indexed by the words retrieved from all documents. The values in the map are so called posting lists. Here, the document is added if it contains the word that is used as key. The element that is added as a posting list is again a pair. This time, a pointer to the document itself and the relevance of the current word.</p>
<p>The index is constructed at application startup, right after the cache was updated. In contrast to the cache however, the index is not stored persistently even though it would make sense for very large material libraries or more detailed information about the individual elements.</p>
<p>At runtime, the user can search for materials by inserting queries into the search bar at the top of the window. This query is split into single words following the same rules as during the document processing. Then, for each word of the query, a regex matching for all keys in the index structure is computed. In case of a match, the posting list is iterated and the documents along with their relevance are retrieved. If there is more than one search term, only documents that appear in all results are presented to the user and the product of their relevance is used for ranking the selectable materials. Adding a leading minus sign directly in front of a search term allows to negate a search result. Only elements that do not appear in result list for that term are excepted. So, searching for “metal -copper” will retrieve all materials that are made of metal but not of copper. </p>
<p class="enddd"></p>
</dd>
<dt><b>Presentation of selectable materials</b> </dt>
<dd><p class="startdd"><br/>
 Depending on the user’s intention, we support him or her by sorting the results on the selection pane. The example provides three example sorting strategies: sorting by name, by modification date, and by search ranking, while all of them can be sorted ascending and descending. Besides the corresponding buttons below the search bar that can be used to configure the sorting, we automatically sort descending by search ranking when the user hits enter to submit a search query. Since hitting enter is optional, this is only added for convenience.</p>
<p>The selectable elements can be presented in a list or in a grid view. While the latter offers more possible selection candidates at once, the list view displays more information, i.e., the author and the description. However, both presentations provide more data when hovering over a small info icon.</p>
<p>Selecting a material shows a button to confirm the selection, which closes the browser and returns the qualified name back to the application, or in our case, to the console. Double-clicking a material can be used alternatively. </p>
<p class="enddd"></p>
</dd>
<dt><b>Shadowed modules</b> </dt>
<dd><p class="startdd"><br/>
 The <a class="el" href="classmi_1_1neuraylib_1_1IMdl__discovery__api.html" title="Interface for the discovery API. ">mi::neuraylib::IMdl_discovery_api</a> provides information about modules that are shadowed by modules in other search paths. The MDL Browser informs the user by a red exclamation mark on the module icon in the Package Explorer. Hovering over the icon uncovers the search path of the visible module, the one that can be loaded by the SDK, and the search paths of all modules that are shadows and thereby unavailable. </p>
<p class="enddd"></p>
</dd>
<dt><b>Running the example from the command line</b> </dt>
<dd><p class="startdd"><br/>
 The MDL Browser can be started with the command line options:</p>
<ul>
<li>-c | --cache_rebuild<br/>
 Forces a rebuild of the cache file.</li>
<li>-h | --help<br/>
 Shows all options with a short explanation.</li>
<li>-k | --keep_open<br/>
 Reopens the browser after closing the window or selecting a material until the console is closed.</li>
<li>-p | --mdl_path &lt;value&gt;<br/>
 By default, the MDL Browser uses the two default search paths for the system. On the Windows platform this is the admin-space search path, e.g., <em>C:\ProgramData\NVIDIA Corporation\mdl</em> and the user-space search path <em>%USERPROFILE%\Documents\mdl</em>. By passing the command line option -p &lt;value&gt;, this default behavior can be changed. The option can appear multiple times.</li>
<li>-l | --locale &lt;value&gt;<br/>
 Enable localization of the material descriptions and other display names. The localization code (see ISO 639-1 standard) has to be provided as &lt;value&gt;. If the option is not set, the system locale is used by default.</li>
<li>--no_qt_mode<br/>
 Setting this flag illustrates the standalone use-case. For applications that are not based on Qt, a windows in form of a dialog is created. Without the flag, the plugin is used as QML module that provided new MDL controls. </li>
</ul>
<p class="enddd"></p>
</dd>
<dt><b>Restrictions</b> </dt>
<dd><br/>
 The MDL Browser is a prototype that illustrates certain aspects user experience.<ul>
<li>At the moment, the example only works on the Windows platform.</li>
<li>Only materials can be selected even though the cache already supports functions.  </li>
</ul>
</dd>
</dl>
<h1><a class="anchor" id="example_mdl_browser"></a>
Example Source</h1>
<p>The source code consists of a lot of source files in <code>examples/mdl_sdk/mdl_browser</code>. Below we show only the file containing the <code>main()</code> function.</p>
<p><b>Source Code Location:</b> <code>examples/mdl_sdk/mdl_browser/mdl_browser/mdl_browser.cpp</code></p>
<div class="fragment"><div class="line"><span class="comment">/******************************************************************************</span></div>
<div class="line"><span class="comment"> * Copyright 2022 NVIDIA Corporation. All rights reserved.</span></div>
<div class="line"><span class="comment"> *****************************************************************************/</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//Defines the entry point for the console application.</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// example helper</span></div>
<div class="line"><span class="preprocessor">#include &quot;mdl_sdk_helper.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;mdl_browser_command_line_options.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;example_shared.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// system</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Qt</span></div>
<div class="line"><span class="preprocessor">#include &lt;QtQuick&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;QtQuickControls2/QQuickStyle&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;QQmlApplicationEngine&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;QtSvg&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// MDL QtPlugin</span></div>
<div class="line"><span class="preprocessor">#include &lt;mdl_qt_plugin.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// illustrates the use of the mdl qt module in a Qt based application</span></div>
<div class="line"><span class="keywordtype">int</span> run_demo_qt_application(Mdl_qt_plugin_interface* plugin,</div>
<div class="line">                            <a class="code" href="classmi_1_1neuraylib_1_1INeuray.html" title="This is an object representing the MDL SDK library. ">mi::neuraylib::INeuray</a>* neuray,</div>
<div class="line">                            <a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html" title="A transaction provides a consistent view on the database. ">mi::neuraylib::ITransaction</a>* transaction,</div>
<div class="line">                            Mdl_browser_command_line_options&amp; options)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// global Qt Setting that is used for the example</span></div>
<div class="line">    QQuickStyle::setStyle(<span class="stringliteral">&quot;Material&quot;</span>);</div>
<div class="line"><span class="preprocessor">    #if defined(Q_OS_WIN)</span></div>
<div class="line"><span class="preprocessor"></span>        QCoreApplication::setAttribute(Qt::AA_EnableHighDpiScaling);</div>
<div class="line">        <span class="comment">// QCoreApplication::setAttribute(Qt::AA_UseDesktopOpenGL); // hangs in remote desktop mode</span></div>
<div class="line">        QCoreApplication::setAttribute(Qt::AA_UseOpenGLES);</div>
<div class="line"><span class="preprocessor">    #endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    <span class="comment">// create a Qt application</span></div>
<div class="line">    <span class="keywordtype">int</span> argc = 0;</div>
<div class="line">    QGuiApplication app(argc, <span class="keyword">nullptr</span>);</div>
<div class="line">    QQmlApplicationEngine engine;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// create and pass the context</span></div>
<div class="line">    Mdl_qt_plugin_context plugin_context(neuray, transaction);</div>
<div class="line">    plugin_context.rebuild_module_cache = options.cache_rebuild;</div>
<div class="line">    plugin-&gt;set_context(&amp;engine, &amp;plugin_context);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// setup callbacks to get the result (not required)</span></div>
<div class="line">    plugin_context.get_mdl_browser_callbacks()-&gt;on_accepted = [](<span class="keyword">const</span> <span class="keywordtype">char</span>* value)</div>
<div class="line">    {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;[info] Selection: &quot;</span> &lt;&lt; value &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    };</div>
<div class="line">    plugin_context.get_mdl_browser_callbacks()-&gt;on_rejected = []()</div>
<div class="line">    {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;[info] Selection: nothing\n&quot;</span>;</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="comment">// load main window</span></div>
<div class="line">    app.setWindowIcon(QIcon(QString(<span class="stringliteral">&quot;:/mdlqtplugin/graphics/mdl_icon.svg&quot;</span>)));</div>
<div class="line">    engine.load(<span class="stringliteral">&quot;:/Main.qml&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Run the Application</span></div>
<div class="line">    <span class="keywordtype">int</span> exit_code = app.exec();</div>
<div class="line">    <span class="keywordflow">if</span> (exit_code != 0)</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;[error] Qt application crashed.\n&quot;</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> exit_code;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// illustrates the standalone usage of the mdl browser in a non-Qt-based application</span></div>
<div class="line"><span class="keywordtype">int</span> run_non_qt_application(Mdl_qt_plugin_interface* plugin,</div>
<div class="line">                           <a class="code" href="classmi_1_1neuraylib_1_1INeuray.html" title="This is an object representing the MDL SDK library. ">mi::neuraylib::INeuray</a>* neuray,</div>
<div class="line">                           <a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html" title="A transaction provides a consistent view on the database. ">mi::neuraylib::ITransaction</a>* transaction,</div>
<div class="line">                           Mdl_browser_command_line_options&amp; options)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">do</span></div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// create and pass the context for the (next) invocation of the browser</span></div>
<div class="line">        Mdl_qt_plugin_context* plugin_context = <span class="keyword">new</span> Mdl_qt_plugin_context(neuray, transaction);</div>
<div class="line">        plugin_context-&gt;rebuild_module_cache = options.cache_rebuild;</div>
<div class="line"></div>
<div class="line">        Mdl_qt_plguin_browser_handle selection_handle;</div>
<div class="line">        plugin-&gt;show_select_material_dialog(plugin_context, &amp;selection_handle);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// ...</span></div>
<div class="line">        <span class="comment">// do something else in your application</span></div>
<div class="line">        <span class="comment">// ...</span></div>
<div class="line"></div>
<div class="line">        selection_handle.thread.join();</div>
<div class="line">        <span class="keywordflow">if</span> (selection_handle.accepted)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// (only) output consumed by an application that uses this browser</span></div>
<div class="line">            <span class="comment">// instead of implementing an own one</span></div>
<div class="line">            std::cout &lt;&lt; selection_handle.result;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;[info] nothing selected\n&quot;</span>;</div>
<div class="line">        }</div>
<div class="line">        std::cout &lt;&lt; std::flush;</div>
<div class="line">        <span class="keyword">delete</span> plugin_context;</div>
<div class="line"></div>
<div class="line">    } <span class="keywordflow">while</span> (options.keep_open);</div>
<div class="line"></div>
<div class="line">    exit_success();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> MAIN_UTF8(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// parse command line options of the example</span></div>
<div class="line">    Mdl_browser_command_line_options options(argc, argv);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Access the MDL SDK</span></div>
<div class="line">    <span class="comment">// every application that used the MDL SDK does this in some way</span></div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::INeuray&gt;</a> neuray(load_mdl_sdk(options));</div>
<div class="line">    <span class="keywordflow">if</span> (!neuray)</div>
<div class="line">    {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;[MDL Browser] Failed to load the MDL SDK libraries.\n&quot;</span>;</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// create a transaction that used for loading modules and building the cache</span></div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html">mi::base::Handle&lt;mi::neuraylib::ITransaction&gt;</a> transaction(create_transaction(neuray.get()));</div>
<div class="line">    <span class="keywordflow">if</span> (!transaction)</div>
<div class="line">    {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;[MDL Browser] Failed to create a DB transaction.\n&quot;</span>;</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// load and initialize the MDL Qt Plugin</span></div>
<div class="line">    Mdl_qt_plugin_interface* plugin = Mdl_qt_plugin_interface::load(</div>
<div class="line">        mi::examples::io::get_executable_folder().c_str());</div>
<div class="line">    <span class="keywordflow">if</span> (!plugin)</div>
<div class="line">    {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;[MDL Browser] Failed to load the MdlQtPlugin.\n&quot;</span>;</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// depending on the use-case, the browser can be used from the as standalone windows in case</span></div>
<div class="line">    <span class="comment">// of an application that is not using Qt so far. If the application is based on Qt, the</span></div>
<div class="line">    <span class="comment">// browser can be included from the QML module.</span></div>
<div class="line">    <span class="keywordtype">int</span> exit_code = -1;</div>
<div class="line">    <span class="keywordflow">if</span> (options.no_qt_mode)</div>
<div class="line">        exit_code = run_non_qt_application(plugin, neuray.get(), transaction.get(), options);</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        exit_code = run_demo_qt_application(plugin, neuray.get(), transaction.get(), options);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// unload the plugin</span></div>
<div class="line">    plugin-&gt;unload();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// close the MDL SDK</span></div>
<div class="line">    transaction-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html#aa4ff8152107db238986b364273bceb0c" title="Commits the transaction. ">commit</a>();</div>
<div class="line">    transaction = <span class="keyword">nullptr</span>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Shut down the MDL SDK</span></div>
<div class="line">    <span class="keywordflow">if</span> (neuray-&gt;<a class="code" href="classmi_1_1neuraylib_1_1INeuray.html#a01d0574d048798c76f8e29f91a4f6fea" title="Shuts down the library. ">shutdown</a>() != 0)</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Failed to shutdown the SDK.\n&quot;</span>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Unload the MDL SDK</span></div>
<div class="line">    neuray = <span class="keyword">nullptr</span>;</div>
<div class="line">    <span class="keywordflow">if</span> (!mi::examples::mdl::unload())</div>
<div class="line">        std::cerr &lt;&lt; <span class="stringliteral">&quot;Failed to unload the SDK.\n&quot;</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> exit_code;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">COMMANDLINE_TO_UTF8</div>
</div><!-- fragment --><div align="right"> [<a class="el" href="mi_neuray_example_discovery.html">Previous</a>] [<a class="el" href="mi_neuray_examples.html">Up</a>] [<a class="el" href="mi_neuray_example_mdle.html">Next</a>] </div> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.4-->
<!-- start footer part -->
<div id="nav-path">
<span class="footeritem">5&#160;April&#160;2022,&#160;20:40, rev.358266</span>
<span class="footeritem"><a href="https://www.nvidia.com/en-us/about-nvidia/legal-info/" target="_blank" shape="rect">&copy; 2022 NVIDIA&nbsp;Corporation.</a> All rights reserved.</span>
</div>
</body>
</html>
