<!-- HTML header for doxygen 1.8.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>Example for building of new MDL Modules</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="images/arcicon.ico" rel="shortcut icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_custom_stylesheet_1_8_4.css" rel="stylesheet" type="text/css"/>
<link rel='stylesheet' href='webfonts/librebaskerville/stylesheet.css' type='text/css'/>
<link rel='stylesheet' href='webfonts/sourcesanspro/stylesheet.css' type='text/css'/>
<!--ARC-->
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="blackheader">
<span id="blackheader_title">MDL SDK API</span>
<span>
<img src="images/nvidia_logo_transpbg.gif" alt="nvidia_logo_transpbg.gif" style=" height:1.25em; width:6.806em;"/></span>
<span id="blackheader_uplink">
<a href='../index.html' class='top_page_nav'>Up</a>
</span>
</div>
<!--
<div id="titlearea">
   <span id="projectname">
     <a id="titlelink" href="../../index.html">
       MDL SDK API
     </a>
   </span>
     <a id="projectlogo" href="http://www.nvidia-arc.com">
       <img alt="NVIDIA logo" src="images/nvidia_logo.png" style="height:2em;">
       </a>
     <a href='../index.html' class='top_page_nav'>Up</a>
</div>
-->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('mi_neuray_example_create_module.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Example for building of new MDL Modules </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div align="right"> [<a class="el" href="mi_neuray_example_traversal.html">Previous</a>] [<a class="el" href="mi_neuray_examples.html">Up</a>] [<a class="el" href="mi_neuray_example_discovery.html">Next</a>] </div><p>This example builds a new MDL module from scratch</p>
<h1><a class="anchor" id="example_create_module_new"></a>
New Topics</h1>
<ul>
<li>Creation of a simple diffuse material</li>
<li>Creation of a material variant</li>
<li>Using the uniform analysis</li>
<li>Creation and usage of user-defined enum and struct types</li>
</ul>
<h1><a class="anchor" id="example_create_module_descr"></a>
Detailed Description</h1>
<dl>
<dt><b> Creation of a simple diffuse material </b> </dt>
<dd><p class="startdd"><br/>
 To define a new material, one needs to specify at least the parameters and the body of the material. Since the body typically references the parameters, it is recommended to start with the parameters, and then to create the body bottom-up in a post-order graph traversal. Here we create a single color parameter with name <code>"tint"</code>.</p>
<p>The body of the material consists of three chained function calls: <code>df::diffuse_reflection_bsdf()</code>, <code>material_surface()</code>, and <code>material()</code>. Note how the argument for <code>df::diffuse_reflection_bsdf()</code> references the <code>"tint"</code> parameter of the material. Each of the first two function call is used as argument to the following function call.</p>
<p>Finally, the intended name of the new material, as well as its parameters and the body, are passed to <a class="el" href="classmi_1_1neuraylib_1_1IMdl__module__builder.html#a527e2562e03966b920ef62d65f149f44" title="Adds a material or function to the module. ">mi::neuraylib::IMdl_module_builder::add_function()</a>.</p>
<p class="enddd"></p>
</dd>
<dt><b> Creation of a material variant </b> </dt>
<dd><p class="startdd"><br/>
 To define a variant, one needs to specify the prototype and the (new) defaults. Since the material in the first step does not have any default, the new default is required for this variant here. In addition, we define an optional annotation for the variant itself.</p>
<p>Finally, the intended name of the new variant, as well as the prototype, the defaults, and the annotations are passed to <a class="el" href="classmi_1_1neuraylib_1_1IMdl__module__builder.html#a13c3eb3f77014dd7a08eac229ec5cbdf" title="Adds a variant to the module. ">mi::neuraylib::IMdl_module_builder::add_variant()</a>.</p>
<p class="enddd"></p>
</dd>
<dt><b> Using the uniform analysis </b> </dt>
<dd><p class="startdd"><br/>
 The graph structure of the body of a function or material might require certain parameters to be uniform in order to obtain valid MDL module. Since these constraints might not be obvious, the uniform analysis can be used to obtain such information.</p>
<p>Here, the <code>"across_materials"</code> parameter is created without modifiers first, and the information from the uniform analysis is used to add the uniform modifier before the material is actually added.</p>
<p class="enddd"></p>
</dd>
<dt><b> Creation and usage of user-defined enum and struct types </b> </dt>
<dd><p class="startdd"><br/>
 First, a new enum type with two enumerators and a new struct type with two <code>int</code> fields is created.</p>
<p>Afterwards, we create a function that makes use of these user-defined types. Note the conversion from the enum type to <code>int</code> since there are no comparison operators for user-defined types. Also note the accesses to the field values of the struct type. Next, the expressions for the condition, for the <code>true</code> expression, and for the <code>false</code> expression of the ternary operator are created. Finally, these expressions are passed as arguments to the ternary operator which represents the root of the function body.</p>
<p class="enddd"></p>
</dd>
</dl>
<h1><a class="anchor" id="example_create_module"></a>
Example Source</h1>
<p><b>Source Code Location:</b> <code>examples/mdl_sdk/create_module/example_create_module.cpp</code></p>
<div class="fragment"><div class="line"><span class="comment">/******************************************************************************</span></div>
<div class="line"><span class="comment"> * Copyright 2022 NVIDIA Corporation. All rights reserved.</span></div>
<div class="line"><span class="comment"> *****************************************************************************/</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// examples/mdl_sdk/create_module/example_create_module.cpp</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Create a new MDL module</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;example_shared.h&quot;</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="classmi_1_1neuraylib_1_1IAnnotation__block.html" title="An annotation block is an array of annotations. ">mi::neuraylib::IAnnotation_block</a>* create_annotations(</div>
<div class="line">    <a class="code" href="classmi_1_1neuraylib_1_1IValue__factory.html" title="The interface for creating values. ">mi::neuraylib::IValue_factory</a>* vf,</div>
<div class="line">    <a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html" title="The interface for creating expressions. ">mi::neuraylib::IExpression_factory</a>* ef,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* description)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IValue&gt;</a> arg_value( vf-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IValue__factory.html#a3b7630a9a95348d54cefba10ffe568be" title="Creates a new value of type string. ">create_string</a>( description));</div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression&gt;</a> arg_expr(</div>
<div class="line">        ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#a774749a982e8b8e8910e01e11ec39d59" title="Creates a constant (mutable). ">create_constant</a>( arg_value.get()));</div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression_list&gt;</a> args( ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#af0b7dbd66ce98752e05c51e350678a78" title="Creates a new expression list. ">create_expression_list</a>());</div>
<div class="line">    check_success( 0 == args-&gt;add_expression( <span class="stringliteral">&quot;description&quot;</span>, arg_expr.get()));</div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IAnnotation&gt;</a> annotation(</div>
<div class="line">         ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#a49924ce37c5badb2ea81473bb92f2a96" title="Creates a new annotation. ">create_annotation</a>( <span class="stringliteral">&quot;::anno::description(string)&quot;</span>, args.get()));</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IAnnotation_block&gt;</a> annotation_block(</div>
<div class="line">        ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#ad6653541af9206fb3eecb789f251fe1a" title="Creates a new annotation block. ">create_annotation_block</a>());</div>
<div class="line">    annotation_block-&gt;add_annotation( annotation.get());</div>
<div class="line"></div>
<div class="line">    annotation_block-&gt;retain();</div>
<div class="line">    <span class="keywordflow">return</span> annotation_block.<a class="code" href="classmi_1_1base_1_1Handle.html#ab28423d4121459d4026449e4991f5486" title="Access to the interface. Returns 0 for an invalid interface. ">get</a>();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> create_module(</div>
<div class="line">    <a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html" title="A transaction provides a consistent view on the database. ">mi::neuraylib::ITransaction</a>* transaction,</div>
<div class="line">    <a class="code" href="classmi_1_1neuraylib_1_1IMdl__impexp__api.html" title="API component for MDL related import and export operations. ">mi::neuraylib::IMdl_impexp_api</a>* mdl_impexp_api,</div>
<div class="line">    <a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html" title="Factory for various MDL interfaces and functions. ">mi::neuraylib::IMdl_factory</a>* mdl_factory)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IType_factory&gt;</a> tf(</div>
<div class="line">        mdl_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html#ae32b4ecd78cbbe5212f8daf1552180c3" title="Returns an MDL type factory for the given transaction. ">create_type_factory</a>( transaction));</div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html">mi::base::Handle&lt;mi::neuraylib::IValue_factory&gt;</a> vf(</div>
<div class="line">        mdl_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html#a76919730caa41d98004f3edcff45d1df" title="Returns an MDL value factory for the given transaction. ">create_value_factory</a>( transaction));</div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html">mi::base::Handle&lt;mi::neuraylib::IExpression_factory&gt;</a> ef(</div>
<div class="line">        mdl_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html#aaa79f7a5d2d2973f7d34e007f22fc949" title="Returns an MDL expression factory for the given transaction. ">create_expression_factory</a>( transaction));</div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IMdl_execution_context&gt;</a> context(</div>
<div class="line">        mdl_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html#a78a9a6489592c90ea49e0fe0ac8be235" title="Creates an execution context. ">create_execution_context</a>());</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Load modules.</span></div>
<div class="line">    check_success( mdl_impexp_api-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__impexp__api.html#a5e195d80915190eb40c5995ccfeaa4c9" title="Loads an MDL module from disk (or a builtin module) into the database. ">load_module</a>(</div>
<div class="line">        transaction, <span class="stringliteral">&quot;::df&quot;</span>, context.get()) &gt;= 0);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Create the module builder.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// We start building a module &quot;::new_module&quot; that does not yet exist in the DB.</span></div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IMdl_module_builder&gt;</a> module_builder(</div>
<div class="line">        mdl_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html#acfb3f3619135d5162196851186472dfb" title="Creates a module builder for a given module. ">create_module_builder</a>(</div>
<div class="line">            transaction,</div>
<div class="line">            <span class="stringliteral">&quot;mdl::new_module&quot;</span>,</div>
<div class="line">            <a class="code" href="group__mi__neuray__mdl__types.html#gga2384b1621265603a8e992e92c7713050a141e8a79399c7a1007534d8a72aca3d8" title="MDL version 1.0. ">mi::neuraylib::MDL_VERSION_1_0</a>,</div>
<div class="line">            <a class="code" href="group__mi__neuray__mdl__types.html#gga2384b1621265603a8e992e92c7713050a7886f3144ca87e817fa21619f418ba40" title="Latest MDL version. ">mi::neuraylib::MDL_VERSION_LATEST</a>,</div>
<div class="line">            context.get()));</div>
<div class="line"></div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// (1) Create a simple diffuse material.</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">// export material diffuse_material(color tint)</span></div>
<div class="line">        <span class="comment">// = material(</span></div>
<div class="line">        <span class="comment">//     surface: material_surface(scattering: df::diffuse_reflection_bsdf(tint: tint))</span></div>
<div class="line">        <span class="comment">// );</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">// Create parameters.</span></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IType_color&gt;</a> tint_type( tf-&gt;create_color());</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IType_list&gt;</a> parameters( tf-&gt;create_type_list());</div>
<div class="line">        parameters-&gt;add_type( <span class="stringliteral">&quot;tint&quot;</span>, tint_type.get());</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Create body.</span></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression&gt;</a> drb_tint(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#af404d6e8ec0dd4c4b523b2cf7a867823" title="Creates a parameter reference. ">create_parameter</a>( tint_type.get(), 0));</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression_list&gt;</a> drb_args(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#af0b7dbd66ce98752e05c51e350678a78" title="Creates a new expression list. ">create_expression_list</a>());</div>
<div class="line">        drb_args-&gt;add_expression( <span class="stringliteral">&quot;tint&quot;</span>, drb_tint.get());</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IExpression&gt;</a> drb(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#a8549aad202b02401633f99faf754ee62" title="Creates a direct call. ">create_direct_call</a>(</div>
<div class="line">                 <span class="stringliteral">&quot;mdl::df::diffuse_reflection_bsdf(color,float,string)&quot;</span>, drb_args.get()));</div>
<div class="line"></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression_list&gt;</a> surface_args(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#af0b7dbd66ce98752e05c51e350678a78" title="Creates a new expression list. ">create_expression_list</a>());</div>
<div class="line">        surface_args-&gt;add_expression( <span class="stringliteral">&quot;scattering&quot;</span>, drb.get());</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IExpression&gt;</a> surface(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#a8549aad202b02401633f99faf754ee62" title="Creates a direct call. ">create_direct_call</a>(</div>
<div class="line">                <span class="stringliteral">&quot;mdl::material_surface(bsdf,material_emission)&quot;</span>, surface_args.get()));</div>
<div class="line"></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression_list&gt;</a> body_args(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#af0b7dbd66ce98752e05c51e350678a78" title="Creates a new expression list. ">create_expression_list</a>());</div>
<div class="line">        body_args-&gt;add_expression( <span class="stringliteral">&quot;surface&quot;</span>, surface.get());</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IExpression&gt;</a> body(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#a8549aad202b02401633f99faf754ee62" title="Creates a direct call. ">create_direct_call</a>(</div>
<div class="line">                <span class="stringliteral">&quot;mdl::material(bool,material_surface,material_surface,color,material_volume,&quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;material_geometry,hair_bsdf)&quot;</span>, body_args.get()));</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Add the material to the module.</span></div>
<div class="line">        <a class="code" href="group__mi__base__types.html#gafcdcb44319b0596ee8a9a44fddaec8c6" title="32-bit signed integer. ">mi::Sint32</a> result = module_builder-&gt;add_function(</div>
<div class="line">            <span class="stringliteral">&quot;diffuse_material&quot;</span>,</div>
<div class="line">            body.get(),</div>
<div class="line">            parameters.get(),</div>
<div class="line">            <span class="comment">/*defaults*/</span> <span class="keyword">nullptr</span>,</div>
<div class="line">            <span class="comment">/*parameter_annotations*/</span> <span class="keyword">nullptr</span>,</div>
<div class="line">            <span class="comment">/*annotations*/</span> <span class="keyword">nullptr</span>,</div>
<div class="line">            <span class="comment">/*return_annotations*/</span> <span class="keyword">nullptr</span>,</div>
<div class="line">            <span class="comment">/*is_exported*/</span> <span class="keyword">true</span>,</div>
<div class="line">            <span class="comment">/*frequency_qualifier*/</span> <a class="code" href="classmi_1_1neuraylib_1_1IType.html#acfcf5e2586c2c35a81f5a116ecc10b59a9b274ed4e11fc875de8cff01b2a5f8be" title="No type modifier (mutable, auto-typed). ">mi::neuraylib::IType::MK_NONE</a>,</div>
<div class="line">            context.get());</div>
<div class="line"></div>
<div class="line">        print_messages( context.get());</div>
<div class="line">        check_success( result == 0);</div>
<div class="line">        check_success( context-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__execution__context.html#a65f343d795e12da9a1ba79cbe4b3b123" title="Returns the number of error messages. ">get_error_messages_count</a>() == 0);</div>
<div class="line">    }</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// (2) Create a simple red material as a variant of &quot;diffuse_material&quot;.</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">// export material red_material(*) [[ anno::description(&quot;A diffuse red material&quot;) ]]</span></div>
<div class="line">        <span class="comment">// = diffuse_material(tint: color(1.f, 0.f, 0.f));</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">// Create defaults.</span></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IValue&gt;</a> tint_value(</div>
<div class="line">            vf-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IValue__factory.html#a9c86a285168ac21d5607eac1b369b298" title="Creates a new value of type color. ">create_color</a>( 1.0f, 0.0f, 0.0f));</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression&gt;</a> tint_expr(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#a774749a982e8b8e8910e01e11ec39d59" title="Creates a constant (mutable). ">create_constant</a>( tint_value.get()));</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression_list&gt;</a> defaults(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#af0b7dbd66ce98752e05c51e350678a78" title="Creates a new expression list. ">create_expression_list</a>());</div>
<div class="line">        defaults-&gt;add_expression( <span class="stringliteral">&quot;tint&quot;</span>, tint_expr.get());</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Create annotations.</span></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IAnnotation_block&gt;</a> annotations(</div>
<div class="line">            create_annotations( vf.get(), ef.get(), <span class="stringliteral">&quot;A diffuse red material&quot;</span>));</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Add the variant to the module.</span></div>
<div class="line">        <a class="code" href="group__mi__base__types.html#gafcdcb44319b0596ee8a9a44fddaec8c6" title="32-bit signed integer. ">mi::Sint32</a> result = module_builder-&gt;add_variant(</div>
<div class="line">            <span class="stringliteral">&quot;red_material&quot;</span>,</div>
<div class="line">            <span class="stringliteral">&quot;mdl::new_module::diffuse_material(color)&quot;</span>,</div>
<div class="line">            defaults.get(),</div>
<div class="line">            annotations.get(),</div>
<div class="line">            <span class="comment">/*return_annotations*/</span> <span class="keyword">nullptr</span>,</div>
<div class="line">            <span class="comment">/*is_exported*/</span> <span class="keyword">true</span>,</div>
<div class="line">            context.get());</div>
<div class="line"></div>
<div class="line">        print_messages( context.get());</div>
<div class="line">        check_success( result == 0);</div>
<div class="line">        check_success( context-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__execution__context.html#a65f343d795e12da9a1ba79cbe4b3b123" title="Returns the number of error messages. ">get_error_messages_count</a>() == 0);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Re-create the module builder.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// We could continue to use the existing module builder, but for demonstration purposes we</span></div>
<div class="line">    <span class="comment">// ignore how &quot;::new_module&quot; was created and show now how to use the module builder to edit a</span></div>
<div class="line">    <span class="comment">// module that exists already in the DB.</span></div>
<div class="line">    module_builder = mdl_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html#acfb3f3619135d5162196851186472dfb" title="Creates a module builder for a given module. ">create_module_builder</a>(</div>
<div class="line">        transaction,</div>
<div class="line">        <span class="stringliteral">&quot;mdl::new_module&quot;</span>,</div>
<div class="line">        <span class="comment">/*ignored*/</span> <a class="code" href="group__mi__neuray__mdl__types.html#gga2384b1621265603a8e992e92c7713050a141e8a79399c7a1007534d8a72aca3d8" title="MDL version 1.0. ">mi::neuraylib::MDL_VERSION_1_0</a>,</div>
<div class="line">        <a class="code" href="group__mi__neuray__mdl__types.html#gga2384b1621265603a8e992e92c7713050a7886f3144ca87e817fa21619f418ba40" title="Latest MDL version. ">mi::neuraylib::MDL_VERSION_LATEST</a>,</div>
<div class="line">        context.get());</div>
<div class="line"></div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// (3) Use the uniform analysis to figure out required uniform modifiers of parameters.</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">// export material uniform_parameter(uniform bool across_materials)</span></div>
<div class="line">        <span class="comment">// = diffuse_material(</span></div>
<div class="line">        <span class="comment">//     tint: state::rounded_corner_normal(0.f, across_materials, 1.f)</span></div>
<div class="line">        <span class="comment">// );</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">// Create parameters (without uniform modifier at first).</span></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IType&gt;</a> across_materials_type( tf-&gt;create_bool());</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IType_list&gt;</a> parameters( tf-&gt;create_type_list());</div>
<div class="line">        parameters-&gt;add_type( <span class="stringliteral">&quot;across_materials&quot;</span>, across_materials_type.get());</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Create body.</span></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression&gt;</a> across_materials_expr(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#af404d6e8ec0dd4c4b523b2cf7a867823" title="Creates a parameter reference. ">create_parameter</a>( across_materials_type.get(), 0));</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression_list&gt;</a> rcn_args(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#af0b7dbd66ce98752e05c51e350678a78" title="Creates a new expression list. ">create_expression_list</a>());</div>
<div class="line">        rcn_args-&gt;add_expression( <span class="stringliteral">&quot;across_materials&quot;</span>, across_materials_expr.get());</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IExpression&gt;</a> rcn(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#a8549aad202b02401633f99faf754ee62" title="Creates a direct call. ">create_direct_call</a>( <span class="stringliteral">&quot;mdl::state::rounded_corner_normal$1.2(float,bool)&quot;</span>,</div>
<div class="line">                rcn_args.get()));</div>
<div class="line"></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression_list&gt;</a> color_args(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#af0b7dbd66ce98752e05c51e350678a78" title="Creates a new expression list. ">create_expression_list</a>());</div>
<div class="line">        color_args-&gt;add_expression( <span class="stringliteral">&quot;rgb&quot;</span>, rcn.get());</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IExpression&gt;</a> color(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#a8549aad202b02401633f99faf754ee62" title="Creates a direct call. ">create_direct_call</a>( <span class="stringliteral">&quot;mdl::color(float3)&quot;</span>, color_args.get()));</div>
<div class="line"></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression_list&gt;</a> body_args(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#af0b7dbd66ce98752e05c51e350678a78" title="Creates a new expression list. ">create_expression_list</a>());</div>
<div class="line">        body_args-&gt;add_expression( <span class="stringliteral">&quot;tint&quot;</span>, color.get());</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IExpression&gt;</a> body(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#a8549aad202b02401633f99faf754ee62" title="Creates a direct call. ">create_direct_call</a>( <span class="stringliteral">&quot;mdl::new_module::diffuse_material(color)&quot;</span>, body_args.get()));</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Run uniform analysis.</span></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::IArray&gt;</a> uniform( module_builder-&gt;analyze_uniform(</div>
<div class="line">            body.get(), <span class="comment">/*root_uniform*/</span> <span class="keyword">false</span>, context.get()));</div>
<div class="line">        print_messages( context.get());</div>
<div class="line">        check_success( context-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__execution__context.html#a65f343d795e12da9a1ba79cbe4b3b123" title="Returns the number of error messages. ">get_error_messages_count</a>() == 0);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Adapt parameter types based on uniform analysis.</span></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IType_list&gt;</a> fixed_parameters( tf-&gt;create_type_list());</div>
<div class="line">        <span class="keywordflow">for</span>( <a class="code" href="group__mi__base__types.html#gaa8e6476e3c0fc948ef75264572568791" title="Unsigned integral type that is large enough to hold the size of all types. ">mi::Size</a> i = 0, n = uniform-&gt;get_length(); i &lt; n; ++i) {</div>
<div class="line">            <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IType&gt;</a> parameter( parameters-&gt;get_type( i));</div>
<div class="line">            <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::IBoolean&gt;</a> element( uniform-&gt;get_element&lt;<a class="code" href="classmi_1_1IBoolean.html" title="This interface represents bool. ">mi::IBoolean</a>&gt;( i));</div>
<div class="line">            <span class="keywordflow">if</span>( element-&gt;get_value&lt;<span class="keywordtype">bool</span>&gt;()) {</div>
<div class="line">                check_success( i == 0);</div>
<div class="line">                parameter = tf-&gt;create_alias(</div>
<div class="line">                    parameter.get(), <a class="code" href="classmi_1_1neuraylib_1_1IType.html#acfcf5e2586c2c35a81f5a116ecc10b59a2c336cc68c1393acebc2694894d40b8c" title="A uniform type. ">mi::neuraylib::IType::MK_UNIFORM</a>, <span class="comment">/*symbol*/</span> <span class="keyword">nullptr</span>);</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                check_success( i != 0);</div>
<div class="line">            }</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">char</span>* name = parameters-&gt;get_name( i);</div>
<div class="line">            fixed_parameters-&gt;add_type( name, parameter.get());</div>
<div class="line">        }</div>
<div class="line">        parameters = fixed_parameters;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Add the material to the module.</span></div>
<div class="line">        <a class="code" href="group__mi__base__types.html#gafcdcb44319b0596ee8a9a44fddaec8c6" title="32-bit signed integer. ">mi::Sint32</a> result = module_builder-&gt;add_function(</div>
<div class="line">            <span class="stringliteral">&quot;uniform_parameter&quot;</span>,</div>
<div class="line">            body.get(),</div>
<div class="line">            parameters.get(),</div>
<div class="line">            <span class="comment">/*defaults*/</span> <span class="keyword">nullptr</span>,</div>
<div class="line">            <span class="comment">/*parameter_annotations*/</span> <span class="keyword">nullptr</span>,</div>
<div class="line">            <span class="comment">/*annotations*/</span> <span class="keyword">nullptr</span>,</div>
<div class="line">            <span class="comment">/*return_annotations*/</span> <span class="keyword">nullptr</span>,</div>
<div class="line">            <span class="comment">/*is_exported*/</span> <span class="keyword">true</span>,</div>
<div class="line">            <span class="comment">/*frequency_qualifier*/</span> <a class="code" href="classmi_1_1neuraylib_1_1IType.html#acfcf5e2586c2c35a81f5a116ecc10b59a9b274ed4e11fc875de8cff01b2a5f8be" title="No type modifier (mutable, auto-typed). ">mi::neuraylib::IType::MK_NONE</a>,</div>
<div class="line">            context.get());</div>
<div class="line"></div>
<div class="line">        print_messages( context.get());</div>
<div class="line">        check_success( result == 0);</div>
<div class="line">        check_success( context-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__execution__context.html#a65f343d795e12da9a1ba79cbe4b3b123" title="Returns the number of error messages. ">get_error_messages_count</a>() == 0);</div>
<div class="line">    }</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// (4a) Create two new types.</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">// export enum Enum { Add = 0, Sub = 1 };</span></div>
<div class="line">        <span class="comment">// export struct Struct { int x; int y; };</span></div>
<div class="line"></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IValue&gt;</a> add_value( vf-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IValue__factory.html#a631a10bc211046f5badc972bcb14e33d" title="Creates a new value of type integer. ">create_int</a>( 0));</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression&gt;</a> add_expr(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#a774749a982e8b8e8910e01e11ec39d59" title="Creates a constant (mutable). ">create_constant</a>( add_value.get()));</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IValue&gt;</a> sub_value( vf-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IValue__factory.html#a631a10bc211046f5badc972bcb14e33d" title="Creates a new value of type integer. ">create_int</a>( 1));</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression&gt;</a> sub_expr(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#a774749a982e8b8e8910e01e11ec39d59" title="Creates a constant (mutable). ">create_constant</a>( sub_value.get()));</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression_list&gt;</a> enumerators(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#af0b7dbd66ce98752e05c51e350678a78" title="Creates a new expression list. ">create_expression_list</a>());</div>
<div class="line">        enumerators-&gt;add_expression( <span class="stringliteral">&quot;Add&quot;</span>, add_expr.get());</div>
<div class="line">        enumerators-&gt;add_expression( <span class="stringliteral">&quot;Sub&quot;</span>, sub_expr.get());</div>
<div class="line"></div>
<div class="line">        <a class="code" href="group__mi__base__types.html#gafcdcb44319b0596ee8a9a44fddaec8c6" title="32-bit signed integer. ">mi::Sint32</a> result = module_builder-&gt;add_enum_type(</div>
<div class="line">            <span class="stringliteral">&quot;Enum&quot;</span>,</div>
<div class="line">            enumerators.get(),</div>
<div class="line">            <span class="comment">/*enumerator_annotations*/</span> <span class="keyword">nullptr</span>,</div>
<div class="line">            <span class="comment">/*annotations*/</span> <span class="keyword">nullptr</span>,</div>
<div class="line">            <span class="comment">/*is_exported*/</span> <span class="keyword">true</span>,</div>
<div class="line">            context.get());</div>
<div class="line"></div>
<div class="line">        print_messages( context.get());</div>
<div class="line">        check_success( result == 0);</div>
<div class="line">        check_success( context-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__execution__context.html#a65f343d795e12da9a1ba79cbe4b3b123" title="Returns the number of error messages. ">get_error_messages_count</a>() == 0);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IType&gt;</a> x( tf-&gt;create_int());</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IType&gt;</a> y( tf-&gt;create_int());</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IType_list&gt;</a> fields( tf-&gt;create_type_list());</div>
<div class="line">        fields-&gt;add_type( <span class="stringliteral">&quot;x&quot;</span>, x.get());</div>
<div class="line">        fields-&gt;add_type( <span class="stringliteral">&quot;y&quot;</span>, y.get());</div>
<div class="line"></div>
<div class="line">        result = module_builder-&gt;add_struct_type(</div>
<div class="line">            <span class="stringliteral">&quot;Struct&quot;</span>,</div>
<div class="line">            fields.get(),</div>
<div class="line">            <span class="comment">/*field_defaults*/</span> <span class="keyword">nullptr</span>,</div>
<div class="line">            <span class="comment">/*field_annotations*/</span> <span class="keyword">nullptr</span>,</div>
<div class="line">            <span class="comment">/*annotations*/</span> <span class="keyword">nullptr</span>,</div>
<div class="line">            <span class="comment">/*is_exported*/</span> <span class="keyword">true</span>,</div>
<div class="line">            context.get());</div>
<div class="line"></div>
<div class="line">        print_messages( context.get());</div>
<div class="line">        check_success( result == 0);</div>
<div class="line">        check_success( context-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__execution__context.html#a65f343d795e12da9a1ba79cbe4b3b123" title="Returns the number of error messages. ">get_error_messages_count</a>() == 0);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// (4b) Create a function that operates on these types.</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">// export int types(Enum e, Struct s) { return e == ADD ? s.x + s.y : s.x - s.y; }</span></div>
<div class="line">        <span class="comment">//</span></div>
<div class="line">        <span class="comment">// Since there are no comparison operators for user-defined types, we actually compute</span></div>
<div class="line">        <span class="comment">// &quot;int(e) == 0&quot; instead of &quot;e == ADD&quot;.</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">// Create parameters</span></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IType_enum&gt;</a> e_type(</div>
<div class="line">            tf-&gt;create_enum( <span class="stringliteral">&quot;::new_module::Enum&quot;</span>));</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IType_struct&gt;</a> s_type(</div>
<div class="line">            tf-&gt;create_struct( <span class="stringliteral">&quot;::new_module::Struct&quot;</span>));</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IType_list&gt;</a> parameters( tf-&gt;create_type_list());</div>
<div class="line">        parameters-&gt;add_type( <span class="stringliteral">&quot;e&quot;</span>, e_type.get());</div>
<div class="line">        parameters-&gt;add_type( <span class="stringliteral">&quot;s&quot;</span>, s_type.get());</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Create body.</span></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression&gt;</a> parameter_e(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#af404d6e8ec0dd4c4b523b2cf7a867823" title="Creates a parameter reference. ">create_parameter</a>( e_type.get(), 0));</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression&gt;</a> parameter_s(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#af404d6e8ec0dd4c4b523b2cf7a867823" title="Creates a parameter reference. ">create_parameter</a>( s_type.get(), 1));</div>
<div class="line"></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression_list&gt;</a> e_int_args(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#af0b7dbd66ce98752e05c51e350678a78" title="Creates a new expression list. ">create_expression_list</a>());</div>
<div class="line">        e_int_args-&gt;add_expression( <span class="stringliteral">&quot;x&quot;</span>, parameter_e.get());</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IExpression&gt;</a> e_int(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#a8549aad202b02401633f99faf754ee62" title="Creates a direct call. ">create_direct_call</a>( <span class="stringliteral">&quot;mdl::new_module::int(::new_module::Enum)&quot;</span>, e_int_args.get()));</div>
<div class="line"></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression_list&gt;</a> struct_selector_args(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#af0b7dbd66ce98752e05c51e350678a78" title="Creates a new expression list. ">create_expression_list</a>());</div>
<div class="line">        struct_selector_args-&gt;add_expression( <span class="stringliteral">&quot;s&quot;</span>, parameter_s.get());</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IExpression&gt;</a> s_x(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#a8549aad202b02401633f99faf754ee62" title="Creates a direct call. ">create_direct_call</a>(</div>
<div class="line">                <span class="stringliteral">&quot;mdl::new_module::Struct.x(::new_module::Struct)&quot;</span>, struct_selector_args.get()));</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IExpression&gt;</a> s_y(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#a8549aad202b02401633f99faf754ee62" title="Creates a direct call. ">create_direct_call</a>(</div>
<div class="line">                <span class="stringliteral">&quot;mdl::new_module::Struct.y(::new_module::Struct)&quot;</span>, struct_selector_args.get()));</div>
<div class="line"></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IValue&gt;</a> equal_y_value( vf-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IValue__factory.html#a631a10bc211046f5badc972bcb14e33d" title="Creates a new value of type integer. ">create_int</a>( 0));</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression&gt;</a> equal_y_expr(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#a774749a982e8b8e8910e01e11ec39d59" title="Creates a constant (mutable). ">create_constant</a>( equal_y_value.get()));</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression_list&gt;</a> equal_args(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#af0b7dbd66ce98752e05c51e350678a78" title="Creates a new expression list. ">create_expression_list</a>());</div>
<div class="line">        equal_args-&gt;add_expression( <span class="stringliteral">&quot;x&quot;</span>, e_int.get());</div>
<div class="line">        equal_args-&gt;add_expression( <span class="stringliteral">&quot;y&quot;</span>, equal_y_expr.get());</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IExpression&gt;</a> equal(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#a8549aad202b02401633f99faf754ee62" title="Creates a direct call. ">create_direct_call</a>( <span class="stringliteral">&quot;mdl::operator==(int,int)&quot;</span>, equal_args.get()));</div>
<div class="line"></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression_list&gt;</a> add_args(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#af0b7dbd66ce98752e05c51e350678a78" title="Creates a new expression list. ">create_expression_list</a>());</div>
<div class="line">        add_args-&gt;add_expression( <span class="stringliteral">&quot;x&quot;</span>, s_x.get());</div>
<div class="line">        add_args-&gt;add_expression( <span class="stringliteral">&quot;y&quot;</span>, s_y.get());</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IExpression&gt;</a> add(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#a8549aad202b02401633f99faf754ee62" title="Creates a direct call. ">create_direct_call</a>( <span class="stringliteral">&quot;mdl::operator+(int,int)&quot;</span>, add_args.get()));</div>
<div class="line"></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression_list&gt;</a> sub_args(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#af0b7dbd66ce98752e05c51e350678a78" title="Creates a new expression list. ">create_expression_list</a>());</div>
<div class="line">        sub_args-&gt;add_expression( <span class="stringliteral">&quot;x&quot;</span>, s_x.get());</div>
<div class="line">        sub_args-&gt;add_expression( <span class="stringliteral">&quot;y&quot;</span>, s_y.get());</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IExpression&gt;</a> sub(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#a8549aad202b02401633f99faf754ee62" title="Creates a direct call. ">create_direct_call</a>( <span class="stringliteral">&quot;mdl::operator-(int,int)&quot;</span>, sub_args.get()));</div>
<div class="line"></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression_list&gt;</a> body_args(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#af0b7dbd66ce98752e05c51e350678a78" title="Creates a new expression list. ">create_expression_list</a>());</div>
<div class="line">        body_args-&gt;add_expression( <span class="stringliteral">&quot;cond&quot;</span>, equal.get());</div>
<div class="line">        body_args-&gt;add_expression( <span class="stringliteral">&quot;true_exp&quot;</span>, add.get());</div>
<div class="line">        body_args-&gt;add_expression( <span class="stringliteral">&quot;false_exp&quot;</span>, sub.get());</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IExpression&gt;</a> body(</div>
<div class="line">            ef-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#a8549aad202b02401633f99faf754ee62" title="Creates a direct call. ">create_direct_call</a>( <span class="stringliteral">&quot;mdl::operator%3F(bool,%3C0%3E,%3C0%3E)&quot;</span>, body_args.get()));</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Add the function to the module.</span></div>
<div class="line">        result = module_builder-&gt;add_function(</div>
<div class="line">            <span class="stringliteral">&quot;types&quot;</span>,</div>
<div class="line">            body.get(),</div>
<div class="line">            parameters.get(),</div>
<div class="line">            <span class="comment">/*defaults*/</span> <span class="keyword">nullptr</span>,</div>
<div class="line">            <span class="comment">/*parameter_annotations*/</span> <span class="keyword">nullptr</span>,</div>
<div class="line">            <span class="comment">/*annotations*/</span> <span class="keyword">nullptr</span>,</div>
<div class="line">            <span class="comment">/*return_annotations*/</span> <span class="keyword">nullptr</span>,</div>
<div class="line">            <span class="comment">/*is_exported*/</span> <span class="keyword">true</span>,</div>
<div class="line">            <span class="comment">/*frequency_qualifier*/</span> <a class="code" href="classmi_1_1neuraylib_1_1IType.html#acfcf5e2586c2c35a81f5a116ecc10b59a9b274ed4e11fc875de8cff01b2a5f8be" title="No type modifier (mutable, auto-typed). ">mi::neuraylib::IType::MK_NONE</a>,</div>
<div class="line">            context.get());</div>
<div class="line"></div>
<div class="line">        print_messages( context.get());</div>
<div class="line">        check_success( result == 0);</div>
<div class="line">        check_success( context-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__execution__context.html#a65f343d795e12da9a1ba79cbe4b3b123" title="Returns the number of error messages. ">get_error_messages_count</a>() == 0);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Print the exported MDL source code to the console.</span></div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::IString&gt;</a> module_source( transaction-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html#ad1b8ce71d7a6fea1f59573325dba126c" title="Creates an object of the type type_name. ">create</a>&lt;<a class="code" href="classmi_1_1IString.html" title="A simple string class. ">mi::IString</a>&gt;( <span class="stringliteral">&quot;String&quot;</span>));</div>
<div class="line">    <a class="code" href="group__mi__base__types.html#gafcdcb44319b0596ee8a9a44fddaec8c6" title="32-bit signed integer. ">mi::Sint32</a> result = mdl_impexp_api-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__impexp__api.html#a6fc9b97e764695dc6f4329ea53845e4b" title="Exports an MDL module from the database to string. ">export_module_to_string</a>(</div>
<div class="line">        transaction, <span class="stringliteral">&quot;mdl::new_module&quot;</span>, module_source.get(), context.get());</div>
<div class="line"></div>
<div class="line">    print_messages( context.get());</div>
<div class="line">    check_success( result == 0);</div>
<div class="line">    check_success( context-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__execution__context.html#a65f343d795e12da9a1ba79cbe4b3b123" title="Returns the number of error messages. ">get_error_messages_count</a>() == 0);</div>
<div class="line"></div>
<div class="line">    std::cerr &lt;&lt; module_source-&gt;get_c_str();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> MAIN_UTF8( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Access the MDL SDK</span></div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::INeuray&gt;</a> neuray( mi::examples::mdl::load_and_get_ineuray());</div>
<div class="line">    <span class="keywordflow">if</span>( !neuray.is_valid_interface())</div>
<div class="line">        exit_failure( <span class="stringliteral">&quot;Failed to load the SDK.&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Configure the MDL SDK</span></div>
<div class="line">    <span class="keywordflow">if</span>( !mi::examples::mdl::configure( neuray.get(), <span class="comment">/*mdl_paths=*/</span>{}))</div>
<div class="line">        exit_failure( <span class="stringliteral">&quot;Failed to initialize the SDK.&quot;</span>);</div>
<div class="line"></div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Start the MDL SDK</span></div>
<div class="line">        <a class="code" href="group__mi__base__types.html#gafcdcb44319b0596ee8a9a44fddaec8c6" title="32-bit signed integer. ">mi::Sint32</a> result = neuray-&gt;<a class="code" href="classmi_1_1neuraylib_1_1INeuray.html#afdd076cf54b3e1eabbd841bd1f77847b" title="Starts the operation of the MDL SDK library. ">start</a>();</div>
<div class="line">        <span class="keywordflow">if</span>( result != 0)</div>
<div class="line">            exit_failure( <span class="stringliteral">&quot;Failed to initialize the SDK. Result code: %d&quot;</span>, result);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html">mi::base::Handle&lt;mi::neuraylib::IMdl_factory&gt;</a> mdl_factory(</div>
<div class="line">            neuray-&gt;<a class="code" href="classmi_1_1neuraylib_1_1INeuray.html#a4e107568bbb0e64f61fb4b59b93607fa" title="Returns an API component from the MDL SDK API. ">get_api_component</a>&lt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html" title="Factory for various MDL interfaces and functions. ">mi::neuraylib::IMdl_factory</a>&gt;());</div>
<div class="line"></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IMdl_impexp_api&gt;</a> mdl_impexp_api(</div>
<div class="line">            neuray-&gt;<a class="code" href="classmi_1_1neuraylib_1_1INeuray.html#a4e107568bbb0e64f61fb4b59b93607fa" title="Returns an API component from the MDL SDK API. ">get_api_component</a>&lt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__impexp__api.html" title="API component for MDL related import and export operations. ">mi::neuraylib::IMdl_impexp_api</a>&gt;());</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Access the database and create a transaction.</span></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IDatabase&gt;</a> database(</div>
<div class="line">            neuray-&gt;<a class="code" href="classmi_1_1neuraylib_1_1INeuray.html#a4e107568bbb0e64f61fb4b59b93607fa" title="Returns an API component from the MDL SDK API. ">get_api_component</a>&lt;<a class="code" href="classmi_1_1neuraylib_1_1IDatabase.html" title="This interface is used to interact with the distributed database. ">mi::neuraylib::IDatabase</a>&gt;());</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IScope&gt;</a> scope( database-&gt;get_global_scope());</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html">mi::base::Handle&lt;mi::neuraylib::ITransaction&gt;</a> transaction( scope-&gt;create_transaction());</div>
<div class="line"></div>
<div class="line">        create_module( transaction.get(), mdl_impexp_api.get(), mdl_factory.get());</div>
<div class="line"></div>
<div class="line">        transaction-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html#aa4ff8152107db238986b364273bceb0c" title="Commits the transaction. ">commit</a>();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Shut down the MDL SDK</span></div>
<div class="line">    check_success( neuray-&gt;<a class="code" href="classmi_1_1neuraylib_1_1INeuray.html#a01d0574d048798c76f8e29f91a4f6fea" title="Shuts down the library. ">shutdown</a>() == 0);</div>
<div class="line">    neuray = 0;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Unload the MDL SDK</span></div>
<div class="line">    neuray = <span class="keyword">nullptr</span>;</div>
<div class="line">    <span class="keywordflow">if</span>( !mi::examples::mdl::unload())</div>
<div class="line">        exit_failure( <span class="stringliteral">&quot;Failed to unload the SDK.&quot;</span>);</div>
<div class="line"></div>
<div class="line">    exit_success();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Convert command line arguments to UTF8 on Windows</span></div>
<div class="line">COMMANDLINE_TO_UTF8</div>
</div><!-- fragment --><div align="right"> [<a class="el" href="mi_neuray_example_traversal.html">Previous</a>] [<a class="el" href="mi_neuray_examples.html">Up</a>] [<a class="el" href="mi_neuray_example_discovery.html">Next</a>] </div> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.4-->
<!-- start footer part -->
<div id="nav-path">
<span class="footeritem">5&#160;April&#160;2022,&#160;20:40, rev.358266</span>
<span class="footeritem"><a href="https://www.nvidia.com/en-us/about-nvidia/legal-info/" target="_blank" shape="rect">&copy; 2022 NVIDIA&nbsp;Corporation.</a> All rights reserved.</span>
</div>
</body>
</html>
