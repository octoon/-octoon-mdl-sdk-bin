<!-- HTML header for doxygen 1.8.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>MDL Compiler</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="images/arcicon.ico" rel="shortcut icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_custom_stylesheet_1_8_4.css" rel="stylesheet" type="text/css"/>
<link rel='stylesheet' href='webfonts/librebaskerville/stylesheet.css' type='text/css'/>
<link rel='stylesheet' href='webfonts/sourcesanspro/stylesheet.css' type='text/css'/>
<!--ARC-->
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="blackheader">
<span id="blackheader_title">MDL SDK API</span>
<span>
<img src="images/nvidia_logo_transpbg.gif" alt="nvidia_logo_transpbg.gif" style=" height:1.25em; width:6.806em;"/></span>
<span id="blackheader_uplink">
<a href='../index.html' class='top_page_nav'>Up</a>
</span>
</div>
<!--
<div id="titlearea">
   <span id="projectname">
     <a id="titlelink" href="../../index.html">
       MDL SDK API
     </a>
   </span>
     <a id="projectlogo" href="http://www.nvidia-arc.com">
       <img alt="NVIDIA logo" src="images/nvidia_logo.png" style="height:2em;">
       </a>
     <a href='../index.html' class='top_page_nav'>Up</a>
</div>
-->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('mi_neuray_compiler.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">MDL Compiler </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <a class="el" href="group__mi__neuray__mdl__compiler.html">MDL compiler</a> can generate target code for different backends, which can be accessed via the <a class="el" href="classmi_1_1neuraylib_1_1IMdl__backend__api.html#a74baca56433d61f89de6b68019b6beb5" title="Returns an MDL backend generator. ">mi::neuraylib::IMdl_backend_api::get_backend()</a> method.</p>
<p>Currently these backends are supported:</p>
<ul>
<li><code>MB_NATIVE:</code> The native (CPU) backend generating x86-64 code.</li>
<li><code>MB_CUDA_PTX:</code> The CUDA PTX backend for GPU-based CUDA and OptiX renderers.</li>
<li><code>MB_LLVM_IR:</code> The LLVM IR backend allowing to generate code for custom target platforms or just giving more control over the output.</li>
<li><code>MB_GLSL:</code> The GLSL backend for OpenGL renderers.</li>
</ul>
<p>Please refer to the <a class="el" href="mi_neuray_examples.html">Tutorial and Example Programs</a> section on how to use the backends. </p>
<h1><a class="anchor" id="mi_neuray_compilation_modes"></a>
Instance-compilation and class-compilation</h1>
<p>There are two different compilation modes to accommodate different needs: instance and class compilation. In instance compilation mode (the default) all arguments, i.e., constant expressions and call expressions, are compiled into the body of the resulting material. Hence, the resulting <a class="el" href="classmi_1_1neuraylib_1_1ICompiled__material.html" title="This interface represents a compiled material. ">mi::neuraylib::ICompiled_material</a> is parameterless. This mode offers most optimization possibilities. As a downside, even the smallest argument change requires a recompilation to target code.</p>
<p>In class compilation mode, only call expressions, i.e., the structure of the graph created by the call expression, is compiled into the body of the resulting material. The constant literals (<a class="el" href="classmi_1_1neuraylib_1_1IExpression__constant.html" title="A constant expression. ">mi::neuraylib::IExpression_constant</a>) remain as arguments of the compiled material. Note, that the parameters of a compiled material do not in general correspond to the parameters of the original material:</p>
<ul>
<li>Unused parameters will not make it into the compiled material.</li>
<li>The order is arbitrary.</li>
<li>Function calls will become part of the material. Hence, if you instantiate a material parameter <code>"int x"</code> with a call to <code>"math::max(1, 3)"</code> (prototype <code>"int math::max(int a, int b)"</code>), there will be no parameter with name <code>"x"</code> but the two constants used in the call with be turned into the parameters <code>"x.a"</code> and <code>"x.b"</code>. The constants <code>"1"</code> and <code>"3"</code> will become the default arguments of the parameters <code>"x.a"</code> and <code>"x.b"</code>, respectively. The parameter names are generated by walking the path from the material parameters to the literals and concatenating all parameter names that are visited by <code>"."</code>.</li>
</ul>
<p>When an argument of a material parameter is changed, a new compilation of the material is required. If the structure of the newly created compiled material is still unchanged, then it is not necessary to create new target code using the backends, as the code will also remain identical. Avoiding target code generation is beneficial, because it usually takes up the vast majority of compilation time. To recognize that the structure has not changed, the hash values of the compiled materials obtained via <a class="el" href="classmi_1_1neuraylib_1_1ICompiled__material.html#aa90eb28622b79831f747745c7b0c6163" title="Returns a hash of the body and all temporaries. ">mi::neuraylib::ICompiled_material::get_hash()</a> can be compared. Note, that you can also check parts of the compiled material, e.g. the expression that computes the displacement, by using <a class="el" href="classmi_1_1neuraylib_1_1ICompiled__material.html#add323fa76aa11b71829ebfc0ada40f1b" title="Returns the hash of a particular material slot. ">mi::neuraylib::ICompiled_material::get_slot_hash()</a>.</p>
<h2><a class="anchor" id="mi_neuray_compilation_modes_modify_class_args"></a>
Modifying arguments of a class-compiled material</h2>
<p>If a class-compiled material still has parameters after the compilation, the target-specific data of the arguments is available as a <a class="el" href="classmi_1_1neuraylib_1_1ITarget__argument__block.html" title="Represents an argument block of a class-compiled material compiled for a specific target...">mi::neuraylib::ITarget_argument_block</a> object returned by <a class="el" href="group__mi__neuray__mdl__compiler.html#ga21940811d1cb33be2400ee7e5bd66983" title="Get a target argument block if available. ">mi::neuraylib::ITarget_code::get_argument_block()</a>. Depending on whether the <code>execute_*</code> methods of <a class="el" href="classmi_1_1neuraylib_1_1ITarget__code.html" title="Represents target code of an MDL backend. ">mi::neuraylib::ITarget_code</a> are used or the generated code is called directly, either a <a class="el" href="classmi_1_1neuraylib_1_1ITarget__argument__block.html" title="Represents an argument block of a class-compiled material compiled for a specific target...">mi::neuraylib::ITarget_argument_block</a> object or its data must be provided. To get a modifiable block, you can either call <a class="el" href="group__mi__neuray__mdl__compiler.html#ga484318052d3c6f4e339905c73bf606a7" title="Clones the argument block (to make it writable). ">mi::neuraylib::ITarget_argument_block::clone()</a> or create a new one from a <a class="el" href="classmi_1_1neuraylib_1_1ICompiled__material.html" title="This interface represents a compiled material. ">mi::neuraylib::ICompiled_material</a> object with a matching hash via <a class="el" href="group__mi__neuray__mdl__compiler.html#ga53477194559841e30694b97d63ac7eb6" title="Create a new target argument block of the class-compiled material for this target code...">mi::neuraylib::ITarget_code::create_argument_block()</a>.</p>
<p>For direct access to the data obtained by <a class="el" href="group__mi__neuray__mdl__compiler.html#gae37212f2f0b484fc8052f01adf0c6ff4" title="Returns the target argument block data. ">mi::neuraylib::ITarget_argument_block::get_data()</a>, the layout of the data can be retrieved as a <a class="el" href="classmi_1_1neuraylib_1_1ITarget__value__layout.html" title="Represents the layout of an mi::neuraylib::ITarget_argument_block with support for nested elements...">mi::neuraylib::ITarget_value_layout</a> object from <a class="el" href="group__mi__neuray__mdl__compiler.html#ga8359a85ac66eed012aa0332a12f43e3f" title="Get a captured arguments block layout if available. ">mi::neuraylib::ITarget_code::get_argument_block_layout()</a>. Using the parameter name and argument type information from the <a class="el" href="classmi_1_1neuraylib_1_1ICompiled__material.html" title="This interface represents a compiled material. ">mi::neuraylib::ICompiled_material</a> object corresponding to the layout, the layout can be navigated with <a class="el" href="group__mi__neuray__mdl__compiler.html#ga307d4a4ec571ae47e166b59ca6820465" title="Get the layout state for the i&#39;th argument / element inside the argument value block at the given lay...">mi::neuraylib::ITarget_value_layout::get_nested_state()</a> and the offset, kind, and size of an argument or sub-element can be retrieved via <a class="el" href="group__mi__neuray__mdl__compiler.html#ga5e6285f96e35f47619ed06bee7b00215" title="Get the offset, the size and the kind of the argument / element inside the argument block at the give...">mi::neuraylib::ITarget_value_layout::get_layout()</a>.</p>
<p>So, if you wanted to get the offset of <code>"x.b"</code> in the above example case, you would search for the index for which <a class="el" href="classmi_1_1neuraylib_1_1ICompiled__material.html#a46415cda96452bab97dbaeaaea5e8ce6" title="Returns the name of a parameter. ">mi::neuraylib::ICompiled_material::get_parameter_name()</a> returns <code>"x.b"</code> and use this index to get the nested layout state for it. Providing this state to <a class="el" href="group__mi__neuray__mdl__compiler.html#ga5e6285f96e35f47619ed06bee7b00215" title="Get the offset, the size and the kind of the argument / element inside the argument block at the give...">mi::neuraylib::ITarget_value_layout::get_layout()</a> would then result in the offset of this argument within the target argument block data.</p>
<dl class="section note"><dt>Note</dt><dd>Target argument blocks and layouts are currently not used for the GLSL backend.</dd></dl>
<h1><a class="anchor" id="mi_neuray_linkmode"></a>
Link units</h1>
<p>Sometimes it is necessary to compile multiple parts of one material or several materials. Doing this one by one will result in a lot of duplicated code and data, because every compilation result is self-contained. Also when combining the generated code into one GLSL or CUDA kernel, this may fail because of multiple definitions for commonly used functions.</p>
<p>Link units (<a class="el" href="classmi_1_1neuraylib_1_1ILink__unit.html" title="Represents a link-unit of an MDL backend. ">mi::neuraylib::ILink_unit</a>) solve this problem: Instead of compiling MDL expressions separately, create a link unit via <a class="el" href="group__mi__neuray__mdl__compiler.html#ga2a47cff09fe1b7ac157f32b168fa93d2" title="Creates a new link unit. ">mi::neuraylib::IMdl_backend::create_link_unit()</a> and add expressions to it via <a class="el" href="group__mi__neuray__mdl__compiler.html#gaca63ab90c774d8a4e4e71d239d3c43c8" title="Add an MDL environment function call as a function to this link unit. ">mi::neuraylib::ILink_unit::add_environment()</a>, <a class="el" href="group__mi__neuray__mdl__compiler.html#ga4b4ea31354b2eb720814d3bbb4841ac2" title="Add an expression that is part of an MDL material instance as a function to this link unit...">mi::neuraylib::ILink_unit::add_material_expression()</a>, and <a class="el" href="group__mi__neuray__mdl__compiler.html#gac02374a1f0604aa1804a75d59b6a5eee" title="Add an MDL distribution function to this link unit. ">mi::neuraylib::ILink_unit::add_material_df()</a>. When the link unit is compiled via <a class="el" href="group__mi__neuray__mdl__compiler.html#gab2db03209c55985f122e47977364d8cf" title="Transforms a link unit to target code. ">mi::neuraylib::IMdl_backend::translate_link_unit()</a>, commonly used code and data will only be translated once. The resulting <a class="el" href="classmi_1_1neuraylib_1_1ITarget__code.html" title="Represents target code of an MDL backend. ">mi::neuraylib::ITarget_code</a> object will then contain code and data of multiple functions in the order in which they were added to the link unit. Note, that for <a class="el" href="group__mi__neuray__mdl__compiler.html#gac02374a1f0604aa1804a75d59b6a5eee" title="Add an MDL distribution function to this link unit. ">mi::neuraylib::ILink_unit::add_material_df()</a> multiple functions are added at once.</p>
<p>As target argument blocks and their layouts are not generated for all functions, you can get the block / layout index for a function via <a class="el" href="group__mi__neuray__mdl__compiler.html#ga3b64734a46cffe60913b567108f30ed3" title="Get the index of the target argument block to use with a callable function. ">mi::neuraylib::ITarget_code::get_callable_function_argument_block_index()</a>.</p>
<h1><a class="anchor" id="mi_neuray_backends_ptx"></a>
CUDA PTX Backend Specific Topics</h1>
<ul>
<li><a class="el" href="mi_neuray_ptx_texture_lookup_call_modes.html">Texture lookup call modes of the PTX backend</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.4-->
<!-- start footer part -->
<div id="nav-path">
<span class="footeritem">5&#160;April&#160;2022,&#160;20:40, rev.358266</span>
<span class="footeritem"><a href="https://www.nvidia.com/en-us/about-nvidia/legal-info/" target="_blank" shape="rect">&copy; 2022 NVIDIA&nbsp;Corporation.</a> All rights reserved.</span>
</div>
</body>
</html>
