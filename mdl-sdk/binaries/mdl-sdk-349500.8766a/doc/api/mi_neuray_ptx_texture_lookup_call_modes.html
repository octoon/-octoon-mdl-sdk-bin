<!-- HTML header for doxygen 1.8.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>Texture lookup call modes of the PTX backend</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="images/arcicon.ico" rel="shortcut icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_custom_stylesheet_1_8_4.css" rel="stylesheet" type="text/css"/>
<link rel='stylesheet' href='webfonts/librebaskerville/stylesheet.css' type='text/css'/>
<link rel='stylesheet' href='webfonts/sourcesanspro/stylesheet.css' type='text/css'/>
<!--ARC-->
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="blackheader">
<span id="blackheader_title">MDL SDK API</span>
<span>
<img src="images/nvidia_logo_transpbg.gif" alt="nvidia_logo_transpbg.gif" style=" height:1.25em; width:6.806em;"/></span>
<span id="blackheader_uplink">
<a href='../index.html' class='top_page_nav'>Up</a>
</span>
</div>
<!--
<div id="titlearea">
   <span id="projectname">
     <a id="titlelink" href="../../index.html">
       MDL SDK API
     </a>
   </span>
     <a id="projectlogo" href="http://www.nvidia-arc.com">
       <img alt="NVIDIA logo" src="images/nvidia_logo.png" style="height:2em;">
       </a>
     <a href='../index.html' class='top_page_nav'>Up</a>
</div>
-->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('mi_neuray_ptx_texture_lookup_call_modes.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Texture lookup call modes of the PTX backend </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The PTX backend allows to configure how texture lookup methods are called in the generated code.</p>
<p>The mode can be chosen by setting the <code>"tex_lookup_call_mode"</code> option via the <a class="el" href="group__mi__neuray__mdl__compiler.html#ga1301dec05ba862ca7745814367811f15" title="Sets a backend option. ">mi::neuraylib::IMdl_backend::set_option()</a> method to one of the modes described in the next sections:</p>
<ul>
<li><code>"vtable"</code> </li>
<li><code>"direct_call"</code> </li>
<li><code>"optix_cp"</code> </li>
</ul>
<p>Depending on the mode, the generated code makes different use of <a class="el" href="structmi_1_1neuraylib_1_1Resource__data.html" title="The data structure providing access to resources for generated code. ">mi::neuraylib::Resource_data</a> parameter <code>res_data</code> which has to be provided to the generated code by the renderer:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Resource_data {</div>
<div class="line">    <span class="keywordtype">void</span> <span class="keyword">const</span>                 *shared_data;</div>
<div class="line">    <span class="keyword">const</span> Texture_handler_base *texture_handler;</div>
<div class="line">};</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>The <code>shared_data</code> field is currently unused and should always be NULL.</dd></dl>
<h1><a class="anchor" id="mi_neuray_ptx_texture_lookup_call_modes_vtable"></a>
"vtable" mode</h1>
<p>This is the default mode. In this mode, the <code>texture_handler</code> field of the <code>res_data</code> parameter has to point to a customizable structure that can be derived from <a class="el" href="structmi_1_1neuraylib_1_1Texture__handler__base.html" title="The texture handler structure that is passed to the texturing functions. ">mi::neuraylib::Texture_handler_base</a>.</p>
<p>The only requirement is that the first field of this structure is a pointer to a vtable (table of function pointers) pointing to the texture access functions (see below). Any additional data needed by your implementation can be appended after the vtable. The texture access functions can access the structure via the <code>self</code> parameter.</p>
<p>The retrieved texture value should be stored in the <code>result</code> parameter.</p>
<p>The <code>texture_idx</code> parameter is the index of the texture resource according to the <a class="el" href="group__mi__neuray__mdl__compiler.html#ga9981716cff2ab0dada7d3b5288c9afb4" title="Returns the name of a texture resource used by the target code. ">mi::neuraylib::ITarget_code::get_texture()</a> function. Note that index 0 is always the invalid texture.</p>
<p>Please refer to the MDL specification (section 20.3) for an explanation of the other parameters.</p>
<div class="fragment"><div class="line"><span class="comment">// The wrap mode determines the texture lookup behavior if a lookup coordinate</span></div>
<div class="line"><span class="comment">// is exceeding the normalized half-open texture space range of [0, 1).</span></div>
<div class="line"><span class="keyword">enum</span> Tex_wrap_mode {</div>
<div class="line">    wrap_clamp           = 0,  <span class="comment">// clamps the lookup coordinate to the range</span></div>
<div class="line">    wrap_repeat          = 1,  <span class="comment">// takes the fractional part of the lookup coordinate</span></div>
<div class="line">                               <span class="comment">// effectively repeating the texture along this axis</span></div>
<div class="line">    wrap_mirrored_repeat = 2,  <span class="comment">// like wrap_repeat but takes one minus the fractional</span></div>
<div class="line">                               <span class="comment">// part every other interval to mirror every second</span></div>
<div class="line">                               <span class="comment">// instance of the texture</span></div>
<div class="line">    wrap_clip            = 3   <span class="comment">// makes the texture lookup return zero for texture</span></div>
<div class="line">                               <span class="comment">// coordinates outside of the range</span></div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">// The vtable for the texture handler.</span></div>
<div class="line"><span class="keyword">struct </span><a class="code" href="group__mi__neuray__mdl__compiler.html#gacd6903f2378abb2efba6a6ff939b261b" title="The texture handler vtable struct. ">Texture_handler_vtable</a> {</div>
<div class="line">    void (*m_tex_lookup_float4_2d)(</div>
<div class="line">        <span class="keywordtype">float</span>                       result[4],</div>
<div class="line">        Texture_handler_base <span class="keyword">const</span> *<span class="keyword">self</span>,</div>
<div class="line">        <span class="keywordtype">unsigned</span>                    texture_idx,</div>
<div class="line">        <span class="keywordtype">float</span> <span class="keyword">const</span>                 coord[2],</div>
<div class="line">        Tex_wrap_mode               wrap_u,</div>
<div class="line">        Tex_wrap_mode               wrap_v,</div>
<div class="line">        <span class="keywordtype">float</span> <span class="keyword">const</span>                 crop_u[2],</div>
<div class="line">        <span class="keywordtype">float</span> <span class="keyword">const</span>                 crop_v[2]);</div>
<div class="line"></div>
<div class="line">    void (*m_tex_lookup_float3_2d)(</div>
<div class="line">        <span class="keywordtype">float</span>                       result[3],</div>
<div class="line">        Texture_handler_base <span class="keyword">const</span> *<span class="keyword">self</span>,</div>
<div class="line">        <span class="keywordtype">unsigned</span>                    texture_idx,</div>
<div class="line">        <span class="keywordtype">float</span> <span class="keyword">const</span>                 coord[2],</div>
<div class="line">        Tex_wrap_mode               wrap_u,</div>
<div class="line">        Tex_wrap_mode               wrap_v,</div>
<div class="line">        <span class="keywordtype">float</span> <span class="keyword">const</span>                 crop_u[2],</div>
<div class="line">        <span class="keywordtype">float</span> <span class="keyword">const</span>                 crop_v[2]);</div>
<div class="line"></div>
<div class="line">    void (*m_tex_texel_float4_2d)(</div>
<div class="line">        <span class="keywordtype">float</span>                       result[4],</div>
<div class="line">        Texture_handler_base <span class="keyword">const</span> *<span class="keyword">self</span>,</div>
<div class="line">        <span class="keywordtype">unsigned</span>                    texture_idx,</div>
<div class="line">        <span class="keywordtype">int</span> <span class="keyword">const</span>                   coord[2],</div>
<div class="line">        <span class="keywordtype">int</span> <span class="keyword">const</span>                   uv_tile[2]);</div>
<div class="line"></div>
<div class="line">    void (*m_tex_lookup_float4_3d)(</div>
<div class="line">        <span class="keywordtype">float</span>                       result[4],</div>
<div class="line">        Texture_handler_base <span class="keyword">const</span> *<span class="keyword">self</span>,</div>
<div class="line">        <span class="keywordtype">unsigned</span>                    texture_idx,</div>
<div class="line">        <span class="keywordtype">float</span> <span class="keyword">const</span>                 coord[3],</div>
<div class="line">        Tex_wrap_mode               wrap_u,</div>
<div class="line">        Tex_wrap_mode               wrap_v,</div>
<div class="line">        Tex_wrap_mode               wrap_w,</div>
<div class="line">        <span class="keywordtype">float</span> <span class="keyword">const</span>                 crop_u[2],</div>
<div class="line">        <span class="keywordtype">float</span> <span class="keyword">const</span>                 crop_v[2],</div>
<div class="line">        <span class="keywordtype">float</span> <span class="keyword">const</span>                 crop_w[2]);</div>
<div class="line"></div>
<div class="line">    void (*m_tex_lookup_float3_3d)(</div>
<div class="line">        <span class="keywordtype">float</span>                       result[3],</div>
<div class="line">        Texture_handler_base <span class="keyword">const</span> *<span class="keyword">self</span>,</div>
<div class="line">        <span class="keywordtype">unsigned</span>                    texture_idx,</div>
<div class="line">        <span class="keywordtype">float</span> <span class="keyword">const</span>                 coord[3],</div>
<div class="line">        Tex_wrap_mode               wrap_u,</div>
<div class="line">        Tex_wrap_mode               wrap_v,</div>
<div class="line">        Tex_wrap_mode               wrap_w,</div>
<div class="line">        <span class="keywordtype">float</span> <span class="keyword">const</span>                 crop_u[2],</div>
<div class="line">        <span class="keywordtype">float</span> <span class="keyword">const</span>                 crop_v[2],</div>
<div class="line">        <span class="keywordtype">float</span> <span class="keyword">const</span>                 crop_w[2]);</div>
<div class="line"></div>
<div class="line">    void (*m_tex_texel_float4_3d)(</div>
<div class="line">        <span class="keywordtype">float</span>                       result[4],</div>
<div class="line">        Texture_handler_base <span class="keyword">const</span> *<span class="keyword">self</span>,</div>
<div class="line">        <span class="keywordtype">unsigned</span>                    texture_idx,</div>
<div class="line">        <span class="keywordtype">int</span> <span class="keyword">const</span>                   coord[3]);</div>
<div class="line"></div>
<div class="line">    void (*m_tex_lookup_float4_cube)(</div>
<div class="line">        <span class="keywordtype">float</span>                       result[4],</div>
<div class="line">        Texture_handler_base <span class="keyword">const</span> *<span class="keyword">self</span>,</div>
<div class="line">        <span class="keywordtype">unsigned</span>                    texture_idx,</div>
<div class="line">        <span class="keywordtype">float</span> <span class="keyword">const</span>                 coord[3]);</div>
<div class="line"></div>
<div class="line">    void (*m_tex_lookup_float3_cube)(</div>
<div class="line">        <span class="keywordtype">float</span>                       result[3],</div>
<div class="line">        Texture_handler_base <span class="keyword">const</span> *<span class="keyword">self</span>,</div>
<div class="line">        <span class="keywordtype">unsigned</span>                    texture_idx,</div>
<div class="line">        <span class="keywordtype">float</span> <span class="keyword">const</span>                 coord[3]);</div>
<div class="line"></div>
<div class="line">    void (*m_tex_resolution_2d)(</div>
<div class="line">        <span class="keywordtype">int</span>                        result[2],</div>
<div class="line">        Texture_handler_base <span class="keyword">const</span> *<span class="keyword">self</span>,</div>
<div class="line">        <span class="keywordtype">unsigned</span>                   texture_idx,</div>
<div class="line">        <span class="keywordtype">int</span> <span class="keyword">const</span>                  uv_tile[2]);</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">// Your texture handler structure.</span></div>
<div class="line"><span class="keyword">struct </span>Texture_handler : <span class="keyword">public</span> Texture_handler_base {</div>
<div class="line">    <span class="comment">// additional data for the texture access functions can be provided here</span></div>
<div class="line">    <span class="keywordtype">int</span>  example_field;</div>
<div class="line">};</div>
</div><!-- fragment --><h1><a class="anchor" id="mi_neuray_ptx_texture_lookup_call_modes_direct_call"></a>
"direct_call" mode</h1>
<p>In this mode, the texture access functions will be called directly in the PTX code. The implementations must be linked to the generated code.</p>
<p>The expected prototypes correspond to the prototypes in the <code>Texture_handler_vtable</code> structure of the vtable, except that the <code>Texture_handler</code> structure is not required to contain the <code>vtable</code> field. The <code>texture_handler</code> field of the <a class="el" href="structmi_1_1neuraylib_1_1Resource__data.html" title="The data structure providing access to resources for generated code. ">mi::neuraylib::Resource_data</a> structure may be NULL, if your implementation does not need it.</p>
<p>Here are the CUDA prototypes of the functions you have to implement:</p>
<div class="fragment"><div class="line"><span class="comment">// Your texture handler structure.</span></div>
<div class="line"><span class="keyword">struct </span>Texture_handler : <span class="keyword">public</span> Texture_handler_base {</div>
<div class="line">    <span class="comment">// additional data for the texture access functions can be provided here</span></div>
<div class="line">    <span class="keywordtype">int</span>  example_field;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> __device__ <span class="keywordtype">void</span> tex_lookup_float4_2d(</div>
<div class="line">    <span class="keywordtype">float</span>                   result[4],</div>
<div class="line">    Texture_handler <span class="keyword">const</span>  *<span class="keyword">self</span>,</div>
<div class="line">    <span class="keywordtype">unsigned</span>                texture_idx,</div>
<div class="line">    <span class="keywordtype">float</span> <span class="keyword">const</span>             coord[2],</div>
<div class="line">    Tex_wrap_mode           wrap_u,</div>
<div class="line">    Tex_wrap_mode           wrap_v,</div>
<div class="line">    <span class="keywordtype">float</span> <span class="keyword">const</span>             crop_u[2],</div>
<div class="line">    <span class="keywordtype">float</span> <span class="keyword">const</span>             crop_v[2]);</div>
<div class="line"></div>
<div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> __device__ <span class="keywordtype">void</span> tex_lookup_float3_2d(</div>
<div class="line">    <span class="keywordtype">float</span>                   result[3],</div>
<div class="line">    Texture_handler <span class="keyword">const</span>  *<span class="keyword">self</span>,</div>
<div class="line">    <span class="keywordtype">unsigned</span>                texture_idx,</div>
<div class="line">    <span class="keywordtype">float</span> <span class="keyword">const</span>             coord[2],</div>
<div class="line">    Tex_wrap_mode           wrap_u,</div>
<div class="line">    Tex_wrap_mode           wrap_v,</div>
<div class="line">    <span class="keywordtype">float</span> <span class="keyword">const</span>             crop_u[2],</div>
<div class="line">    <span class="keywordtype">float</span> <span class="keyword">const</span>             crop_v[2]);</div>
<div class="line"></div>
<div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> __device__ <span class="keywordtype">void</span> tex_texel_float4_2d(</div>
<div class="line">    <span class="keywordtype">float</span>                   result[4],</div>
<div class="line">    Texture_handler <span class="keyword">const</span>  *<span class="keyword">self</span>,</div>
<div class="line">    <span class="keywordtype">unsigned</span>                texture_idx,</div>
<div class="line">    <span class="keywordtype">int</span> <span class="keyword">const</span>               coord[2]);</div>
<div class="line"></div>
<div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> __device__ <span class="keywordtype">void</span> tex_lookup_float4_3d(</div>
<div class="line">    <span class="keywordtype">float</span>                   result[4],</div>
<div class="line">    Texture_handler <span class="keyword">const</span>  *<span class="keyword">self</span>,</div>
<div class="line">    <span class="keywordtype">unsigned</span>                texture_idx,</div>
<div class="line">    <span class="keywordtype">float</span> <span class="keyword">const</span>             coord[3],</div>
<div class="line">    Tex_wrap_mode           wrap_u,</div>
<div class="line">    Tex_wrap_mode           wrap_v,</div>
<div class="line">    Tex_wrap_mode           wrap_w,</div>
<div class="line">    <span class="keywordtype">float</span> <span class="keyword">const</span>             crop_u[2],</div>
<div class="line">    <span class="keywordtype">float</span> <span class="keyword">const</span>             crop_v[2],</div>
<div class="line">    <span class="keywordtype">float</span> <span class="keyword">const</span>             crop_w[2]);</div>
<div class="line"></div>
<div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> __device__ <span class="keywordtype">void</span> tex_lookup_float3_3d(</div>
<div class="line">    <span class="keywordtype">float</span>                   result[3],</div>
<div class="line">    Texture_handler <span class="keyword">const</span>  *<span class="keyword">self</span>,</div>
<div class="line">    <span class="keywordtype">unsigned</span>                texture_idx,</div>
<div class="line">    <span class="keywordtype">float</span> <span class="keyword">const</span>             coord[3],</div>
<div class="line">    Tex_wrap_mode           wrap_u,</div>
<div class="line">    Tex_wrap_mode           wrap_v,</div>
<div class="line">    Tex_wrap_mode           wrap_w,</div>
<div class="line">    <span class="keywordtype">float</span> <span class="keyword">const</span>             crop_u[2],</div>
<div class="line">    <span class="keywordtype">float</span> <span class="keyword">const</span>             crop_v[2],</div>
<div class="line">    <span class="keywordtype">float</span> <span class="keyword">const</span>             crop_w[2]);</div>
<div class="line"></div>
<div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> __device__ <span class="keywordtype">void</span> tex_texel_float4_3d(</div>
<div class="line">    <span class="keywordtype">float</span>                   result[4],</div>
<div class="line">    Texture_handler <span class="keyword">const</span>  *<span class="keyword">self</span>,</div>
<div class="line">    <span class="keywordtype">unsigned</span>                texture_idx,</div>
<div class="line">    <span class="keywordtype">int</span> <span class="keyword">const</span>               coord[3]);</div>
<div class="line"></div>
<div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> __device__ <span class="keywordtype">void</span> tex_lookup_float4_cube(</div>
<div class="line">    <span class="keywordtype">float</span>                   result[4],</div>
<div class="line">    Texture_handler <span class="keyword">const</span>  *<span class="keyword">self</span>,</div>
<div class="line">    <span class="keywordtype">unsigned</span>                texture_idx,</div>
<div class="line">    <span class="keywordtype">float</span> <span class="keyword">const</span>             coord[3]);</div>
<div class="line"></div>
<div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> __device__ <span class="keywordtype">void</span> tex_lookup_float3_cube(</div>
<div class="line">    <span class="keywordtype">float</span>                   result[3],</div>
<div class="line">    Texture_handler <span class="keyword">const</span>  *<span class="keyword">self</span>,</div>
<div class="line">    <span class="keywordtype">unsigned</span>                texture_idx,</div>
<div class="line">    <span class="keywordtype">float</span> <span class="keyword">const</span>             coord[3]);</div>
<div class="line"></div>
<div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> __device__ <span class="keywordtype">void</span> tex_resolution_2d(</div>
<div class="line">    <span class="keywordtype">int</span>                     result[2],</div>
<div class="line">    Texture_handler <span class="keyword">const</span>  *<span class="keyword">self</span>,</div>
<div class="line">    <span class="keywordtype">unsigned</span>                texture_idx,</div>
<div class="line">    <span class="keywordtype">int</span> <span class="keyword">const</span>               uv_tile[2]);</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>You have to declare the implementations as <code>extern</code> "C" when using CUDA code to avoid name mangling.</dd></dl>
<h1><a class="anchor" id="mi_neuray_ptx_texture_lookup_call_modes_optix_cp"></a>
"optix_cp" mode</h1>
<p>This mode is meant for applications using the OptiX 6 framework (for OptiX 7, the <code>"direct_call"</code> mode is recommended). In this mode, the generated code will contain OptiX <code>rtCallableProgramId</code> variables which have to be set to the texture access functions like this (<code>mdl_textures_ptx_path</code> is the path to a PTX file containing the implementations of the texture access functions, <code>mdl_expr_prog</code> is the OptiX program created from the PTX code generated for the material sub-expression):</p>
<div class="fragment"><div class="line"><span class="comment">// Set up the texture access functions for the MDL expression code.</span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *tex_prog_names[] = {</div>
<div class="line">    <span class="stringliteral">&quot;tex_lookup_float4_2d&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;tex_lookup_float3_2d&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;tex_texel_float4_2d&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;tex_lookup_float4_3d&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;tex_lookup_float3_3d&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;tex_texel_float4_3d&quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;tex_lookup_float4_cube&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;tex_lookup_float3_cube&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;tex_resolution_2d&quot;</span></div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <span class="keyword">sizeof</span>(tex_prog_names) / <span class="keyword">sizeof</span>(*tex_prog_names); ++i) {</div>
<div class="line">    optix::Program tex_prog = m_optix_ctx-&gt;createProgramFromPTXFile(</div>
<div class="line">        mdl_textures_ptx_path, tex_prog_names[i]);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// your code should set any required variables in the texture access program here,</span></div>
<div class="line">    <span class="comment">// like a buffer of texture sampler IDs for the used textures</span></div>
<div class="line"></div>
<div class="line">    tex_prog[<span class="stringliteral">&quot;texture_sampler_ids&quot;</span>]-&gt;set(tex_samplers);</div>
<div class="line">    mdl_expr_prog[tex_prog_names[i]]-&gt;setProgramId(tex_prog);</div>
<div class="line">}</div>
</div><!-- fragment --><p>In this example, the names of the methods in the PTX file referenced by <code>mdl_textures_ptx_path</code> are identical to the names of the needed OptiX variables, but this is not required.</p>
<p>The prototypes of the functions are identical to the <code>"direct_call"</code> mode except that <code>extern "C" __device__</code> is replaced by <code>RT_CALLABLE_PROGRAM</code>. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.4-->
<!-- start footer part -->
<div id="nav-path">
<span class="footeritem">5&#160;April&#160;2022,&#160;20:40, rev.358266</span>
<span class="footeritem"><a href="https://www.nvidia.com/en-us/about-nvidia/legal-info/" target="_blank" shape="rect">&copy; 2022 NVIDIA&nbsp;Corporation.</a> All rights reserved.</span>
</div>
</body>
</html>
