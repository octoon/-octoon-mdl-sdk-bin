<!-- HTML header for doxygen 1.8.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>Example for Integrating the MDL Encapsulated Format</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="images/arcicon.ico" rel="shortcut icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_custom_stylesheet_1_8_4.css" rel="stylesheet" type="text/css"/>
<link rel='stylesheet' href='webfonts/librebaskerville/stylesheet.css' type='text/css'/>
<link rel='stylesheet' href='webfonts/sourcesanspro/stylesheet.css' type='text/css'/>
<!--ARC-->
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="blackheader">
<span id="blackheader_title">MDL SDK API</span>
<span>
<img src="images/nvidia_logo_transpbg.gif" alt="nvidia_logo_transpbg.gif" style=" height:1.25em; width:6.806em;"/></span>
<span id="blackheader_uplink">
<a href='../index.html' class='top_page_nav'>Up</a>
</span>
</div>
<!--
<div id="titlearea">
   <span id="projectname">
     <a id="titlelink" href="../../index.html">
       MDL SDK API
     </a>
   </span>
     <a id="projectlogo" href="http://www.nvidia-arc.com">
       <img alt="NVIDIA logo" src="images/nvidia_logo.png" style="height:2em;">
       </a>
     <a href='../index.html' class='top_page_nav'>Up</a>
</div>
-->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('mi_neuray_example_mdle.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Example for Integrating the MDL Encapsulated Format </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div align="right"> [<a class="el" href="mi_neuray_example_mdl_browser.html">Previous</a>] [<a class="el" href="mi_neuray_examples.html">Up</a>] [<a class="el" href="mi_neuray_example_dxr.html">Next</a>] </div><p>This example illustrates the export of materials to the MDL encapsulated format as well as loading a material from an MDLE.</p>
<h1><a class="anchor" id="example_mdle_new"></a>
New Topics</h1>
<ul>
<li>Creating an MDLE from an existing material</li>
<li>Changing default values for parameters</li>
<li>Adding a thumbnail image and additional user files</li>
<li>Checking the file integrity of an existing MDLE</li>
<li>Loading an MDLE module and getting the main material/function</li>
</ul>
<h1><a class="anchor" id="example_mdle_descr"></a>
Detailed Description</h1>
<dl>
<dt><b> Creating an MDLE </b> </dt>
<dd><p class="startdd"><br/>
 Core of the creation process is the <a class="el" href="classmi_1_1neuraylib_1_1IMdle__api.html" title="Provides access to functions related to the creation of encapsulated MDL modules (MDLE). ">mi::neuraylib::IMdle_api</a> and the <code>Mdle_data</code> structure. A new instance of this structure is created using an <a class="el" href="classmi_1_1neuraylib_1_1ITransaction.html" title="A transaction provides a consistent view on the database. ">mi::neuraylib::ITransaction</a>: </p>
<div class="fragment"><div class="line"><a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::IStructure&gt;</a> data(transaction-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html#ad1b8ce71d7a6fea1f59573325dba126c" title="Creates an object of the type type_name. ">create</a>&lt;<a class="code" href="classmi_1_1IStructure.html" title="This interface represents structures, i.e., a key-value based data structure. ">mi::IStructure</a>&gt;(<span class="stringliteral">&quot;Mdle_data&quot;</span>));</div>
</div><!-- fragment --><p> The fields of the structure describe the content of the MDLE to create. This includes the future main material or function which is specified by passing the database name of an existing function definition of function call in the <code>prototype_name</code> field. </p>
<div class="fragment"><div class="line"><span class="comment">// get access to the prototype_name field</span></div>
<div class="line"><a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::IString&gt;</a> prototype(data-&gt;get_value&lt;<a class="code" href="classmi_1_1IString.html" title="A simple string class. ">mi::IString</a>&gt;(<span class="stringliteral">&quot;prototype_name&quot;</span>));</div>
<div class="line"><span class="comment">// set a material definition</span></div>
<div class="line">prototype-&gt;set_c_str(<span class="stringliteral">&quot;mdl::nvidia::sdk_examples::tutorials::example_mod_rough&quot;</span>);</div>
</div><!-- fragment --><p> Depending on the selected prototype, different default parameters are generated for the future main material/function. In case a definition is provided, the default values of the definitions are copied. In case of an material instance or a function call, the arguments that have been applied during the instantiation are used instead. To override these defaults, a new <a class="el" href="classmi_1_1neuraylib_1_1IExpression__list.html" title="An ordered collection of expressions identified by name or index. ">mi::neuraylib::IExpression_list</a> is created and new expressions are added for the parameters to override. Finally, the created list is set to the <code>defaults</code> field of the <code>Mdle_data</code> structure. </p>
<div class="fragment"><div class="line"><span class="comment">// create a new set of named parameters</span></div>
<div class="line"><a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression_list&gt;</a> defaults(expression_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#af0b7dbd66ce98752e05c51e350678a78" title="Creates a new expression list. ">create_expression_list</a>());</div>
<div class="line"><span class="comment">// set a new tint value</span></div>
<div class="line"><a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IValue_color&gt;</a> tint_value(value_factory-&gt;create_color(0.25f, 0.5f, 0.75f));</div>
<div class="line"><a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression_constant&gt;</a> tint_expr(expression_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#a774749a982e8b8e8910e01e11ec39d59" title="Creates a constant (mutable). ">create_constant</a>(tint_value.get()));</div>
<div class="line">defaults-&gt;add_expression(<span class="stringliteral">&quot;tint&quot;</span>, tint_expr.get());</div>
<div class="line"><span class="comment">// pass the defaults the Mdle_data structure</span></div>
<div class="line">data-&gt;set_value(<span class="stringliteral">&quot;defaults&quot;</span>, defaults.get());</div>
</div><!-- fragment --><p> Note, that all parameters need to be set to create an MDLE. This allows a drag-and-drop workflow and out-of-the-box usage without further setup.</p>
<p>Optionally, a thumbnail can be added to the MDLE. Since there is a high chance of changed default parameters, existing thumbnail images are not added automatically. Instead, the path to the correct thumbnail needs to be added manually. This path can either be relative to a search path or a file system path. </p>
<div class="fragment"><div class="line"><span class="comment">// get access to the thumbnail_path field</span></div>
<div class="line"><a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::IString&gt;</a> thumbnail(data-&gt;get_value&lt;<a class="code" href="classmi_1_1IString.html" title="A simple string class. ">mi::IString</a>&gt;(<span class="stringliteral">&quot;thumbnail_path&quot;</span>));</div>
<div class="line"><span class="comment">// set the image path</span></div>
<div class="line">thumbnail-&gt;set_c_str(<span class="stringliteral">&quot;/nvidia/sdk_examples/resources/example_thumbnail.png&quot;</span>);</div>
</div><!-- fragment --><p> Besides the thumbnail arbitrary user files can be added using an array of <code>Mdle_user_file</code> structures. Each of those has a <code>source_path</code> field to select the file to add. Again, this can either be relative to a search path or a file system path. The second field, <code>target_path</code>, specifies the path in the created MDLE relative to the root.</p>
<p>To trigger the actual MDLE export, the <code>Mdle_data</code> structure, along with a target file path, is passed to <a class="el" href="classmi_1_1neuraylib_1_1IMdle__api.html#a04ad47adce57fb05602663a08b2c5dfc" title="Exports a new MDLE file to disk. ">mi::neuraylib::IMdle_api::export_mdle</a> provided by the MDLE API component: </p>
<div class="fragment"><div class="line"><span class="comment">// get the MDLE api component</span></div>
<div class="line"><a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IMdle_api&gt;</a> mdle_api(neuray-&gt;<a class="code" href="classmi_1_1neuraylib_1_1INeuray.html#a4e107568bbb0e64f61fb4b59b93607fa" title="Returns an API component from the MDL SDK API. ">get_api_component</a>&lt;<a class="code" href="classmi_1_1neuraylib_1_1IMdle__api.html" title="Provides access to functions related to the creation of encapsulated MDL modules (MDLE). ">mi::neuraylib::IMdle_api</a>&gt;());</div>
<div class="line"><span class="comment">// export the material</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* mdle_file_name = <span class="stringliteral">&quot;example_material_blue.mdle&quot;</span>;</div>
<div class="line">mdle_api-&gt;export_mdle(transaction.get(), mdle_file_name, data.get(), context.get());</div>
<div class="line"><span class="comment">// ... check context for errors and warnings</span></div>
</div><!-- fragment --><p> Analogously, functions can be exported to MDLE, too. Note, that the database name of functions consists of the function name itself followed by its parameter list.</p>
<p class="enddd"></p>
</dd>
<dt><b> Checking the integrity of existing MDLE files </b> </dt>
<dd><p class="startdd"><br/>
 Each file in an MDLE is stored along with a MD5 hash and the MDLE itself has a 8 byte header that contains the letters <code>MDLE</code> and a version number. Both, header and hashes can be checked using the <a class="el" href="classmi_1_1neuraylib_1_1IMdle__api.html#aa84030a342fe2766dda356f44fbe6893" title="Checks the integrity of an MDLE file based on MD5 hashes that are stored for the contained files...">mi::neuraylib::IMdle_api::validate_mdle</a> function of the MDLE API component. </p>
<div class="fragment"><div class="line"><span class="comment">// get the MDLE api component</span></div>
<div class="line"><a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IMdle_api&gt;</a> mdle_api(neuray-&gt;<a class="code" href="classmi_1_1neuraylib_1_1INeuray.html#a4e107568bbb0e64f61fb4b59b93607fa" title="Returns an API component from the MDL SDK API. ">get_api_component</a>&lt;<a class="code" href="classmi_1_1neuraylib_1_1IMdle__api.html" title="Provides access to functions related to the creation of encapsulated MDL modules (MDLE). ">mi::neuraylib::IMdle_api</a>&gt;());</div>
<div class="line"><span class="comment">// export the material</span></div>
<div class="line">std::string mdle_path = get_working_directory() + <span class="stringliteral">&quot;/example_material_blue.mdle&quot;</span>;</div>
<div class="line"><a class="code" href="group__mi__base__types.html#gafcdcb44319b0596ee8a9a44fddaec8c6" title="32-bit signed integer. ">mi::Sint32</a> res = mdle_api-&gt;validate_mdle(mdle_path.c_str(), context.get());</div>
</div><!-- fragment --><p> The return value as well as the <code>context</code> can be checked in order to see whether the file is valid.</p>
<p class="enddd"></p>
</dd>
<dt><b> Loading and MDLE material or function </b> </dt>
<dd><p class="startdd"><br/>
 In order to simplify the integration of MDLE into existing systems, an MDLE file is loaded like any other MDL module. Therefore the absolute file path to the MDLE is passed instead of a qualified module name. </p>
<div class="fragment"><div class="line">std::string mdle_path = get_working_directory() + <span class="stringliteral">&quot;/example_material_blue.mdle&quot;</span>;</div>
<div class="line">mdl_compiler-&gt;load_module(transaction.get(), mdle_path.c_str(), context.get());</div>
<div class="line"><span class="comment">// ... check context for errors and warnings</span></div>
</div><!-- fragment --><p> After successfully loading the module, the main function is available in the database. To identify MDLE elements, there is an <code>mdle</code> prefix instead of the usual <code>mdl</code>. The prefix is followed by the normalized MDLE file path (using forward slashes and a leading slash), followed by the material/function name. Note, that function names again have their parameter list appended. The sample contains helper functions to construct these database names: </p>
<div class="fragment"><div class="line">std::string db_name_mat = mdle_to_db_name(mdle_path);</div>
<div class="line">std::string db_name_func = mdle_to_db_name_with_signature(transaction.get(), mdle_path);</div>
</div><!-- fragment --><p> From that point, the functions and materials can be used as any other MDL function or material.</p>
<p class="enddd"></p>
</dd>
</dl>
<h1><a class="anchor" id="example_mdle"></a>
Example Source</h1>
<p><b>Source Code Location:</b> <code>examples/mdl_sdk/mdle/example_mdle.cpp</code></p>
<div class="fragment"><div class="line"><span class="comment">/******************************************************************************</span></div>
<div class="line"><span class="comment"> * Copyright 2022 NVIDIA Corporation. All rights reserved.</span></div>
<div class="line"><span class="comment"> *****************************************************************************/</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// examples/mdl_sdk/mdle/example_mdle.cpp</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Access the MDLE API and create MDLE files from existing mdl materials or functions.</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Include code shared by all examples.</span></div>
<div class="line"><span class="preprocessor">#include &quot;example_shared.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> MAIN_UTF8( <span class="keywordtype">int</span> <span class="comment">/*argc*/</span>, <span class="keywordtype">char</span>* <span class="comment">/*argv*/</span>[])</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Access the MDL SDK</span></div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::INeuray&gt;</a> neuray(mi::examples::mdl::load_and_get_ineuray());</div>
<div class="line">    <span class="keywordflow">if</span> (!neuray.is_valid_interface())</div>
<div class="line">        exit_failure(<span class="stringliteral">&quot;Failed to load the SDK.&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Configure the MDL SDK</span></div>
<div class="line">    <span class="keywordflow">if</span> (!mi::examples::mdl::configure(neuray.get()))</div>
<div class="line">        exit_failure(<span class="stringliteral">&quot;Failed to initialize the SDK.&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Start the MDL SDK</span></div>
<div class="line">    <a class="code" href="group__mi__base__types.html#gafcdcb44319b0596ee8a9a44fddaec8c6" title="32-bit signed integer. ">mi::Sint32</a> ret = neuray-&gt;<a class="code" href="classmi_1_1neuraylib_1_1INeuray.html#afdd076cf54b3e1eabbd841bd1f77847b" title="Starts the operation of the MDL SDK library. ">start</a>();</div>
<div class="line">    <span class="keywordflow">if</span> (ret != 0)</div>
<div class="line">        exit_failure(<span class="stringliteral">&quot;Failed to initialize the SDK. Result code: %d&quot;</span>, ret);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Access the database and create a transaction.</span></div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IDatabase&gt;</a> database(</div>
<div class="line">            neuray-&gt;<a class="code" href="classmi_1_1neuraylib_1_1INeuray.html#a4e107568bbb0e64f61fb4b59b93607fa" title="Returns an API component from the MDL SDK API. ">get_api_component</a>&lt;<a class="code" href="classmi_1_1neuraylib_1_1IDatabase.html" title="This interface is used to interact with the distributed database. ">mi::neuraylib::IDatabase</a>&gt;());</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IScope&gt;</a> scope(database-&gt;get_global_scope());</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html">mi::base::Handle&lt;mi::neuraylib::ITransaction&gt;</a> transaction(scope-&gt;create_transaction());</div>
<div class="line"></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IMdl_impexp_api&gt;</a> mdl_impexp_api(</div>
<div class="line">            neuray-&gt;<a class="code" href="classmi_1_1neuraylib_1_1INeuray.html#a4e107568bbb0e64f61fb4b59b93607fa" title="Returns an API component from the MDL SDK API. ">get_api_component</a>&lt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__impexp__api.html" title="API component for MDL related import and export operations. ">mi::neuraylib::IMdl_impexp_api</a>&gt;());</div>
<div class="line"></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html">mi::base::Handle&lt;mi::neuraylib::IMdl_factory&gt;</a> mdl_factory(</div>
<div class="line">            neuray-&gt;<a class="code" href="classmi_1_1neuraylib_1_1INeuray.html#a4e107568bbb0e64f61fb4b59b93607fa" title="Returns an API component from the MDL SDK API. ">get_api_component</a>&lt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html" title="Factory for various MDL interfaces and functions. ">mi::neuraylib::IMdl_factory</a>&gt;());</div>
<div class="line"></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle &lt; mi::neuraylib::IMdl_execution_context&gt;</a> context(</div>
<div class="line">            mdl_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html#a78a9a6489592c90ea49e0fe0ac8be235" title="Creates an execution context. ">create_execution_context</a>());</div>
<div class="line"></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IType_factory&gt;</a> type_factory(</div>
<div class="line">            mdl_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html#ae32b4ecd78cbbe5212f8daf1552180c3" title="Returns an MDL type factory for the given transaction. ">create_type_factory</a>(transaction.get()));</div>
<div class="line"></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html">mi::base::Handle&lt;mi::neuraylib::IValue_factory&gt;</a> value_factory(</div>
<div class="line">            mdl_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html#a76919730caa41d98004f3edcff45d1df" title="Returns an MDL value factory for the given transaction. ">create_value_factory</a>(transaction.get()));</div>
<div class="line"></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html">mi::base::Handle&lt;mi::neuraylib::IExpression_factory&gt;</a> expression_factory(</div>
<div class="line">            mdl_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html#aaa79f7a5d2d2973f7d34e007f22fc949" title="Returns an MDL expression factory for the given transaction. ">create_expression_factory</a>(transaction.get()));</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Load the module &quot;tutorials&quot;.</span></div>
<div class="line">        <span class="comment">// There is no need to configure any module search paths since</span></div>
<div class="line">        <span class="comment">// the mdl example folder is by default in the search path.</span></div>
<div class="line">        check_success(mdl_impexp_api-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__impexp__api.html#a5e195d80915190eb40c5995ccfeaa4c9" title="Loads an MDL module from disk (or a builtin module) into the database. ">load_module</a>(</div>
<div class="line">            transaction.get(), <span class="stringliteral">&quot;::nvidia::sdk_examples::tutorials&quot;</span>, context.get()) &gt;= 0);</div>
<div class="line">        print_messages(context.get());</div>
<div class="line"></div>
<div class="line">        <span class="comment">// get the MDLE api component</span></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IMdle_api&gt;</a> mdle_api(</div>
<div class="line">            neuray-&gt;<a class="code" href="classmi_1_1neuraylib_1_1INeuray.html#a4e107568bbb0e64f61fb4b59b93607fa" title="Returns an API component from the MDL SDK API. ">get_api_component</a>&lt;<a class="code" href="classmi_1_1neuraylib_1_1IMdle__api.html" title="Provides access to functions related to the creation of encapsulated MDL modules (MDLE). ">mi::neuraylib::IMdle_api</a>&gt;());</div>
<div class="line"></div>
<div class="line">        <span class="comment">// setup the export to mdle</span></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::IStructure&gt;</a> data(transaction-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html#ad1b8ce71d7a6fea1f59573325dba126c" title="Creates an object of the type type_name. ">create</a>&lt;<a class="code" href="classmi_1_1IStructure.html" title="This interface represents structures, i.e., a key-value based data structure. ">mi::IStructure</a>&gt;(<span class="stringliteral">&quot;Mdle_data&quot;</span>));</div>
<div class="line"></div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// specify the material/function that will become the &quot;main&quot; of the MDLE</span></div>
<div class="line">            <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::IString&gt;</a> prototype(data-&gt;get_value&lt;<a class="code" href="classmi_1_1IString.html" title="A simple string class. ">mi::IString</a>&gt;(<span class="stringliteral">&quot;prototype_name&quot;</span>));</div>
<div class="line">            prototype-&gt;set_c_str(<span class="stringliteral">&quot;mdl::nvidia::sdk_examples::tutorials::example_mod_rough(color,float)&quot;</span>);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// change a default values</span></div>
<div class="line"></div>
<div class="line">            <span class="comment">// create a new set of named parameters</span></div>
<div class="line">            <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression_list&gt;</a> defaults(</div>
<div class="line">                expression_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#af0b7dbd66ce98752e05c51e350678a78" title="Creates a new expression list. ">create_expression_list</a>());</div>
<div class="line"></div>
<div class="line">            <span class="comment">// set a new tint value</span></div>
<div class="line">            <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IValue_color&gt;</a> tint_value(</div>
<div class="line">                value_factory-&gt;create_color(0.25f, 0.5f, 0.75f));</div>
<div class="line"></div>
<div class="line">            <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression_constant&gt;</a> tint_expr(</div>
<div class="line">                expression_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#a774749a982e8b8e8910e01e11ec39d59" title="Creates a constant (mutable). ">create_constant</a>(tint_value.get()));</div>
<div class="line"></div>
<div class="line">            defaults-&gt;add_expression(<span class="stringliteral">&quot;tint&quot;</span>, tint_expr.get());</div>
<div class="line"></div>
<div class="line">            <span class="comment">// set a new roughness value</span></div>
<div class="line">            <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IValue_float&gt;</a> rough_value(</div>
<div class="line">                value_factory-&gt;create_float(0.5f));</div>
<div class="line"></div>
<div class="line">            <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression_constant&gt;</a> rough_expr(</div>
<div class="line">                expression_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#a774749a982e8b8e8910e01e11ec39d59" title="Creates a constant (mutable). ">create_constant</a>(rough_value.get()));</div>
<div class="line"></div>
<div class="line">            defaults-&gt;add_expression(<span class="stringliteral">&quot;roughness&quot;</span>, rough_expr.get());</div>
<div class="line"></div>
<div class="line">            <span class="comment">// pass the defaults the Mdle_data struct</span></div>
<div class="line">            data-&gt;set_value(<span class="stringliteral">&quot;defaults&quot;</span>, defaults.get());</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// set thumbnail (files in the search paths or absolute file paths allowed as fall back)</span></div>
<div class="line">            std::string thumbnail_path = mi::examples::mdl::get_examples_root()</div>
<div class="line">                + <span class="stringliteral">&quot;/mdl/nvidia/sdk_examples/resources/example_thumbnail.png&quot;</span>;</div>
<div class="line"></div>
<div class="line">            <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::IString&gt;</a> thumbnail(data-&gt;get_value&lt;<a class="code" href="classmi_1_1IString.html" title="A simple string class. ">mi::IString</a>&gt;(<span class="stringliteral">&quot;thumbnail_path&quot;</span>));</div>
<div class="line">            thumbnail-&gt;set_c_str(thumbnail_path.c_str());</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// add additional files</span></div>
<div class="line"></div>
<div class="line">            <span class="comment">// each user file ...</span></div>
<div class="line">            <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::IStructure&gt;</a> user_file(</div>
<div class="line">                transaction-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html#ad1b8ce71d7a6fea1f59573325dba126c" title="Creates an object of the type type_name. ">create</a>&lt;<a class="code" href="classmi_1_1IStructure.html" title="This interface represents structures, i.e., a key-value based data structure. ">mi::IStructure</a>&gt;(<span class="stringliteral">&quot;Mdle_user_file&quot;</span>));</div>
<div class="line"></div>
<div class="line">            <span class="comment">// ... is defined by a source path ...</span></div>
<div class="line">            std::string readme_path = mi::examples::mdl::get_examples_root()</div>
<div class="line">                + <span class="stringliteral">&quot;/mdl/nvidia/sdk_examples/resources/example_readme.txt&quot;</span>;</div>
<div class="line"></div>
<div class="line">            <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::IString&gt;</a> source_path(</div>
<div class="line">                user_file-&gt;get_value&lt;<a class="code" href="classmi_1_1IString.html" title="A simple string class. ">mi::IString</a>&gt;(<span class="stringliteral">&quot;source_path&quot;</span>));</div>
<div class="line">            source_path-&gt;set_c_str(readme_path.c_str());</div>
<div class="line"></div>
<div class="line">            <span class="comment">// ... and a target path (inside the MDLE)</span></div>
<div class="line">            <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::IString&gt;</a> target_path(</div>
<div class="line">                user_file-&gt;get_value&lt;<a class="code" href="classmi_1_1IString.html" title="A simple string class. ">mi::IString</a>&gt;(<span class="stringliteral">&quot;target_path&quot;</span>));</div>
<div class="line">            target_path-&gt;set_c_str(<span class="stringliteral">&quot;readme.txt&quot;</span>);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// all user files are passed as array</span></div>
<div class="line">            <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::IArray&gt;</a> user_file_array(</div>
<div class="line">                transaction-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html#ad1b8ce71d7a6fea1f59573325dba126c" title="Creates an object of the type type_name. ">create</a>&lt;<a class="code" href="classmi_1_1IArray.html" title="This interface represents static arrays, i.e., arrays with a fixed number of elements. ">mi::IArray</a>&gt;(<span class="stringliteral">&quot;Mdle_user_file[1]&quot;</span>));</div>
<div class="line">            user_file_array-&gt;set_element(0, user_file.get());</div>
<div class="line">            data-&gt;set_value(<span class="stringliteral">&quot;user_files&quot;</span>, user_file_array.get());</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// start the actual export</span></div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span>* mdle_file_name = <span class="stringliteral">&quot;example_material_blue.mdle&quot;</span>;</div>
<div class="line">        mdle_api-&gt;export_mdle(transaction.get(), mdle_file_name, data.get(), context.get());</div>
<div class="line">        check_success(print_messages(context.get()));</div>
<div class="line"></div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// check and load an MDLE</span></div>
<div class="line">            std::string mdle_path =</div>
<div class="line">                mi::examples::io::get_working_directory() + <span class="stringliteral">&quot;/&quot;</span> + mdle_file_name;</div>
<div class="line"></div>
<div class="line">            <span class="comment">// optional: check integrity of a (the created) MDLE file.</span></div>
<div class="line">            mdle_api-&gt;validate_mdle(mdle_path.c_str(), context.get());</div>
<div class="line">            check_success(print_messages(context.get()));</div>
<div class="line"></div>
<div class="line">            <span class="comment">// load the MDLE module</span></div>
<div class="line">            mdl_impexp_api-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__impexp__api.html#a5e195d80915190eb40c5995ccfeaa4c9" title="Loads an MDL module from disk (or a builtin module) into the database. ">load_module</a>(transaction.get(), mdle_path.c_str(), context.get());</div>
<div class="line">            check_success(print_messages(context.get()));</div>
<div class="line"></div>
<div class="line">            <span class="comment">// get database name of MDLE module</span></div>
<div class="line">            <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::IString&gt;</a> mdle_db_name(</div>
<div class="line">                mdl_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html#a72a27c9e0d66e79391ff9a8e3ce4a119" title="Returns the DB name for the MDL name of a module (or file path for MDLE modules). ...">get_db_module_name</a>(mdle_path.c_str()));</div>
<div class="line">            std::cerr &lt;&lt; <span class="stringliteral">&quot;MDLE DB name: &quot;</span> &lt;&lt; mdle_db_name-&gt;get_c_str() &lt;&lt; std::endl;</div>
<div class="line"></div>
<div class="line">            <span class="comment">// the main material of an MDLE module is always called &quot;main&quot;</span></div>
<div class="line">            std::string main_db_name(mdle_db_name-&gt;get_c_str());</div>
<div class="line">            main_db_name += <span class="stringliteral">&quot;::main(color,float)&quot;</span>;</div>
<div class="line"></div>
<div class="line">            std::cerr &lt;&lt; <span class="stringliteral">&quot;MDLE main DB name: &quot;</span> &lt;&lt; main_db_name &lt;&lt; std::endl;</div>
<div class="line"></div>
<div class="line">            <span class="comment">// get the main material</span></div>
<div class="line">            <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IFunction_definition&gt;</a> material_definition(</div>
<div class="line">                transaction-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html#adafe2621ae719c43076b79a5677b4934" title="Retrieves an element from the database. ">access</a>&lt;<a class="code" href="classmi_1_1neuraylib_1_1IFunction__definition.html" title="This interface represents a function definition. ">mi::neuraylib::IFunction_definition</a>&gt;(main_db_name.c_str()));</div>
<div class="line">            check_success(material_definition);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// use the material ...</span></div>
<div class="line">            std::cerr &lt;&lt; <span class="stringliteral">&quot;Successfully created and loaded &quot;</span> &lt;&lt; mdle_file_name &lt;&lt; std::endl</div>
<div class="line">                      &lt;&lt; std::endl;</div>
<div class="line"></div>
<div class="line">            <span class="comment">// access the user file</span></div>
<div class="line">            <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IReader&gt;</a> reader(</div>
<div class="line">                mdle_api-&gt;get_user_file(mdle_path.c_str(), <span class="stringliteral">&quot;readme.txt&quot;</span>, context.get()));</div>
<div class="line">            check_success(print_messages(context.get()));</div>
<div class="line"></div>
<div class="line">            <span class="comment">// print the content to the console</span></div>
<div class="line">            <a class="code" href="group__mi__base__types.html#ga09bc2ac56b82fa59928f2b8eff415457" title="64-bit signed integer. ">mi::Sint64</a> file_size = reader-&gt;get_file_size();</div>
<div class="line">            <span class="keywordtype">char</span>* content = <span class="keyword">new</span> <span class="keywordtype">char</span>[file_size + 1];</div>
<div class="line">            content[file_size] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line">            reader-&gt;read(content, file_size);</div>
<div class="line">            std::cerr &lt;&lt; <span class="stringliteral">&quot;content of the readme.txt:&quot;</span> &lt;&lt; std::endl &lt;&lt; content &lt;&lt; std::endl</div>
<div class="line">                      &lt;&lt; std::endl;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// ----------------------------------------------------------------------------------------</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">// export a function to a second MDLE</span></div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span>* mdle_file_name2 = <span class="stringliteral">&quot;example_function.mdle&quot;</span>;</div>
<div class="line"></div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// setup the export to MDLE</span></div>
<div class="line">            <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::IStructure&gt;</a> data(transaction-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html#ad1b8ce71d7a6fea1f59573325dba126c" title="Creates an object of the type type_name. ">create</a>&lt;<a class="code" href="classmi_1_1IStructure.html" title="This interface represents structures, i.e., a key-value based data structure. ">mi::IStructure</a>&gt;(<span class="stringliteral">&quot;Mdle_data&quot;</span>));</div>
<div class="line"></div>
<div class="line">            <span class="comment">// specify the material/function that will become the &quot;main&quot; of the MDLE</span></div>
<div class="line">            <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::IString&gt;</a> prototype(data-&gt;get_value&lt;<a class="code" href="classmi_1_1IString.html" title="A simple string class. ">mi::IString</a>&gt;(<span class="stringliteral">&quot;prototype_name&quot;</span>));</div>
<div class="line">            prototype-&gt;set_c_str(</div>
<div class="line">                <span class="stringliteral">&quot;mdl::nvidia::sdk_examples::tutorials::example_function(color,float)&quot;</span>);</div>
<div class="line"></div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// set parameters, the &#39;example_function&#39; has no defaults</span></div>
<div class="line"></div>
<div class="line">                <span class="comment">// create a new set of named parameters</span></div>
<div class="line">                <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression_list&gt;</a> defaults(</div>
<div class="line">                    expression_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#af0b7dbd66ce98752e05c51e350678a78" title="Creates a new expression list. ">create_expression_list</a>());</div>
<div class="line"></div>
<div class="line">                <span class="comment">// set a new tint value</span></div>
<div class="line">                <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IValue_color&gt;</a> tint_value(</div>
<div class="line">                    value_factory-&gt;create_color(1.0f, 0.66f, 0.33f));</div>
<div class="line"></div>
<div class="line">                <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression_constant&gt;</a> tint_expr(</div>
<div class="line">                    expression_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#a774749a982e8b8e8910e01e11ec39d59" title="Creates a constant (mutable). ">create_constant</a>(tint_value.get()));</div>
<div class="line"></div>
<div class="line">                defaults-&gt;add_expression(<span class="stringliteral">&quot;tint&quot;</span>, tint_expr.get());</div>
<div class="line"></div>
<div class="line">                <span class="comment">// set a new distance value</span></div>
<div class="line">                <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IValue_float&gt;</a> distance_value(</div>
<div class="line">                    value_factory-&gt;create_float(0.5f));</div>
<div class="line"></div>
<div class="line">                <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression_constant&gt;</a> distance_expr(</div>
<div class="line">                    expression_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#a774749a982e8b8e8910e01e11ec39d59" title="Creates a constant (mutable). ">create_constant</a>(distance_value.get()));</div>
<div class="line"></div>
<div class="line">                defaults-&gt;add_expression(<span class="stringliteral">&quot;distance&quot;</span>, distance_expr.get());</div>
<div class="line"></div>
<div class="line">                <span class="comment">// pass the defaults the Mdle_data struct</span></div>
<div class="line">                data-&gt;set_value(<span class="stringliteral">&quot;defaults&quot;</span>, defaults.get());</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">// start the actual export</span></div>
<div class="line">            mdle_api-&gt;export_mdle(transaction.get(), mdle_file_name2, data.get(), context.get());</div>
<div class="line">            check_success(print_messages(context.get()));</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// check and load the function again</span></div>
<div class="line">            std::string mdle_path =</div>
<div class="line">                mi::examples::io::get_working_directory() + <span class="stringliteral">&quot;/&quot;</span> + mdle_file_name2;</div>
<div class="line"></div>
<div class="line">            <span class="comment">// optional: check integrity of a (the created) MDLE file.</span></div>
<div class="line">            mdle_api-&gt;validate_mdle(mdle_path.c_str(), context.get());</div>
<div class="line">            check_success(print_messages(context.get()));</div>
<div class="line"></div>
<div class="line">            <span class="comment">// load the MDLE module</span></div>
<div class="line">            mdl_impexp_api-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__impexp__api.html#a5e195d80915190eb40c5995ccfeaa4c9" title="Loads an MDL module from disk (or a builtin module) into the database. ">load_module</a>(transaction.get(), mdle_path.c_str(), context.get());</div>
<div class="line">            check_success(print_messages(context.get()));</div>
<div class="line"></div>
<div class="line">            <span class="comment">// get database name of MDLE module</span></div>
<div class="line">            <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::IString&gt;</a> mdle_db_name(</div>
<div class="line">                mdl_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html#a72a27c9e0d66e79391ff9a8e3ce4a119" title="Returns the DB name for the MDL name of a module (or file path for MDLE modules). ...">get_db_module_name</a>(mdle_path.c_str()));</div>
<div class="line">            std::cerr &lt;&lt; <span class="stringliteral">&quot;MDLE DB name: &quot;</span> &lt;&lt; mdle_db_name-&gt;get_c_str() &lt;&lt; std::endl;</div>
<div class="line"></div>
<div class="line">            <span class="comment">// get database name of main function</span></div>
<div class="line">            <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IModule&gt;</a> mdle_module(</div>
<div class="line">                transaction-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html#adafe2621ae719c43076b79a5677b4934" title="Retrieves an element from the database. ">access</a>&lt;<a class="code" href="classmi_1_1neuraylib_1_1IModule.html" title="This interface represents an MDL module. ">mi::neuraylib::IModule</a>&gt;(mdle_db_name-&gt;get_c_str()));</div>
<div class="line">            check_success(mdle_module.is_valid_interface());</div>
<div class="line"></div>
<div class="line">            std::string main_db_name = mdle_db_name-&gt;get_c_str() + std::string(<span class="stringliteral">&quot;::main&quot;</span>);</div>
<div class="line">            <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::IArray&gt;</a> functions(</div>
<div class="line">                mdle_module-&gt;get_function_overloads(main_db_name.c_str()));</div>
<div class="line"></div>
<div class="line">            check_success(functions.is_valid_interface());</div>
<div class="line">            check_success(functions-&gt;get_length() == 1);</div>
<div class="line"></div>
<div class="line">            <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::IString&gt;</a> main_db_name_str(</div>
<div class="line">                functions-&gt;get_element&lt;<span class="keyword">const</span> <a class="code" href="classmi_1_1IString.html" title="A simple string class. ">mi::IString</a>&gt;(0));</div>
<div class="line"></div>
<div class="line">            main_db_name = main_db_name_str-&gt;get_c_str();</div>
<div class="line">            std::cerr &lt;&lt; <span class="stringliteral">&quot;MDLE main DB name: &quot;</span> &lt;&lt; main_db_name &lt;&lt; std::endl;</div>
<div class="line"></div>
<div class="line">            <span class="comment">// get the main function</span></div>
<div class="line">            <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IFunction_definition&gt;</a> function_definition(</div>
<div class="line">                transaction-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html#adafe2621ae719c43076b79a5677b4934" title="Retrieves an element from the database. ">access</a>&lt;<a class="code" href="classmi_1_1neuraylib_1_1IFunction__definition.html" title="This interface represents a function definition. ">mi::neuraylib::IFunction_definition</a>&gt;(main_db_name.c_str()));</div>
<div class="line">            check_success(function_definition);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// use the function ...</span></div>
<div class="line">            std::cerr &lt;&lt; <span class="stringliteral">&quot;Successfully created and loaded &quot;</span> &lt;&lt; mdle_file_name2 &lt;&lt; std::endl</div>
<div class="line">                      &lt;&lt; std::endl;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// since the same MDLE can be stored at various different places with different name</span></div>
<div class="line">            <span class="comment">// it could be valuable to check if the content of two MDLE is equal</span></div>
<div class="line">            std::string mdle_path_a =</div>
<div class="line">                mi::examples::io::get_working_directory() + <span class="stringliteral">&quot;/&quot;</span> + mdle_file_name;</div>
<div class="line">            std::string mdle_path_b =</div>
<div class="line">                mi::examples::io::get_working_directory() + <span class="stringliteral">&quot;/&quot;</span> + mdle_file_name2;</div>
<div class="line"></div>
<div class="line">            <span class="comment">// comparing an MDLE with itself should work</span></div>
<div class="line">            <a class="code" href="group__mi__base__types.html#gafcdcb44319b0596ee8a9a44fddaec8c6" title="32-bit signed integer. ">mi::Sint32</a> res = mdle_api-&gt;compare_mdle(</div>
<div class="line">                mdle_path_a.c_str(), mdle_path_a.c_str(), context.get());</div>
<div class="line">            check_success(print_messages(context.get()));</div>
<div class="line">            std::cerr &lt;&lt; <span class="stringliteral">&quot;Comparing &quot;</span> &lt;&lt; mdle_file_name &lt;&lt; <span class="stringliteral">&quot; with &quot;</span> &lt;&lt; mdle_file_name</div>
<div class="line">                      &lt;&lt; <span class="stringliteral">&quot; resulted in: &quot;</span> &lt;&lt; std::to_string(res) &lt;&lt; std::endl;</div>
<div class="line"></div>
<div class="line">            <span class="comment">// this will fail</span></div>
<div class="line">            res = mdle_api-&gt;compare_mdle(mdle_path_a.c_str(), mdle_path_b.c_str(), context.get());</div>
<div class="line">            check_success(print_messages(context.get()));</div>
<div class="line">            std::cerr &lt;&lt; <span class="stringliteral">&quot;Comparing &quot;</span> &lt;&lt; mdle_file_name &lt;&lt; <span class="stringliteral">&quot; with &quot;</span> &lt;&lt; mdle_file_name2</div>
<div class="line">                &lt;&lt; <span class="stringliteral">&quot; resulted in: &quot;</span> &lt;&lt; std::to_string(res) &lt;&lt; std::endl;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        <span class="comment">// ----------------------------------------------------------------------------------------</span></div>
<div class="line">        <span class="comment">// All transactions need to get committed.</span></div>
<div class="line">        transaction-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html#aa4ff8152107db238986b364273bceb0c" title="Commits the transaction. ">commit</a>();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Shut down the MDL SDK</span></div>
<div class="line">    <span class="keywordflow">if</span> (neuray-&gt;<a class="code" href="classmi_1_1neuraylib_1_1INeuray.html#a01d0574d048798c76f8e29f91a4f6fea" title="Shuts down the library. ">shutdown</a>() != 0)</div>
<div class="line">        exit_failure(<span class="stringliteral">&quot;Failed to shutdown the SDK.&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Unload the MDL SDK</span></div>
<div class="line">    neuray = <span class="keyword">nullptr</span>;</div>
<div class="line">    <span class="keywordflow">if</span> (!mi::examples::mdl::unload())</div>
<div class="line">        exit_failure(<span class="stringliteral">&quot;Failed to unload the SDK.&quot;</span>);</div>
<div class="line"></div>
<div class="line">    exit_success();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Convert command line arguments to UTF8 on Windows</span></div>
<div class="line">COMMANDLINE_TO_UTF8</div>
</div><!-- fragment --><div align="right"> [<a class="el" href="mi_neuray_example_mdl_browser.html">Previous</a>] [<a class="el" href="mi_neuray_examples.html">Up</a>] [<a class="el" href="mi_neuray_example_dxr.html">Next</a>] </div> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.4-->
<!-- start footer part -->
<div id="nav-path">
<span class="footeritem">5&#160;April&#160;2022,&#160;20:40, rev.358266</span>
<span class="footeritem"><a href="https://www.nvidia.com/en-us/about-nvidia/legal-info/" target="_blank" shape="rect">&copy; 2022 NVIDIA&nbsp;Corporation.</a> All rights reserved.</span>
</div>
</body>
</html>
