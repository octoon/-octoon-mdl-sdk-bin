<!-- HTML header for doxygen 1.8.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>Example for a Microsoft DXR-based MDL-enabled Path Tracer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="images/arcicon.ico" rel="shortcut icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_custom_stylesheet_1_8_4.css" rel="stylesheet" type="text/css"/>
<link rel='stylesheet' href='webfonts/librebaskerville/stylesheet.css' type='text/css'/>
<link rel='stylesheet' href='webfonts/sourcesanspro/stylesheet.css' type='text/css'/>
<!--ARC-->
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="blackheader">
<span id="blackheader_title">MDL SDK API</span>
<span>
<img src="images/nvidia_logo_transpbg.gif" alt="nvidia_logo_transpbg.gif" style=" height:1.25em; width:6.806em;"/></span>
<span id="blackheader_uplink">
<a href='../index.html' class='top_page_nav'>Up</a>
</span>
</div>
<!--
<div id="titlearea">
   <span id="projectname">
     <a id="titlelink" href="../../index.html">
       MDL SDK API
     </a>
   </span>
     <a id="projectlogo" href="http://www.nvidia-arc.com">
       <img alt="NVIDIA logo" src="images/nvidia_logo.png" style="height:2em;">
       </a>
     <a href='../index.html' class='top_page_nav'>Up</a>
</div>
-->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('mi_neuray_example_dxr.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Example for a Microsoft DXR-based MDL-enabled Path Tracer </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div align="right"> [<a class="el" href="mi_neuray_example_mdle.html">Previous</a>] [<a class="el" href="mi_neuray_examples.html">Up</a>] [<a class="el" href="mi_neuray_example_optix7.html">Next</a>] </div><p>This example demonstrates how to integrate MDL into a real-time path tracer that is able to render scenes provided in the <a href="https://www.khronos.org/gltf/">glTF</a> format. The rendering framework is based on Microsoft DirectX Raytracing (DXR) and utilizes the MDL HLSL backend to generate HLSL code for evaluating expressions and distribution functions directly inside shaders.</p>
<h1><a class="anchor" id="example_dxr_new"></a>
New Topics</h1>
<ul>
<li>Integration of MDL in a real-time renderer</li>
<li>Using the glTF metallic-roughness support material, as well as other MDL materials and MDLE</li>
</ul>
<h1><a class="anchor" id="example_dxr_descr"></a>
Detailed Description</h1>
<dl>
<dt><b>The Examples Rendering Framework</b> </dt>
<dd><p class="startdd"><br/>
 In order to illustrate the use of MDL in the context of real-time rendering and in scenes consisting of multiple objects with different materials, at least a small rendering framework that handles scene loading and the main application loop is required. To concentrate on the MDL features, most parts of the low-level Direct3D API have been hidden behind classes that provide a more abstract view, which in turn makes it easier to communicate how MDL fits into the bigger picture. To get started with DXR and for more detailed information on the Direct3D API it is recommended to look into other resources such as the <a href="https://developer.nvidia.com/rtx/raytracing/dxr/DX12-Raytracing-tutorial-Part-1">NVIDIA DX12 Raytracing tutorial</a> and the <a href="https://github.com/Microsoft/DirectX-Graphics-Samples">Microsoft DirectX-Graphics-Samples</a>.</p>
<p>The parts of the framework that are important for the MDL integration can be found in a few source files: <code>mdl_d3d12/mdl_material.h</code>, <code>mdl_d3d12/mdl_material.cpp</code>, and <code>example_dxr.cpp</code>. While the latter contains the main application that triggers the scene loading, the pipeline setup as well as the update and rendering loop, the first two files define classes for the MDL SDK interface, the MDL target code with a link unit and most importantly the <code>Mdl_material</code> class which handles the loading and parameterization of the scenes materials.</p>
<p>The essential parts of the renderer are implemented in HLSL. In the hit shaders (<code>content/mdl_hit_programs.hlsl</code>), the material is evaluated for the current intersection of the ray with the surface. Afterwards, the direction for the next segment of the ray path is computed. The interface for the evaluation corresponds to the one in the [<a class="el" href="mi_neuray_example_df_cuda.html">df_cuda example</a>]. The required glue-code and the runtime functions for HLSL can be found in the <code>content/mdl_target_code_types.hlsl</code> and <code>content/mdl_renderer_runtime.hlsl</code>.</p>
<p>The actual renderer will not have to call the contained functions directly, they are referenced by the generated code. Instead, the entry points into the generated code have to be invoked by the renderer. For instance: </p>
<div class="fragment"><div class="line">mdl_bsdf_evaluate(            <span class="comment">// defined in the generated target code</span></div>
<div class="line">  scattering_function_index,  <span class="comment">// returned by link_unit::add_material(...)</span></div>
<div class="line">                              <span class="comment">// and passed to shader in constant buffer</span></div>
<div class="line">  eval_data,                  <span class="comment">// local in/output struct prepared by the renderer</span></div>
<div class="line">  mdl_state);                 <span class="comment">// contains information about the hit point and the material</span></div>
</div><!-- fragment --><p> The generated code is written to the binary directory for debugging and inspection purposes: <code>link_unit_source.hlsl</code></p>
<p>Material parameters are mapped to a <code></code> <a href="https://github.com/ocornut/imgui">dear imgui</a> user interface, just like in the [<a class="el" href="mi_neuray_example_df_cuda.html">df_cuda example</a>], so they can be changed at runtime. See <code>mdl_d3d12/mdl_material_info.h</code>, <code>gui.h</code>, and <code>gui.cpp</code> for more details. </p>
<p class="enddd"></p>
</dd>
<dt><b>Specifying MDL Materials in glTF scenes</b> </dt>
<dd><p class="startdd"><br/>
 At this point, the glTF scene format contains no explicit support for MDL. However, it provides a set of parameters that are intended to be used in physically-based rendering (PBR) and is therefore compatible with MDL. Here is an example for an glTF material node: </p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="stringliteral">&quot;name&quot;</span>: <span class="stringliteral">&quot;ShaderBall&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;doubleSided&quot;</span>: <span class="keyword">true</span>,</div>
<div class="line">    <span class="stringliteral">&quot;emissiveFactor&quot;</span>: [ 0.0, 0.0, 0.0 ],</div>
<div class="line">    <span class="stringliteral">&quot;normalTexture&quot;</span>: {</div>
<div class="line">        <span class="stringliteral">&quot;index&quot;</span>: 1,</div>
<div class="line">        <span class="stringliteral">&quot;scale&quot;</span>: 1,</div>
<div class="line">        <span class="stringliteral">&quot;texCoord&quot;</span>: 0</div>
<div class="line">    },</div>
<div class="line">    <span class="stringliteral">&quot;pbrMetallicRoughness&quot;</span>: {</div>
<div class="line">        <span class="stringliteral">&quot;baseColorFactor&quot;</span>: [ 1.0, 1.0, 1.0, 1.0 ],</div>
<div class="line">        <span class="stringliteral">&quot;baseColorTexture&quot;</span>: {</div>
<div class="line">            <span class="stringliteral">&quot;index&quot;</span>: 2,</div>
<div class="line">            <span class="stringliteral">&quot;texCoord&quot;</span>: 0</div>
<div class="line">        },</div>
<div class="line">        <span class="stringliteral">&quot;metallicFactor&quot;</span>: 1.0,</div>
<div class="line">        <span class="stringliteral">&quot;roughnessFactor&quot;</span>: 1.0,</div>
<div class="line">        <span class="stringliteral">&quot;metallicRoughnessTexture&quot;</span>: {</div>
<div class="line">            <span class="stringliteral">&quot;index&quot;</span>: 0,</div>
<div class="line">            <span class="stringliteral">&quot;texCoord&quot;</span>: 0</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p> Note, that textures are defined separately. They are referenced by the <code>index</code> property. While loading the scene, these parameters are parsed, the texture file paths are resolved and the support material defined in the provided <code>gltf_support.mdl</code> is parameterized accordingly.</p>
<p>To avoid the creation of redundant HLSL code <code>class-compilation</code> is used, which allows to change parameters at runtime. For each scene material that uses the glTF_support material the same HLSL code is executed, but the individual parameter sets, the <code>argument</code> <code>blocks</code>, are bound as buffers to the graphics pipeline.</p>
<p>The possibilities of this standard material are limited. Glass for instance can not be described properly without an index of refraction (IOR). To overcome this limitation without introducing an MDL extension to glTF, an arbitrary MDL material can be assigned by setting the <code>name</code> property of the glTF material node to a fully qualified absolute MDL material identifier like this: </p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="stringliteral">&quot;name&quot;</span>: <span class="stringliteral">&quot;::nvidia::sdk_examples::tutorials::dxr_sphere_mat&quot;</span></div>
<div class="line">}</div>
</div><!-- fragment --><p> All other material properties are ignored in that case. This means that the selected MDL material must provide default values for all its parameters.</p>
<p>The Example also supports the MDL encapsulated format. In this case, the file path of the MDLE has to be specified in the <code>name</code> property of the glTF material node. This file path can either be absolute or relative to the <code></code>.gltf scene file: </p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="stringliteral">&quot;name&quot;</span>: <span class="stringliteral">&quot;glass.mdle&quot;</span></div>
<div class="line">}</div>
</div><!-- fragment --> <p class="enddd"></p>
</dd>
<dt><b>Running the example</b> </dt>
<dd><p class="startdd"><br/>
 When running the DXR example, a simple sphere with an MDL material is rendered. Moving the mouse while pressing the left or the middle mouse button allows to rotate or pan the camera, while scrolling allows to move forward and back. Pressing <code>space</code> reveals the user interface that allows to change parameters of the material, the camera and the renderer. Pressing <code>print</code> writes a screenshot into the current working directory.</p>
<p>To load a different scene, the DXR example is started from the command line with an glTF file to load: </p>
<div class="fragment"><div class="line">dxr.exe some_folder/my_scene.gltf</div>
</div><!-- fragment --><p> Various interesting scenes can be found online, for instance on <a href="https://sketchfab.com/">sketchfab.com</a>, so give it a try.</p>
<p>There are further options that can be used with the DXR example. Here are a few commonly used ones:</p>
<ul>
<li>-h | --help<br/>
 Shows all options with a short explanation.</li>
<li>--mdl_path &lt;value&gt;<br/>
 By default, the example uses three default search paths. On the Windows platform this is the admin-space search path, e.g., <em>C:\ProgramData\NVIDIA Corporation\mdl</em> and the user-space search path <em>%USERPROFILE%\Documents\mdl</em> as well as scene folder that contains the loaded glTF. By passing the command line option --mdl_path &lt;value&gt;, this default behavior can be changed. The option can appear multiple times.</li>
<li>--hdr &lt;filename&gt;<br/>
 Path of an <code></code>.hdr environment map that is used for image-based lighting and as background. The path can be absolute or relative to the scene file.</li>
<li>--mat &lt;qualified_name&gt;<br/>
 Override all materials in the scene using a qualified material name or an MDLE path. </li>
</ul>
<p class="enddd"></p>
</dd>
<dt><b>Restrictions</b> </dt>
<dd><br/>
 The DXR example is a prototype renderer with certain limitations:<ul>
<li>The encoding of MDL material qualifiers into the name property has obviously limitations. All names starting with <code>::</code> literal are interpreted as MDL names and all names ending with <code>.mdle</code> are interpreted as file paths, which both are unlikely but not impossible to appear by accident.</li>
<li>From an MDL perspective, the lack of specifying MDL material parameters in glTF is also a limitation.</li>
<li>Many existing glTF scenes make use of extensions like <a href="https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_pbrSpecularGlossiness">KHR_materials_pbrSpecularGlossiness</a>. There are no support material for such extensions yet.</li>
<li>The example is based on a very simple path tracer. Multiple importance sampling (MIS) is only used to sample the BSDFs and the environment light. Emissive surfaces however are only hit by chance and the progressive rendering requires more time to converge.</li>
<li>The example does not include support for measured BSDFs and light profiles.  </li>
</ul>
</dd>
</dl>
<div align="right"> [<a class="el" href="mi_neuray_example_mdle.html">Previous</a>] [<a class="el" href="mi_neuray_examples.html">Up</a>] [<a class="el" href="mi_neuray_example_optix7.html">Next</a>] </div> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.4-->
<!-- start footer part -->
<div id="nav-path">
<span class="footeritem">5&#160;April&#160;2022,&#160;20:40, rev.358266</span>
<span class="footeritem"><a href="https://www.nvidia.com/en-us/about-nvidia/legal-info/" target="_blank" shape="rect">&copy; 2022 NVIDIA&nbsp;Corporation.</a> All rights reserved.</span>
</div>
</body>
</html>
