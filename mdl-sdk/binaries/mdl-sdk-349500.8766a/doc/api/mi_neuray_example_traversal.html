<!-- HTML header for doxygen 1.8.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>Example for Traversing Compiled Materials</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="images/arcicon.ico" rel="shortcut icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_custom_stylesheet_1_8_4.css" rel="stylesheet" type="text/css"/>
<link rel='stylesheet' href='webfonts/librebaskerville/stylesheet.css' type='text/css'/>
<link rel='stylesheet' href='webfonts/sourcesanspro/stylesheet.css' type='text/css'/>
<!--ARC-->
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="blackheader">
<span id="blackheader_title">MDL SDK API</span>
<span>
<img src="images/nvidia_logo_transpbg.gif" alt="nvidia_logo_transpbg.gif" style=" height:1.25em; width:6.806em;"/></span>
<span id="blackheader_uplink">
<a href='../index.html' class='top_page_nav'>Up</a>
</span>
</div>
<!--
<div id="titlearea">
   <span id="projectname">
     <a id="titlelink" href="../../index.html">
       MDL SDK API
     </a>
   </span>
     <a id="projectlogo" href="http://www.nvidia-arc.com">
       <img alt="NVIDIA logo" src="images/nvidia_logo.png" style="height:2em;">
       </a>
     <a href='../index.html' class='top_page_nav'>Up</a>
</div>
-->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('mi_neuray_example_traversal.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Example for Traversing Compiled Materials </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div align="right"> [<a class="el" href="mi_neuray_example_distilling_glsl.html">Previous</a>] [<a class="el" href="mi_neuray_examples.html">Up</a>] [<a class="el" href="mi_neuray_example_create_module.html">Next</a>] </div><p>This example demonstrates the traversal of compiled materials. It thereby allows investigating the structure of expression graphs based on an example application that reconstructs compilable MDL code.</p>
<h1><a class="anchor" id="example_traversal_new"></a>
New Topics</h1>
<ul>
<li>Traversal of a compiled material</li>
<li>Generating MDL code</li>
</ul>
<h1><a class="anchor" id="example_traversal_descr"></a>
Detailed Description</h1>
<dl>
<dt><b>Basic traversal of a compiled material</b> </dt>
<dd><p class="startdd"><br/>
 With this example, we provide the <code>compiled_material_traverser_base</code>, a simple base class for iterating over the structure of a material in a recursive manner. During the traversal, virtual functions are called on certain occasions and while reaching particular elements in the expression graph. Deriving classes, like the <code>compiled_material_traverser_print</code>, implement those virtual methods in order to realize their intended logic. To keep track of the current state, the implementations can provide a custom context object that is passed through for each invocation without any changes by the base class.</p>
<p>Similar to the definition of an MDL material, a compiled material also consists of three sections: parameters, temporaries, and the body. Therefore, the traversal also has three corresponding stages: <code>ES_PARAMETERS</code>, <code>ES_TEMPORARIES</code>, and <code>ES_BODY</code>. There is one virtual method call at the beginning of each of those stages and one at the end, respectively. For convenience, there are two additional stages provided to the deriving classes: <code>ES_NOT_STARTED</code> to define the current state before a traversal has been started and <code>ES_FINISHED</code> to indicate that the traversal is done. Deriving classes are free to keep track of the current state using the context object that is passed through.</p>
<p>During the three main stages, the traversal visits the <a class="el" href="classmi_1_1neuraylib_1_1IExpression.html" title="The interface to MDL expressions. ">mi::neuraylib::IExpression</a> and <a class="el" href="classmi_1_1neuraylib_1_1IValue.html" title="The interface to MDL values. ">mi::neuraylib::IValue</a> nodes of the tree recursively. When reaching the next node in the tree, the <code>visit_begin</code>(...) method is called. Then, the child elements are processed. In case of multiple children, there is an additional call to <code>visit_child</code>(...) for each child. This will happen while iterating over the arguments of a <a class="el" href="classmi_1_1neuraylib_1_1IExpression__direct__call.html" title="A direct call expression. ">mi::neuraylib::IExpression_direct_call</a> and while iterating over the components of a <a class="el" href="classmi_1_1neuraylib_1_1IValue__compound.html" title="A compound value. ">mi::neuraylib::IValue_compound</a>. A call to <code>visit_end</code>(...) indicates that the processing of the current node is done.</p>
<p>Each of these three methods provides a pointer to the compiled material that is processed, the custom context object, and a <code>Traversal_element</code> with information about the element that is currently visited. This includes pointers to the current expression, value, parameter, or temporary. Only one of these four pointers is different from <code>NULL</code> during each invocation. Depending on the stage, not all cases are possible. During the <code>ES_PARAMETERS</code> stage, for instance, only parameters and values but no temporaries or expressions can occur. The Traversal_element also provides a <code>sibling_count</code> and a <code>sibling_index</code> that might be useful to derived classes like the <code>compiled_material_traverser_print</code>.</p>
<p>To start the actual traversal, the protected <code>traverse</code>(...) method is called by by the deriving class. At this point the custom context object is provided to the base class. </p>
<p class="enddd"></p>
</dd>
<dt><b>Reconstructing MDL code as example traversal</b> </dt>
<dd><p class="startdd"><br/>
 The example application contains an MDL printer. Based on the <code>compiled_material_traverser_base</code> this printer generates a serialized representation of the compiled material in MDL syntax. </p>
<p class="enddd"></p>
</dd>
<dt><b>Using the MDL printer</b> </dt>
<dd><p class="startdd"><br/>
 The input of the traversers is a compiled material. Therefore, we first need to load a module, create a material instance, and compile this instance to get a <a class="el" href="classmi_1_1neuraylib_1_1ICompiled__material.html" title="This interface represents a compiled material. ">mi::neuraylib::ICompiled_material</a>. Before starting the iteration of the expression tree, we setup the <code>Compiled_material_traverser_print::Context</code> to configure the behavior of the printer: </p>
<div class="fragment"><div class="line"><span class="comment">// Creates the context of a traversal, which includes required component and configurations.</span></div>
<div class="line">Compiled_material_traverser_print::Context(</div>
<div class="line">    <a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html" title="A transaction provides a consistent view on the database. ">mi::neuraylib::ITransaction</a>* transaction, <span class="comment">// used to resolve resources</span></div>
<div class="line">    <a class="code" href="classmi_1_1neuraylib_1_1IMdl__compiler.html" title="The MDL compiler allows to register builtin modules. ">mi::neuraylib::IMdl_compiler</a>* compiler,   <span class="comment">// used to resolve resources</span></div>
<div class="line">    <span class="keywordtype">bool</span> keep_structure)                      <span class="comment">// show compiler output vs. print valid MDL code</span></div>
</div><!-- fragment --><p> The constructor consumes three arguments. While the first two are required to resolve textures, measured BSDFs, and light profiles, the last one parameter requires more explanations.</p>
<p>The structures produced by the compiler do not always match the structure of the input material. The main reason for that is optimization and the simplification of expressions that are constant during compile time. Another example is the transformation of constants to parameters while in class compilation mode. Generating MDL code that reflects the latter directly may result in invalid MDL code. This can happen if keywords, like <code>material_emission</code>, appear as parameters. However, the discussed printer focuses on generating compilable MDL code but we also want to provide a tool to investigate the produced compiler output. To enable both, the example allows choosing between the two behaviors. Setting <code>keep_structure</code> to <code>true</code> preserves the structure of the compiler output even if this would result in printed MDL code that will not compile. Setting <code>keep_structure</code> to <code>false</code>, which is the default value, will inline the transformed constants back into the body. This results in MDL code that is easier to read and that can be loaded and compiled later.</p>
<p>After setting up the context, the traversal can be started by calling <code>print_mdl</code>(...): </p>
<div class="fragment"><div class="line"><span class="comment">// generates MDL code that can be saved as a module</span></div>
<div class="line">std::string Compiled_material_traverser_print::print_mdl(</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classmi_1_1neuraylib_1_1ICompiled__material.html" title="This interface represents a compiled material. ">mi::neuraylib::ICompiled_material</a>* material, <span class="comment">// the compiled material to process</span></div>
<div class="line">    Compiled_material_traverser_print::Context&amp; context, <span class="comment">// the context that is passed through</span></div>
<div class="line">    <span class="keyword">const</span> std::string&amp; original_module_name, <span class="comment">// qualified name of the original module</span></div>
<div class="line">    <span class="keyword">const</span> std::string&amp; output_material_name) <span class="keyword">const</span> <span class="comment">// simple name of the output material</span></div>
</div><!-- fragment --><p> Since the <a class="el" href="classmi_1_1neuraylib_1_1ICompiled__material.html" title="This interface represents a compiled material. ">mi::neuraylib::ICompiled_material</a> lacks some information to generate a valid module, the original module name has to be provided for referencing exported functions in the original module in which the material to process was defined in. The new material also requires a name that has to be provided, too.</p>
<p>The returned result can then be written into a file for later investigation or processing. Besides that, the context contains some further information about the material:</p>
<div class="fragment"><div class="line"><span class="comment">// indicates whether the output MDL code should be valid or not.</span></div>
<div class="line">std::string Compiled_material_traverser_print::Context::get_is_valid_mdl()</div>
</div><!-- fragment --><p> If we do not inline transformed constants, we want to inform about invalid MDL after running the printer. The result will be false if an invalid case was encountered. Note, this can only be false if <code>keep_structure</code> of the context was set to true.</p>
<div class="fragment"><div class="line"><span class="comment">// gets modules that have been imported directly by the module and used by the input material</span></div>
<div class="line"><span class="keyword">const</span> std::set&lt;std::string&gt;&amp; Compiled_material_traverser_print::Context::get_used_modules() const</div>
<div class="line"></div>
<div class="line"><span class="comment">// gets resources that have been imported directly by the module and used by the input material</span></div>
<div class="line">const std::set&lt;std::<span class="keywordtype">string</span>&gt;&amp; Compiled_material_traverser_print::Context::get_used_resources() const</div>
</div><!-- fragment --><p> Since the printer needs to keep track of modules that have to be imported by the generated module, we also provide that information to the user. In addition to the modules, we also track the directly referenced resources. </p>
<p class="enddd"></p>
</dd>
<dt><b>Running the example from the command line</b> </dt>
<dd><p class="startdd"><br/>
 The example can be started from the command line. The module to process can be specified by passing a qualified name as an argument. Additionally, there are flags to choose between class and instance compilation: <code>-class</code> and -instance, respectively. If none of them is provided, the class compilation mode is used. Furthermore, passing the <code>-keep</code> flag will preserve the structure of the compiler output as described above. Here are some examples:</p>
<div class="fragment"><div class="line">&gt;&gt; example_traversal ::nvidia::core_definitions -instance -keep</div>
</div><!-- fragment --><p> will traverse all materials in the core_definitions module in instance mode while keeping the structure produced by the compiler.</p>
<div class="fragment"><div class="line">&gt;&gt; example_traversal ::example -<span class="keyword">class</span></div>
<div class="line">&gt;&gt; example_traversal ::example</div>
<div class="line">&gt;&gt; example_traversal</div>
</div><!-- fragment --><p> All three commands above will produce the same results as they use the default parameters -- the traversal of the materials defined in the example module. The class compilation mode will be used and the compiler generated parameters are inlined. </p>
<p class="enddd"></p>
</dd>
<dt><b>Restrictions</b> </dt>
<dd><p class="startdd"><br/>
 With the goal of demonstrating the traversal, this printer has some restrictions:</p>
<ul>
<li>Since the original module of the compiled input material is simply imported in the generated MDL module, all local functions that are used by the material need to be exported by the original module. If this is not the case, these dependencies can not be resolved for the generated material.</li>
<li>Only MDL 1.4 compliant materials are supported.</li>
</ul>
<p class="enddd">The header of <code>compiled_material_traverser_base</code> is listed below. It contains the interface declarations for the basic traversal. Please also refer to the source files for more details on the printing and the formatting that is performed by the printer implementation.  </p>
</dd>
</dl>
<h1><a class="anchor" id="example_traversal"></a>
Example Source</h1>
<p><b>Source Code Location:</b><br/>
 <code>examples/mdl_sdk/traversal/example_traversal.cpp</code><br/>
 <code>examples/mdl_sdk/shared/compiled_material_traverser_base.h</code><br/>
 <code>examples/mdl_sdk/shared/compiled_material_traverser_base.cpp</code><br/>
 <code>examples/mdl_sdk/traversal/compiled_material_traverser_print.h</code><br/>
 <code>examples/mdl_sdk/traversal/compiled_material_traverser_print.cpp</code></p>
<div class="fragment"><div class="line"><span class="comment">/******************************************************************************</span></div>
<div class="line"><span class="comment"> * Copyright 2022 NVIDIA Corporation. All rights reserved.</span></div>
<div class="line"><span class="comment"> *****************************************************************************/</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// examples/mdl_sdk/shared/compiled_material_traverser_base.h</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Utility class for traversing compiled materials.</span></div>
<div class="line"><span class="comment">// Derived classes override virtual functions to implement their logic.   </span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifndef COMPILED_MATERIAL_TRAVERSER_BASE_H</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define COMPILED_MATERIAL_TRAVERSER_BASE_H</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#include &quot;example_shared.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// A base class that implements a simple traversal logic for compiled materials.</span></div>
<div class="line"><span class="keyword">class </span>Compiled_material_traverser_base</div>
<div class="line">{</div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Possible stages of the traversal of an compiled material</span></div>
<div class="line">    <span class="keyword">enum</span> Traveral_stage</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Traversal has not been started</span></div>
<div class="line">        ES_NOT_STARTED = 0,</div>
<div class="line">        <span class="comment">// Indicates that the parameters of the material are currently traversed</span></div>
<div class="line">        ES_PARAMETERS,</div>
<div class="line">        <span class="comment">// Indicates that the temporaries of the material are currently traversed</span></div>
<div class="line">        ES_TEMPORARIES,</div>
<div class="line">        <span class="comment">// Indicates that the main body of the material are currently traversed</span></div>
<div class="line">        ES_BODY,</div>
<div class="line">        <span class="comment">// Traversal is done</span></div>
<div class="line">        ES_FINISHED,</div>
<div class="line"></div>
<div class="line">        <span class="comment">// For alignment only.</span></div>
<div class="line">        ES_FORCE_32_BIT = 0xffffffffU</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="comment">// An internal structure that is passed to the user code while traversing.</span></div>
<div class="line">    <span class="comment">// This struct is used while visiting the material parameters.</span></div>
<div class="line">    <span class="keyword">struct </span>Parameter</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">explicit</span> Parameter(<span class="keyword">const</span> <a class="code" href="classmi_1_1neuraylib_1_1IValue.html" title="The interface to MDL values. ">mi::neuraylib::IValue</a>* value) </div>
<div class="line">            : value(value)</div>
<div class="line">        { }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="classmi_1_1neuraylib_1_1IValue.html" title="The interface to MDL values. ">mi::neuraylib::IValue</a>* value;</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="comment">// An internal structure that is passed to the user code while traversing.</span></div>
<div class="line">    <span class="comment">// This struct is used while visiting the materials temporaries.</span></div>
<div class="line">    <span class="keyword">struct </span>Temporary</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">explicit</span> Temporary(<span class="keyword">const</span> <a class="code" href="classmi_1_1neuraylib_1_1IExpression.html" title="The interface to MDL expressions. ">mi::neuraylib::IExpression</a>* expression) </div>
<div class="line">            : expression(expression)</div>
<div class="line">        { }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="classmi_1_1neuraylib_1_1IExpression.html" title="The interface to MDL expressions. ">mi::neuraylib::IExpression</a>* expression;</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="comment">// Encapsulated to current element that is visited during the traversal</span></div>
<div class="line">    <span class="comment">// It contains either an IExpression, an IValue, a Parameter or a Temporary while the</span></div>
<div class="line">    <span class="comment">// others are nullptr.</span></div>
<div class="line">    <span class="keyword">struct </span>Traversal_element</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">explicit</span> Traversal_element(<span class="keyword">const</span> <a class="code" href="classmi_1_1neuraylib_1_1IExpression.html" title="The interface to MDL expressions. ">mi::neuraylib::IExpression</a>* expression,</div>
<div class="line">                                   <a class="code" href="group__mi__base__types.html#gaa8e6476e3c0fc948ef75264572568791" title="Unsigned integral type that is large enough to hold the size of all types. ">mi::Size</a> sibling_count = 1, <a class="code" href="group__mi__base__types.html#gaa8e6476e3c0fc948ef75264572568791" title="Unsigned integral type that is large enough to hold the size of all types. ">mi::Size</a> sibling_index = 0) </div>
<div class="line">            : expression(expression)</div>
<div class="line">            , value(nullptr)</div>
<div class="line">            , parameter(nullptr)</div>
<div class="line">            , temporary(nullptr)</div>
<div class="line">            , sibling_count(sibling_count)</div>
<div class="line">            , sibling_index(sibling_index)</div>
<div class="line">        { }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">explicit</span> Traversal_element(<span class="keyword">const</span> <a class="code" href="classmi_1_1neuraylib_1_1IValue.html" title="The interface to MDL values. ">mi::neuraylib::IValue</a>* value,</div>
<div class="line">                                   <a class="code" href="group__mi__base__types.html#gaa8e6476e3c0fc948ef75264572568791" title="Unsigned integral type that is large enough to hold the size of all types. ">mi::Size</a> sibling_count = 1, <a class="code" href="group__mi__base__types.html#gaa8e6476e3c0fc948ef75264572568791" title="Unsigned integral type that is large enough to hold the size of all types. ">mi::Size</a> sibling_index = 0)</div>
<div class="line">            : expression(nullptr)</div>
<div class="line">            , value(value)</div>
<div class="line">            , parameter(nullptr)</div>
<div class="line">            , temporary(nullptr)</div>
<div class="line">            , sibling_count(sibling_count)</div>
<div class="line">            , sibling_index(sibling_index)</div>
<div class="line">        { }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">explicit</span> Traversal_element(<span class="keyword">const</span> Parameter* parameter,</div>
<div class="line">                                   <a class="code" href="group__mi__base__types.html#gaa8e6476e3c0fc948ef75264572568791" title="Unsigned integral type that is large enough to hold the size of all types. ">mi::Size</a> sibling_count = 1, <a class="code" href="group__mi__base__types.html#gaa8e6476e3c0fc948ef75264572568791" title="Unsigned integral type that is large enough to hold the size of all types. ">mi::Size</a> sibling_index = 0)</div>
<div class="line">            : expression(nullptr)</div>
<div class="line">            , value(nullptr)</div>
<div class="line">            , parameter(parameter)</div>
<div class="line">            , temporary(nullptr)</div>
<div class="line">            , sibling_count(sibling_count)</div>
<div class="line">            , sibling_index(sibling_index)</div>
<div class="line">        { }</div>
<div class="line"></div>
<div class="line">        <span class="keyword">explicit</span> Traversal_element(<span class="keyword">const</span> Temporary* temporary,</div>
<div class="line">                                   <a class="code" href="group__mi__base__types.html#gaa8e6476e3c0fc948ef75264572568791" title="Unsigned integral type that is large enough to hold the size of all types. ">mi::Size</a> sibling_count = 1, <a class="code" href="group__mi__base__types.html#gaa8e6476e3c0fc948ef75264572568791" title="Unsigned integral type that is large enough to hold the size of all types. ">mi::Size</a> sibling_index = 0)</div>
<div class="line">            : expression(nullptr)</div>
<div class="line">            , value(nullptr)</div>
<div class="line">            , parameter(nullptr)</div>
<div class="line">            , temporary(temporary)</div>
<div class="line">            , sibling_count(sibling_count)</div>
<div class="line">            , sibling_index(sibling_index)</div>
<div class="line">        { }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Not nullptr if the current traversal element is an IExpression.</span></div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="classmi_1_1neuraylib_1_1IExpression.html" title="The interface to MDL expressions. ">mi::neuraylib::IExpression</a>* expression;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Not nullptr if the current traversal element is an IValue.</span></div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="classmi_1_1neuraylib_1_1IValue.html" title="The interface to MDL values. ">mi::neuraylib::IValue</a>* value;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Not nullptr if the current traversal element is a Parameter.</span></div>
<div class="line">        <span class="comment">// This can happen only in the ES_PARAMETERS stage.</span></div>
<div class="line">        <span class="keyword">const</span> Parameter* parameter;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Not nullptr if the current traversal element is a Parameter.</span></div>
<div class="line">        <span class="comment">// This can happen only in the ES_TEMPORARAY stage.</span></div>
<div class="line">        <span class="keyword">const</span> Temporary* temporary;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Total number of children at the parent of the currently traversed element.</span></div>
<div class="line">        <a class="code" href="group__mi__base__types.html#gaa8e6476e3c0fc948ef75264572568791" title="Unsigned integral type that is large enough to hold the size of all types. ">mi::Size</a> sibling_count;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Index of the currently traversed element in the list of children at the parent.</span></div>
<div class="line">        <a class="code" href="group__mi__base__types.html#gaa8e6476e3c0fc948ef75264572568791" title="Unsigned integral type that is large enough to hold the size of all types. ">mi::Size</a> sibling_index;</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"></div>
<div class="line">    <span class="comment">// virtual destructor</span></div>
<div class="line">    <span class="keyword">virtual</span> ~Compiled_material_traverser_base() {}; <span class="comment">/* = default;*/</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Traverses a compiled material and calls the corresponding virtual visit methods.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// This method is meant to be called by deriving class to start the actual traversal.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Param:          material    The material that is traversed.</span></div>
<div class="line">    <span class="comment">// Param: [in,out] context     User defined context that is passed through without changes.</span></div>
<div class="line">    <span class="keywordtype">void</span> traverse(<span class="keyword">const</span> <a class="code" href="classmi_1_1neuraylib_1_1ICompiled__material.html" title="This interface represents a compiled material. ">mi::neuraylib::ICompiled_material</a>* material, <span class="keywordtype">void</span>* context);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="comment">// Called at the beginning of each traversal stage: Parameters, Temporaries and Body.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Param:          material    The material that is traversed.</span></div>
<div class="line">    <span class="comment">// Param:          stage       The stage that was entered.</span></div>
<div class="line">    <span class="comment">// Param: [in,out] context     User defined context that is passed through without changes.</span></div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> stage_begin(<span class="keyword">const</span> <a class="code" href="classmi_1_1neuraylib_1_1ICompiled__material.html" title="This interface represents a compiled material. ">mi::neuraylib::ICompiled_material</a>* material,</div>
<div class="line">                             Traveral_stage stage, <span class="keywordtype">void</span>* context) {};</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="comment">// Called at the end of each traversal stage: Parameters, Temporaries and Body.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Param:          material    The material that is traversed.</span></div>
<div class="line">    <span class="comment">// Param:          stage       The stage that was finished.</span></div>
<div class="line">    <span class="comment">// Param: [in,out] context     User defined context that is passed through without changes.</span></div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> stage_end(<span class="keyword">const</span> <a class="code" href="classmi_1_1neuraylib_1_1ICompiled__material.html" title="This interface represents a compiled material. ">mi::neuraylib::ICompiled_material</a>* material,</div>
<div class="line">                           Traveral_stage stage, <span class="keywordtype">void</span>* context) {};</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="comment">// Called when the traversal reaches a new element.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Param:          material    The material that is traversed.</span></div>
<div class="line">    <span class="comment">// Param:          element     The element that was reached.</span></div>
<div class="line">    <span class="comment">// Param: [in,out] context     User defined context that is passed through without changes.</span></div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> visit_begin(<span class="keyword">const</span> <a class="code" href="classmi_1_1neuraylib_1_1ICompiled__material.html" title="This interface represents a compiled material. ">mi::neuraylib::ICompiled_material</a>* material,</div>
<div class="line">                             <span class="keyword">const</span> Traversal_element&amp; element, <span class="keywordtype">void</span>* context) {};</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="comment">// Occurs only if the current element has multiple child elements, e.g., a function call.</span></div>
<div class="line">    <span class="comment">// In that case, the method is called before each of the children are traversed, e.g.,</span></div>
<div class="line">    <span class="comment">// before each argument of a function call.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Param:          material        The material that is traversed.</span></div>
<div class="line">    <span class="comment">// Param:          element         The currently traversed element with multiple children.</span></div>
<div class="line">    <span class="comment">// Param:          children_count  Number of children of the current element.</span></div>
<div class="line">    <span class="comment">// Param:          child_index     The index of the child that will be traversed next.</span></div>
<div class="line">    <span class="comment">// Param: [in,out] context         User defined context that is passed through without changes.</span></div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> visit_child(<span class="keyword">const</span> <a class="code" href="classmi_1_1neuraylib_1_1ICompiled__material.html" title="This interface represents a compiled material. ">mi::neuraylib::ICompiled_material</a>* material,</div>
<div class="line">                             <span class="keyword">const</span> Traversal_element&amp; element,</div>
<div class="line">                             <a class="code" href="group__mi__base__types.html#gaa8e6476e3c0fc948ef75264572568791" title="Unsigned integral type that is large enough to hold the size of all types. ">mi::Size</a> children_count, <a class="code" href="group__mi__base__types.html#gaa8e6476e3c0fc948ef75264572568791" title="Unsigned integral type that is large enough to hold the size of all types. ">mi::Size</a> child_index,</div>
<div class="line">                             <span class="keywordtype">void</span>* context) {};</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="comment">// Called when the traversal reaches finishes an element.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Param:          material    The material that is traversed.</span></div>
<div class="line">    <span class="comment">// Param:          element     The element that is finished.</span></div>
<div class="line">    <span class="comment">// Param: [in,out] context     User defined context that is passed through without changes.</span></div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> visit_end(<span class="keyword">const</span> <a class="code" href="classmi_1_1neuraylib_1_1ICompiled__material.html" title="This interface represents a compiled material. ">mi::neuraylib::ICompiled_material</a>* material,</div>
<div class="line">                           <span class="keyword">const</span> Traversal_element&amp; element, <span class="keywordtype">void</span>* context) {};</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="comment">// Gets the name of a parameter of the traversed material.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Param:  material        The material that is traversed.</span></div>
<div class="line">    <span class="comment">// Param:  index           Index of the parameter in the materials parameter list.</span></div>
<div class="line">    <span class="comment">// Param:  out_generated   Optional output parameter that indicates whether the parameter </span></div>
<div class="line">    <span class="comment">//                         was generated by the compiler rather than defined in the </span></div>
<div class="line">    <span class="comment">//                         material definition.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Return: The parameter name.</span></div>
<div class="line">    std::string get_parameter_name(<span class="keyword">const</span> <a class="code" href="classmi_1_1neuraylib_1_1ICompiled__material.html" title="This interface represents a compiled material. ">mi::neuraylib::ICompiled_material</a>* material,</div>
<div class="line">                                         <a class="code" href="group__mi__base__types.html#gaa8e6476e3c0fc948ef75264572568791" title="Unsigned integral type that is large enough to hold the size of all types. ">mi::Size</a> index, <span class="keywordtype">bool</span>* out_generated = <span class="keyword">nullptr</span>) <span class="keyword">const</span>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Gets the name of a temporary of the traversed material.</span></div>
<div class="line">    <span class="comment">// Since the name is usually unknown, due to optimization, a proper name is generated.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Param:  material    The material that is traversed.</span></div>
<div class="line">    <span class="comment">// Param:  index       Index of the parameter in the materials temporary list.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Return: The temporary name.</span></div>
<div class="line">    std::string get_temporary_name(<span class="keyword">const</span> <a class="code" href="classmi_1_1neuraylib_1_1ICompiled__material.html" title="This interface represents a compiled material. ">mi::neuraylib::ICompiled_material</a>* material,</div>
<div class="line">                                         <a class="code" href="group__mi__base__types.html#gaa8e6476e3c0fc948ef75264572568791" title="Unsigned integral type that is large enough to hold the size of all types. ">mi::Size</a> index) <span class="keyword">const</span>;</div>
<div class="line"></div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Recursive function that is used for the actual traversal.</span></div>
<div class="line">    <span class="comment">// The names of templates are lost during compilation. Therefore, we generate numbered ones.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Param:          material    The material.</span></div>
<div class="line">    <span class="comment">// Param:          element     The element that is currently visited.</span></div>
<div class="line">    <span class="comment">// Param: [in,out] context     User defined context that is passed through without changes.</span></div>
<div class="line">    <span class="keywordtype">void</span> traverse(<span class="keyword">const</span> <a class="code" href="classmi_1_1neuraylib_1_1ICompiled__material.html" title="This interface represents a compiled material. ">mi::neuraylib::ICompiled_material</a>* material,</div>
<div class="line">                  <span class="keyword">const</span> Traversal_element&amp; element, <span class="keywordtype">void</span>* context);</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#endif // COMPILED_MATERIAL_TRAVERSER_BASE_H</span></div>
</div><!-- fragment --><div align="right"> [<a class="el" href="mi_neuray_example_distilling_glsl.html">Previous</a>] [<a class="el" href="mi_neuray_examples.html">Up</a>] [<a class="el" href="mi_neuray_example_create_module.html">Next</a>] </div> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.4-->
<!-- start footer part -->
<div id="nav-path">
<span class="footeritem">5&#160;April&#160;2022,&#160;20:40, rev.358266</span>
<span class="footeritem"><a href="https://www.nvidia.com/en-us/about-nvidia/legal-info/" target="_blank" shape="rect">&copy; 2022 NVIDIA&nbsp;Corporation.</a> All rights reserved.</span>
</div>
</body>
</html>
