<!-- HTML header for doxygen 1.8.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>Example for Generating Shader Code for an MDL Material</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="images/arcicon.ico" rel="shortcut icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_custom_stylesheet_1_8_4.css" rel="stylesheet" type="text/css"/>
<link rel='stylesheet' href='webfonts/librebaskerville/stylesheet.css' type='text/css'/>
<link rel='stylesheet' href='webfonts/sourcesanspro/stylesheet.css' type='text/css'/>
<!--ARC-->
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="blackheader">
<span id="blackheader_title">MDL SDK API</span>
<span>
<img src="images/nvidia_logo_transpbg.gif" alt="nvidia_logo_transpbg.gif" style=" height:1.25em; width:6.806em;"/></span>
<span id="blackheader_uplink">
<a href='../index.html' class='top_page_nav'>Up</a>
</span>
</div>
<!--
<div id="titlearea">
   <span id="projectname">
     <a id="titlelink" href="../../index.html">
       MDL SDK API
     </a>
   </span>
     <a id="projectlogo" href="http://www.nvidia-arc.com">
       <img alt="NVIDIA logo" src="images/nvidia_logo.png" style="height:2em;">
       </a>
     <a href='../index.html' class='top_page_nav'>Up</a>
</div>
-->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('mi_neuray_example_code_gen.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Example for Generating Shader Code for an MDL Material </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div align="right"> [<a class="el" href="mi_neuray_example_compilation.html">Previous</a>] [<a class="el" href="mi_neuray_examples.html">Up</a>] [<a class="el" href="mi_neuray_example_execution_native.html">Next</a>] </div><p>This example illustrates the necessary steps from loading an MDL module and processing a material up to the point where shader code is generated and potentially serialized. In addition to the more complex <a class="el" href="mi_neuray_example_dxr.html">Example for a Microsoft DXR-based MDL-enabled Path Tracer</a> and <a class="el" href="mi_neuray_example_df_cuda.html">Example for Compiled Distribution Functions (PTX)</a>, this example focuses only on the key steps required for code generation without any renderer specific work in order to provide a quick and precise overview.</p>
<h1><a class="anchor" id="example_code_gen_new"></a>
New Topics</h1>
<ul>
<li>Different compilation modes and options between</li>
<li>Target code generation for a material with multiple functions</li>
<li>Target code serialization</li>
</ul>
<h1><a class="anchor" id="example_code_gen_descr"></a>
Detailed Description</h1>
<dl>
<dt><b> Different compilation modes and options between </b> </dt>
<dd><p class="startdd"><br/>
 Please refer to <a class="el" href="mi_neuray_compiler.html#mi_neuray_compilation_modes">Instance-compilation and class-compilation</a> and the <a class="el" href="mi_neuray_example_compilation.html">Example for Compilation of MDL Materials</a> for an introduction in instance and class compilation modes.</p>
<p>When in class compilation mode, there are options to enable individual optimizations to narrow the performance gap towards instance compilation while sacrificing parts of the real-time parameter edits.</p>
<p><code>fold_ternary_on_df</code>, <code>fold_all_bool_parameters</code>, and <code>fold_all_enum_parameters</code> reduce branching within the material by evaluating the corresponding conditions during compilation. The unused cases are not handled by the generated code anymore and therefore require recompilation and code regeneration whenever such a condition variable changed. The benefit of these optimizations are twofold, less branching for faster execution times and smaller generated code which potentially reduces the compile time of the generated code as well.</p>
<p class="enddd"></p>
</dd>
<dt><b> Target code generation for a material with multiple functions </b> </dt>
<dd><p class="startdd"><br/>
 Depending on the renderer, code for multiple functions of an MDL material needs to be generated in order to produce a full-featured rendering.</p>
<p>When integrating MDL into a renderer one would start with the <code>"surface.scattering"</code> expression which is responsible for the scattering behavior and thereby the most important aspect of the visual appearance. In addition to that, <code>"geometry.cutout_opacity"</code> is required the handle transparent or semi-transparent surfaces like leafs of a plant or wire fences. There are more expressions to account for and the example shows how to select them and how to register them at a link unit for code generation. For the actual use in a renderer please have a look at the more complex examples mentioned above.</p>
<p class="enddd"></p>
</dd>
<dt><b> Target code serialization </b> </dt>
<dd><p class="startdd"><br/>
 The target code can also be serialized for later reuse. This can reduce the startup time for larger scenes that have been loaded before or for materials that are very likely to appear in a lot of scenes. The glTF-support materials used by the example DXR could be good candidates for such likely used materials.</p>
<p>When deserializing a previously serialized target code object the entire code generation can be skipped. Additional time can be saved when also storing the compiled shaders along with the target code. See <a class="el" href="mi_neuray_example_dxr.html">Example for a Microsoft DXR-based MDL-enabled Path Tracer</a> which makes use of this feature when enabled using the CLI or the user interface.</p>
<p>The hash of the <a class="el" href="classmi_1_1neuraylib_1_1ICompiled__material.html" title="This interface represents a compiled material. ">mi::neuraylib::ICompiled_material</a> is used as an identifier to store the information during serialization and to select to stored data when loading. Changes in MDL SDK version for instance are detected during deserializing. This helps to avoid problems with outdated cached data.</p>
<p class="enddd"></p>
</dd>
</dl>
<h1><a class="anchor" id="example_code_gen"></a>
Example Source</h1>
<p><b>Source Code Location:</b> <code>examples/mdl_sdk/code_gen/example_code_gen.cpp</code></p>
<div class="fragment"><div class="line"><span class="comment">/******************************************************************************</span></div>
<div class="line"><span class="comment"> * Copyright 2022 NVIDIA Corporation. All rights reserved.</span></div>
<div class="line"><span class="comment"> *****************************************************************************/</span></div>
<div class="line"></div>
<div class="line"> <span class="comment">// examples/mdl_sdk/code_gen/example_code_gen.cpp</span></div>
<div class="line"> <span class="comment">//</span></div>
<div class="line"> <span class="comment">// Loads an MDL material and processes it up to code generation and beyond.</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cctype&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;example_shared.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using</span> TD = <a class="code" href="structmi_1_1neuraylib_1_1Target__function__description.html" title="Description of target function. ">mi::neuraylib::Target_function_description</a>;  <span class="comment">// only for readability</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>Options</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> print_usage(std::ostream&amp; s);</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> parse(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[]);</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> m_help = <span class="keyword">false</span>;</div>
<div class="line">    <span class="keywordtype">bool</span> m_nostdpath = <span class="keyword">false</span>;</div>
<div class="line">    std::vector&lt;std::string&gt; m_mdl_paths;</div>
<div class="line">    std::string m_output_file;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> m_use_class_compilation = <span class="keyword">true</span>;</div>
<div class="line">    <span class="keywordtype">bool</span> m_fold_ternary_on_df = <span class="keyword">false</span>;</div>
<div class="line">    <span class="keywordtype">bool</span> m_fold_all_bool_parameters = <span class="keyword">false</span>;</div>
<div class="line">    <span class="keywordtype">bool</span> m_fold_all_enum_parameters = <span class="keyword">false</span>;</div>
<div class="line">    <span class="keywordtype">bool</span> m_ignore_noinline = <span class="keyword">true</span>;</div>
<div class="line">    std::string m_backend = <span class="stringliteral">&quot;hlsl&quot;</span>;</div>
<div class="line">    <span class="keywordtype">bool</span> m_use_derivatives = <span class="keyword">false</span>;</div>
<div class="line">    std::string m_num_texture_results = <span class="stringliteral">&quot;16&quot;</span>;</div>
<div class="line"></div>
<div class="line">    std::string m_qualified_material_name = <span class="stringliteral">&quot;::nvidia::sdk_examples::tutorials::example_material&quot;</span>;</div>
<div class="line"></div>
<div class="line">    std::vector&lt;TD&gt; m_descs;</div>
<div class="line">    std::vector&lt;std::unique_ptr&lt;std::string&gt; &gt; m_desc_strs;  <span class="comment">// collection for storing the strings</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifndef MDL_SOURCE_RELEASE</span></div>
<div class="line"><span class="preprocessor"></span>    std::string m_distilling_target = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>};</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> dump_dag(</div>
<div class="line">    <a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html" title="A transaction provides a consistent view on the database. ">mi::neuraylib::ITransaction</a> *transaction,</div>
<div class="line">    <a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html" title="Factory for various MDL interfaces and functions. ">mi::neuraylib::IMdl_factory</a> *mdl_factory,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classmi_1_1neuraylib_1_1ICompiled__material.html" title="This interface represents a compiled material. ">mi::neuraylib::ICompiled_material</a> *cm,</div>
<div class="line">    std::ostream &amp;s)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IType_factory&gt;</a> tf(</div>
<div class="line">        mdl_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html#ae32b4ecd78cbbe5212f8daf1552180c3" title="Returns an MDL type factory for the given transaction. ">create_type_factory</a>(transaction));</div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html">mi::base::Handle&lt;mi::neuraylib::IValue_factory&gt;</a> vf(</div>
<div class="line">        mdl_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html#a76919730caa41d98004f3edcff45d1df" title="Returns an MDL value factory for the given transaction. ">create_value_factory</a>(transaction));</div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html">mi::base::Handle&lt;mi::neuraylib::IExpression_factory&gt;</a> ef(</div>
<div class="line">        mdl_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html#aaa79f7a5d2d2973f7d34e007f22fc949" title="Returns an MDL expression factory for the given transaction. ">create_expression_factory</a>(transaction));</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (<a class="code" href="group__mi__base__types.html#gaa8e6476e3c0fc948ef75264572568791" title="Unsigned integral type that is large enough to hold the size of all types. ">mi::Size</a> i = 0; i &lt; cm-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ICompiled__material.html#a32fdd71c7faf888b402287857b1c4380" title="Returns the number of parameters used by this compiled material. ">get_parameter_count</a>(); ++i) {</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IValue&gt;</a> argument(cm-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ICompiled__material.html#a592a6add4b9d93576f6b77bb3236cc25" title="Returns the value of an argument. ">get_argument</a>(i));</div>
<div class="line">        std::stringstream name;</div>
<div class="line">        name &lt;&lt; i;</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::IString&gt;</a> result(</div>
<div class="line">            vf-&gt;dump(argument.get(), name.str().c_str(), 1));</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span> *pn = cm-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ICompiled__material.html#a46415cda96452bab97dbaeaaea5e8ce6" title="Returns the name of a parameter. ">get_parameter_name</a>(i);</div>
<div class="line">        <span class="keywordflow">if</span> (!pn)</div>
<div class="line">            pn = <span class="stringliteral">&quot;n/a&quot;</span>;</div>
<div class="line">        s &lt;&lt; <span class="stringliteral">&quot;    argument (original parameter name: &quot;</span> &lt;&lt; pn &lt;&lt; <span class="stringliteral">&quot;) &quot;</span></div>
<div class="line">            &lt;&lt; result-&gt;get_c_str() &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (<a class="code" href="group__mi__base__types.html#ga607bb87332bf166dbd67cb30ca30da3a" title="32-bit unsigned integer. ">mi::Uint32</a> i = 0; i &lt; cm-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ICompiled__material.html#a0855e3eeb8a54f46061c56554ae08ff7" title="Returns the number of temporaries used by this compiled material. ">get_temporary_count</a>(); ++i) {</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IExpression&gt;</a> temporary(cm-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ICompiled__material.html#aa86384c36521f150f3bd5d7cbe1e2fcb" title="Returns the expression of a temporary. ">get_temporary</a>(i));</div>
<div class="line">        std::stringstream name;</div>
<div class="line">        name &lt;&lt; i;</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::IString&gt;</a> result(</div>
<div class="line">            ef-&gt;dump(temporary.get(), name.str().c_str(), 1));</div>
<div class="line">        s &lt;&lt; <span class="stringliteral">&quot;    temporary &quot;</span> &lt;&lt; result-&gt;get_c_str() &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IExpression_direct_call&gt;</a> body(cm-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ICompiled__material.html#a3dd4bc11edb0ce29f2e70cfb4914ffe9" title="Returns the direct call expression that represents the body of the compiled material. ">get_body</a>());</div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::IString&gt;</a> result(</div>
<div class="line">        ef-&gt;dump(body.get(), 0, 1));</div>
<div class="line">    s &lt;&lt; <span class="stringliteral">&quot;    body &quot;</span> &lt;&lt; result-&gt;get_c_str() &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> code_gen(<a class="code" href="classmi_1_1neuraylib_1_1INeuray.html" title="This is an object representing the MDL SDK library. ">mi::neuraylib::INeuray</a>* neuray, Options&amp; options)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Access the database and create a transaction.</span></div>
<div class="line">    <span class="comment">// This is required for loading MDL modules and their dependencies.</span></div>
<div class="line">    <span class="comment">// All loaded elements are stored in the DB as soon as the transaction is</span></div>
<div class="line">    <span class="comment">// committed. Until then, changes are only visible to the current open transaction.</span></div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IDatabase&gt;</a> database(</div>
<div class="line">        neuray-&gt;<a class="code" href="classmi_1_1neuraylib_1_1INeuray.html#a4e107568bbb0e64f61fb4b59b93607fa" title="Returns an API component from the MDL SDK API. ">get_api_component</a>&lt;<a class="code" href="classmi_1_1neuraylib_1_1IDatabase.html" title="This interface is used to interact with the distributed database. ">mi::neuraylib::IDatabase</a>&gt;());</div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IScope&gt;</a> scope(database-&gt;get_global_scope());</div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html">mi::base::Handle&lt;mi::neuraylib::ITransaction&gt;</a> trans(scope-&gt;create_transaction());</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IMdl_impexp_api&gt;</a> mdl_impexp_api(</div>
<div class="line">            neuray-&gt;<a class="code" href="classmi_1_1neuraylib_1_1INeuray.html#a4e107568bbb0e64f61fb4b59b93607fa" title="Returns an API component from the MDL SDK API. ">get_api_component</a>&lt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__impexp__api.html" title="API component for MDL related import and export operations. ">mi::neuraylib::IMdl_impexp_api</a>&gt;());</div>
<div class="line"></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html">mi::base::Handle&lt;mi::neuraylib::IMdl_factory&gt;</a> mdl_factory(</div>
<div class="line">            neuray-&gt;<a class="code" href="classmi_1_1neuraylib_1_1INeuray.html#a4e107568bbb0e64f61fb4b59b93607fa" title="Returns an API component from the MDL SDK API. ">get_api_component</a>&lt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html" title="Factory for various MDL interfaces and functions. ">mi::neuraylib::IMdl_factory</a>&gt;());</div>
<div class="line"></div>
<div class="line">        <span class="comment">// The context is used to pass options to different components and operations.</span></div>
<div class="line">        <span class="comment">// It also carries errors, warnings, and warnings produces by the operations.</span></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle &lt; mi::neuraylib::IMdl_execution_context&gt;</a> context(</div>
<div class="line">            mdl_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html#a78a9a6489592c90ea49e0fe0ac8be235" title="Creates an execution context. ">create_execution_context</a>());</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Split the material name passed on the command line into a module</span></div>
<div class="line">        <span class="comment">// and (unqualified) material name</span></div>
<div class="line">        <span class="comment">// The expected input is fully-qualified absolute MDL material name of the form:</span></div>
<div class="line">        <span class="comment">// [::&lt;package&gt;]::&lt;module&gt;::&lt;material&gt;</span></div>
<div class="line">        std::string module_name, material_name;</div>
<div class="line">        <span class="keywordflow">if</span> (!mi::examples::mdl::parse_cmd_argument_material_name(</div>
<div class="line">            options.m_qualified_material_name, module_name, material_name))</div>
<div class="line">                exit_failure(<span class="stringliteral">&quot;Failed to parse the qualified material name: %s&quot;</span>,</div>
<div class="line">                    options.m_qualified_material_name.c_str());</div>
<div class="line"></div>
<div class="line">        <span class="comment">// ----------------------------------------------------------------------------------------</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">// Load the selected module.</span></div>
<div class="line">        mdl_impexp_api-&gt;load_module(trans.get(), module_name.c_str(), context.<a class="code" href="classmi_1_1base_1_1Handle.html#ab28423d4121459d4026449e4991f5486" title="Access to the interface. Returns 0 for an invalid interface. ">get</a>());</div>
<div class="line">        <span class="keywordflow">if</span> (!print_messages(context.get()))</div>
<div class="line">            exit_failure(<span class="stringliteral">&quot;Failed to load the selected module.&quot;</span>);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Access the module by name, which has to be queried using the factory.</span></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::IString&gt;</a> module_db_name(</div>
<div class="line">            mdl_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html#a72a27c9e0d66e79391ff9a8e3ce4a119" title="Returns the DB name for the MDL name of a module (or file path for MDLE modules). ...">get_db_module_name</a>(module_name.c_str()));</div>
<div class="line"></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IModule&gt;</a> module(</div>
<div class="line">            trans-&gt;access&lt;<a class="code" href="classmi_1_1neuraylib_1_1IModule.html" title="This interface represents an MDL module. ">mi::neuraylib::IModule</a>&gt;(module_db_name-&gt;get_c_str()));</div>
<div class="line">        <span class="keywordflow">if</span> (!module)</div>
<div class="line">            exit_failure(<span class="stringliteral">&quot;Failed to access the loaded module.&quot;</span>);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// ----------------------------------------------------------------------------------------</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">// Access the material definition of the selected material.</span></div>
<div class="line">        <span class="comment">// A module can export multiple materials or none at all.</span></div>
<div class="line">        std::string material_db_name</div>
<div class="line">            = std::string(module_db_name-&gt;get_c_str()) + <span class="stringliteral">&quot;::&quot;</span> + material_name;</div>
<div class="line">        material_db_name = mi::examples::mdl::add_missing_material_signature(</div>
<div class="line">            module.get(), material_db_name);</div>
<div class="line">        <span class="keywordflow">if</span> (material_db_name.empty())</div>
<div class="line">            exit_failure(<span class="stringliteral">&quot;Failed to find the material %s in the module %s.&quot;</span>,</div>
<div class="line">                material_name.c_str(), module_name.c_str());</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Check if there is such a definition.</span></div>
<div class="line">        <span class="comment">// This is not really required here because the definition wrapper in the next step</span></div>
<div class="line">        <span class="comment">// will also check if the definition is valid.</span></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IFunction_definition&gt;</a> material_definition(</div>
<div class="line">            trans-&gt;access&lt;<a class="code" href="classmi_1_1neuraylib_1_1IFunction__definition.html" title="This interface represents a function definition. ">mi::neuraylib::IFunction_definition</a>&gt;(material_db_name.c_str()));</div>
<div class="line">        <span class="keywordflow">if</span> (!material_definition)</div>
<div class="line">            exit_failure(<span class="stringliteral">&quot;Failed to access the material definition.&quot;</span>);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// ----------------------------------------------------------------------------------------</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">// Create an instance of the material.</span></div>
<div class="line">        <span class="comment">// An easy way to do that is by using the definition wrapper which makes sure that there</span></div>
<div class="line">        <span class="comment">// are valid parameters set even when there are no default values defined in MDL source.</span></div>
<div class="line">        <a class="code" href="classmi_1_1neuraylib_1_1Definition__wrapper.html" title="A wrapper around the interface for MDL material and function definitions. ">mi::neuraylib::Definition_wrapper</a> dw(</div>
<div class="line">            trans.get(), material_db_name.c_str(), mdl_factory.get());</div>
<div class="line">        <span class="keywordflow">if</span> (!dw.is_valid())</div>
<div class="line">            exit_failure(<span class="stringliteral">&quot;Failed to access the material definition.&quot;</span>);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="group__mi__base__types.html#gafcdcb44319b0596ee8a9a44fddaec8c6" title="32-bit signed integer. ">mi::Sint32</a> result = -1;</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IFunction_call&gt;</a> material_instance(</div>
<div class="line">            dw.create_instance&lt;<a class="code" href="classmi_1_1neuraylib_1_1IFunction__call.html" title="This interface represents a function call. ">mi::neuraylib::IFunction_call</a>&gt;(<span class="keyword">nullptr</span>, &amp;result));</div>
<div class="line">        <span class="keywordflow">if</span> (result != 0)</div>
<div class="line">            exit_failure(<span class="stringliteral">&quot;Failed to create a material instance of: %s::%s (%d)&quot;</span>,</div>
<div class="line">                module_name.c_str(), material_name.c_str(), result);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Alternatively, the instance can be created without the definition wrapper using:</span></div>
<div class="line">        <span class="comment">// material_definition-&gt;create_function_call(...)</span></div>
<div class="line">        <span class="comment">// In that case the API user needs to provide a argument list at least for those parameters</span></div>
<div class="line">        <span class="comment">// that do not have a default value.</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">// ----------------------------------------------------------------------------------------</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">// The next step is to create a compiled material. This already applies some optimizations</span></div>
<div class="line">        <span class="comment">// depending on the following flags and context options.</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">// class and instance compilation is a trade-off between real-time parameter editing and</span></div>
<div class="line">        <span class="comment">// performance optimization.</span></div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="group__mi__base__types.html#ga607bb87332bf166dbd67cb30ca30da3a" title="32-bit unsigned integer. ">mi::Uint32</a> flags = options.m_use_class_compilation</div>
<div class="line">            ? <a class="code" href="classmi_1_1neuraylib_1_1IMaterial__instance.html#ab0b7608e59f1ad96b00a2fbb5cc2d959a7474d76ee055edda39a494edf06cfc36" title="Selects class compilation instead of instance compilation. ">mi::neuraylib::IMaterial_instance::CLASS_COMPILATION</a></div>
<div class="line">            : <a class="code" href="classmi_1_1neuraylib_1_1IMaterial__instance.html#ab0b7608e59f1ad96b00a2fbb5cc2d959afdcc06252ec8a89909ddd69006031766" title="Default compilation options (e.g., instance compilation). ">mi::neuraylib::IMaterial_instance::DEFAULT_OPTIONS</a>; <span class="comment">// Instance Compilation</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">// Set more optimization options (by default, they are all disabled)</span></div>
<div class="line">        <span class="comment">// The first three only affect class compilation and allow to select individual</span></div>
<div class="line">        <span class="comment">// optimizations to narrow the performance gap towards instance compilation while</span></div>
<div class="line">        <span class="comment">// sacrificing some parts of the real-time parameter edits.</span></div>
<div class="line">        context-&gt;set_option(<span class="stringliteral">&quot;fold_ternary_on_df&quot;</span>, options.m_fold_ternary_on_df);</div>
<div class="line">        context-&gt;set_option(<span class="stringliteral">&quot;fold_all_bool_parameters&quot;</span>, options.m_fold_all_bool_parameters);</div>
<div class="line">        context-&gt;set_option(<span class="stringliteral">&quot;fold_all_enum_parameters&quot;</span>, options.m_fold_all_enum_parameters);</div>
<div class="line">        context-&gt;set_option(<span class="stringliteral">&quot;ignore_noinline&quot;</span>, options.m_ignore_noinline);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IMaterial_instance&gt;</a> material_instance2(</div>
<div class="line">            material_instance-&gt;get_interface&lt;<a class="code" href="classmi_1_1neuraylib_1_1IMaterial__instance.html" title="This interface represents a material instance. ">mi::neuraylib::IMaterial_instance</a>&gt;());</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::ICompiled_material&gt;</a> compiled_material(</div>
<div class="line">            material_instance2-&gt;create_compiled_material(flags, context.get()));</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifndef MDL_SOURCE_RELEASE</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="comment">// ----------------------------------------------------------------------------------------</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">// In case the material should be distilled before generating code,</span></div>
<div class="line">        <span class="comment">// the compiled material will be transformed before going on.</span></div>
<div class="line">        <span class="comment">// Usually distilling is used to simplify a material or to convert it to an uber-shader.</span></div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!options.m_distilling_target.empty()) {</div>
<div class="line">            <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IMdl_distiller_api&gt;</a> distiller(</div>
<div class="line">                neuray-&gt;<a class="code" href="classmi_1_1neuraylib_1_1INeuray.html#a4e107568bbb0e64f61fb4b59b93607fa" title="Returns an API component from the MDL SDK API. ">get_api_component</a>&lt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__distiller__api.html" title="Provides access to various functionality related to MDL distilling. ">mi::neuraylib::IMdl_distiller_api</a>&gt;());</div>
<div class="line"></div>
<div class="line">            <span class="comment">// check if the selected target is known</span></div>
<div class="line">            <span class="keywordtype">bool</span> target_supported = <span class="keyword">false</span>;</div>
<div class="line">            <span class="keywordflow">for</span> (<a class="code" href="group__mi__base__types.html#gaa8e6476e3c0fc948ef75264572568791" title="Unsigned integral type that is large enough to hold the size of all types. ">mi::Size</a> i = 0, n = distiller-&gt;get_target_count(); i &lt; n; ++i) {</div>
<div class="line">                <span class="keywordflow">if</span> (options.m_distilling_target == distiller-&gt;get_target_name(i)) {</div>
<div class="line">                    target_supported = <span class="keyword">true</span>;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (!target_supported)</div>
<div class="line">                exit_failure(<span class="stringliteral">&quot;Distilling target &#39;%s&#39; is unknown.&quot;</span>,</div>
<div class="line">                    options.m_distilling_target.c_str());</div>
<div class="line"></div>
<div class="line">            <span class="comment">// The compiled material is transformed to match a given target.</span></div>
<div class="line">            <span class="comment">// Depending on the input and the selected target, the resulting material</span></div>
<div class="line">            <span class="comment">// will match the original in appearance to some extend.</span></div>
<div class="line">            <a class="code" href="group__mi__base__types.html#gafcdcb44319b0596ee8a9a44fddaec8c6" title="32-bit signed integer. ">mi::Sint32</a> result = 0;</div>
<div class="line">            compiled_material = distiller-&gt;distill_material(</div>
<div class="line">                compiled_material.get(), options.m_distilling_target.c_str(), <span class="keyword">nullptr</span>, &amp;result);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (result != 0)</div>
<div class="line">                exit_failure(<span class="stringliteral">&quot;Failed to distill a material instance of: %s::%s (%d)&quot;</span>,</div>
<div class="line">                    module_name.c_str(), material_name.c_str(), result);</div>
<div class="line">        }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">        <span class="comment">// ----------------------------------------------------------------------------------------</span></div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (options.m_backend == <span class="stringliteral">&quot;dag&quot;</span>) {</div>
<div class="line">            <span class="keywordflow">if</span> (!options.m_output_file.empty())</div>
<div class="line">            {</div>
<div class="line">                std::ofstream file_stream;</div>
<div class="line">                file_stream.open(options.m_output_file.c_str());</div>
<div class="line">                <span class="keywordflow">if</span> (file_stream)</div>
<div class="line">                {</div>
<div class="line">                    file_stream &lt;&lt; <span class="stringliteral">&quot;\n\n\n&quot;</span>;</div>
<div class="line">                    dump_dag(trans.get(), mdl_factory.get(), compiled_material.get(), file_stream);</div>
<div class="line">                    file_stream &lt;&lt; <span class="stringliteral">&quot;\n\n\n&quot;</span>;</div>
<div class="line">                    file_stream.close();</div>
<div class="line">                }</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                std::cout &lt;&lt; <span class="stringliteral">&quot;\n\n\n&quot;</span>;</div>
<div class="line">                dump_dag(trans.get(), mdl_factory.get(), compiled_material.get(), std::cout);</div>
<div class="line">                std::cout &lt;&lt; <span class="stringliteral">&quot;\n\n\n&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line"></div>
<div class="line">            <span class="comment">// For generating code we now need to select a back-end</span></div>
<div class="line">            <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IMdl_backend_api&gt;</a> mdl_backend_api(</div>
<div class="line">                neuray-&gt;<a class="code" href="classmi_1_1neuraylib_1_1INeuray.html#a4e107568bbb0e64f61fb4b59b93607fa" title="Returns an API component from the MDL SDK API. ">get_api_component</a>&lt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__backend__api.html" title="This interface can be used to obtain the MDL backends. ">mi::neuraylib::IMdl_backend_api</a>&gt;());</div>
<div class="line"></div>
<div class="line">            <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IMdl_backend&gt;</a> backend;</div>
<div class="line">            <span class="keywordflow">if</span> (options.m_backend == <span class="stringliteral">&quot;hlsl&quot;</span>)</div>
<div class="line">                backend = mdl_backend_api-&gt;get_backend(<a class="code" href="classmi_1_1neuraylib_1_1IMdl__backend__api.html#a28a914c7c51dd45974b16fa189a77b46aeec9f553f75f861556a7249bf7b888e1" title="Generate HLSL code . ">mi::neuraylib::IMdl_backend_api::MB_HLSL</a>);</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (options.m_backend == <span class="stringliteral">&quot;ptx&quot;</span>)</div>
<div class="line">                backend = mdl_backend_api-&gt;get_backend(<a class="code" href="classmi_1_1neuraylib_1_1IMdl__backend__api.html#a28a914c7c51dd45974b16fa189a77b46a9050e3f647dae4f4b39e207399ebf322" title="Generate CUDA PTX code. ">mi::neuraylib::IMdl_backend_api::MB_CUDA_PTX</a>);</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (options.m_backend == <span class="stringliteral">&quot;llvm&quot;</span>)</div>
<div class="line">                backend = mdl_backend_api-&gt;get_backend(<a class="code" href="classmi_1_1neuraylib_1_1IMdl__backend__api.html#a28a914c7c51dd45974b16fa189a77b46ac0fa27a2d4a3941cd1c103ee20e9c596" title="Generate LLVM IR (LLVM 7.0 compatible). ">mi::neuraylib::IMdl_backend_api::MB_LLVM_IR</a>);</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                exit_failure(<span class="stringliteral">&quot;Selected back-end &#39;%s&#39; is invalid or not supported.&quot;</span>,</div>
<div class="line">                    options.m_backend.c_str());</div>
<div class="line"></div>
<div class="line">            <span class="comment">// back-end specific options</span></div>
<div class="line">            backend-&gt;<a class="code" href="group__mi__neuray__mdl__compiler.html#ga1301dec05ba862ca7745814367811f15" title="Sets a backend option. ">set_option</a>(<span class="stringliteral">&quot;texture_runtime_with_derivs&quot;</span>,</div>
<div class="line">                options.m_use_derivatives ? <span class="stringliteral">&quot;on&quot;</span> : <span class="stringliteral">&quot;off&quot;</span>);</div>
<div class="line">            backend-&gt;<a class="code" href="group__mi__neuray__mdl__compiler.html#ga1301dec05ba862ca7745814367811f15" title="Sets a backend option. ">set_option</a>(<span class="stringliteral">&quot;num_texture_results&quot;</span>, options.m_num_texture_results.c_str());</div>
<div class="line">            backend-&gt;<a class="code" href="group__mi__neuray__mdl__compiler.html#ga1301dec05ba862ca7745814367811f15" title="Sets a backend option. ">set_option</a>(<span class="stringliteral">&quot;num_texture_spaces&quot;</span>, <span class="stringliteral">&quot;4&quot;</span>);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// ----------------------------------------------------------------------------------------</span></div>
<div class="line"></div>
<div class="line">            <span class="comment">// and we need a link unit that will contain all the functions we want to generate code for</span></div>
<div class="line">            <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::ILink_unit&gt;</a> link_unit(</div>
<div class="line">                backend-&gt;<a class="code" href="group__mi__neuray__mdl__compiler.html#ga2a47cff09fe1b7ac157f32b168fa93d2" title="Creates a new link unit. ">create_link_unit</a>(trans.get(), context.get()));</div>
<div class="line">            <span class="keywordflow">if</span> (!print_messages(context.get()))</div>
<div class="line">                exit_failure(<span class="stringliteral">&quot;Failed to create a link unit for the %s back-end&quot;</span>,</div>
<div class="line">                    options.m_backend.c_str());</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (options.m_descs.empty()) {</div>
<div class="line">                <span class="comment">// select some default expressions to generate code for.</span></div>
<div class="line">                <span class="comment">// The functions to select depends on the renderer.</span></div>
<div class="line">                <span class="comment">// To get started, generating &#39;surface.scattering&#39; would be enough</span></div>
<div class="line">                <span class="comment">// (see the other examples, like DXR, for how to consume the generated code in a shader).</span></div>
<div class="line">                <span class="keyword">auto</span> &amp;descs = options.m_descs;</div>
<div class="line">                descs.push_back(TD(<span class="stringliteral">&quot;ior&quot;</span>, <span class="stringliteral">&quot;ior&quot;</span>));</div>
<div class="line">                descs.push_back(TD(<span class="stringliteral">&quot;thin_walled&quot;</span>, <span class="stringliteral">&quot;thin_walled&quot;</span>));</div>
<div class="line">                descs.push_back(TD(<span class="stringliteral">&quot;surface.scattering&quot;</span>, <span class="stringliteral">&quot;surface_scattering&quot;</span>));</div>
<div class="line">                descs.push_back(TD(<span class="stringliteral">&quot;surface.emission.emission&quot;</span>, <span class="stringliteral">&quot;surface_emission_emission&quot;</span>));</div>
<div class="line">                descs.push_back(TD(<span class="stringliteral">&quot;surface.emission.intensity&quot;</span>, <span class="stringliteral">&quot;surface_emission_intensity&quot;</span>));</div>
<div class="line">                descs.push_back(TD(<span class="stringliteral">&quot;surface.emission.mode&quot;</span>, <span class="stringliteral">&quot;surface_emission_mode&quot;</span>));</div>
<div class="line">                descs.push_back(TD(<span class="stringliteral">&quot;backface.scattering&quot;</span>, <span class="stringliteral">&quot;backface_scattering&quot;</span>));</div>
<div class="line">                descs.push_back(TD(<span class="stringliteral">&quot;backface.emission.emission&quot;</span>, <span class="stringliteral">&quot;backface_emission_emission&quot;</span>));</div>
<div class="line">                descs.push_back(TD(<span class="stringliteral">&quot;backface.emission.intensity&quot;</span>, <span class="stringliteral">&quot;backface_emission_intensity&quot;</span>));</div>
<div class="line">                descs.push_back(TD(<span class="stringliteral">&quot;backface.emission.mode&quot;</span>, <span class="stringliteral">&quot;backface_emission_mode&quot;</span>));</div>
<div class="line">                descs.push_back(TD(<span class="stringliteral">&quot;volume.absorption_coefficient&quot;</span>, <span class="stringliteral">&quot;volume_absorption_coefficient&quot;</span>));</div>
<div class="line">                descs.push_back(TD(<span class="stringliteral">&quot;volume.scattering_coefficient&quot;</span>, <span class="stringliteral">&quot;volume_scattering_coefficient&quot;</span>));</div>
<div class="line">                descs.push_back(TD(<span class="stringliteral">&quot;geometry.normal&quot;</span>, <span class="stringliteral">&quot;geometry_normal&quot;</span>));</div>
<div class="line">                descs.push_back(TD(<span class="stringliteral">&quot;geometry.cutout_opacity&quot;</span>, <span class="stringliteral">&quot;geometry_cutout_opacity&quot;</span>));</div>
<div class="line">                descs.push_back(TD(<span class="stringliteral">&quot;geometry.displacement&quot;</span>, <span class="stringliteral">&quot;geometry_displacement&quot;</span>));</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            link_unit-&gt;add_material(</div>
<div class="line">                compiled_material.get(), options.m_descs.data(), options.m_descs.size(), context.get());</div>
<div class="line">            <span class="keywordflow">if</span> (!print_messages(context.get()))</div>
<div class="line">                exit_failure(<span class="stringliteral">&quot;Failed to select functions for code generation.&quot;</span>);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// ----------------------------------------------------------------------------------------</span></div>
<div class="line"></div>
<div class="line">            <span class="comment">// Translating the link unit into the target language is the last step and the only one</span></div>
<div class="line">            <span class="comment">// that can be time consuming. All the steps before are designed to be lightweight for</span></div>
<div class="line">            <span class="comment">// interactively changing materials and parameters.</span></div>
<div class="line">            <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::ITarget_code&gt;</a> target_code(</div>
<div class="line">                backend-&gt;<a class="code" href="group__mi__neuray__mdl__compiler.html#gab2db03209c55985f122e47977364d8cf" title="Transforms a link unit to target code. ">translate_link_unit</a>(link_unit.get(), context.get()));</div>
<div class="line">            <span class="keywordflow">if</span> (!print_messages(context.get()))</div>
<div class="line">                exit_failure(<span class="stringliteral">&quot;Failed to translate the link unit to %s code.&quot;</span>,</div>
<div class="line">                    options.m_backend.c_str());</div>
<div class="line"></div>
<div class="line">            <span class="comment">// ----------------------------------------------------------------------------------------</span></div>
<div class="line"></div>
<div class="line">            <span class="comment">// The resulting target code contains all the information that is required for rendering.</span></div>
<div class="line">            <span class="comment">// This includes the actual shader code, resources, constants and an argument block</span></div>
<div class="line">            <span class="comment">// that contains raw parameter data for real-time parameter editing.</span></div>
<div class="line"></div>
<div class="line">            <span class="comment">// Print the generated code. Note, this is not enough. A renderer needs to handle resources,</span></div>
<div class="line">            <span class="comment">// argument blocks and so on as well. Additionally, a renderer runtime is required</span></div>
<div class="line">            <span class="comment">// as an interface between the generated code and the applications resource pipeline.</span></div>
<div class="line">            <span class="keywordflow">if</span> (!options.m_output_file.empty())</div>
<div class="line">            {</div>
<div class="line">                std::ofstream file_stream;</div>
<div class="line">                file_stream.open(options.m_output_file.c_str());</div>
<div class="line">                <span class="keywordflow">if</span> (file_stream)</div>
<div class="line">                {</div>
<div class="line">                    file_stream &lt;&lt; target_code-&gt;get_code();</div>
<div class="line">                    file_stream.close();</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> {</div>
<div class="line">                std::cout &lt;&lt; <span class="stringliteral">&quot;\n\n\n&quot;</span> &lt;&lt; target_code-&gt;get_code() &lt;&lt; <span class="stringliteral">&quot;\n\n\n&quot;</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Serialization is not supported by the LLVM-IR backend.</span></div>
<div class="line">            <span class="keywordflow">if</span> (options.m_backend != <span class="stringliteral">&quot;llvm&quot;</span>) {</div>
<div class="line">                <span class="comment">// If disabled, instance specific data is discarded. this makes sense for applications</span></div>
<div class="line">                <span class="comment">// that use class compilation and reuse materials that only differ in their parameter</span></div>
<div class="line">                <span class="comment">// set, meaning that they have the same hash and thereby the same generated code but</span></div>
<div class="line">                <span class="comment">// different argument blocks. These argument blocks be created separately using the</span></div>
<div class="line">                <span class="comment">// target code and also the deserialized target code.</span></div>
<div class="line">                context-&gt;set_option(<span class="stringliteral">&quot;serialize_class_instance_data&quot;</span>, <span class="keyword">true</span>);</div>
<div class="line"></div>
<div class="line">                <span class="comment">// Serialize the target code object into a buffer.</span></div>
<div class="line">                <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IBuffer&gt;</a> tc_buffer(</div>
<div class="line">                    target_code-&gt;serialize(context.get()));</div>
<div class="line">                <span class="keywordflow">if</span> (!print_messages(context.get()))</div>
<div class="line">                    exit_failure(<span class="stringliteral">&quot;MDL target code serialization failed.&quot;</span>);</div>
<div class="line"></div>
<div class="line">                <span class="comment">// Access the serialized target code data.</span></div>
<div class="line">                <span class="comment">// This is usually stored in some kind of cache along with other application data.</span></div>
<div class="line">                <span class="comment">// For deserialization, use backend-&gt;deserialize_target_code(...)</span></div>
<div class="line">                <span class="comment">/*const size_t tc_buffer_size =*/</span> tc_buffer-&gt;get_data_size();</div>
<div class="line">                <span class="comment">/*const mi::Uint8* tc_buffer_data =*/</span> tc_buffer-&gt;get_data();</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// ----------------------------------------------------------------------------------------</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">// The target code can also be serialized for later reuse.</span></div>
<div class="line">        <span class="comment">// This can make sense to reduce startup time for larger scenes that have been loaded</span></div>
<div class="line">        <span class="comment">// before. A key for this kind of cache is the hash of a compiled material:</span></div>
<div class="line">        <a class="code" href="structmi_1_1base_1_1Uuid.html" title="A 128 bit representation of a universally unique identifier (UUID or GUID). ">mi::base::Uuid</a> hash = compiled_material-&gt;get_hash();</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;compiled material hash: \n&quot;</span> &lt;&lt; std::hex &lt;&lt; hash.<a class="code" href="structmi_1_1base_1_1Uuid.html#a3411d355a53b97f8941b314dca1bd3e7" title="First value. ">m_id1</a> &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; hash.<a class="code" href="structmi_1_1base_1_1Uuid.html#a7d3f41dd856c46b1c45d57e7470546c5" title="Second value. ">m_id2</a></div>
<div class="line">                    &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; hash.<a class="code" href="structmi_1_1base_1_1Uuid.html#addc690e5f4ea722fe555f1c80d41d803" title="Third value. ">m_id3</a> &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; hash.<a class="code" href="structmi_1_1base_1_1Uuid.html#af0c07bd253a05adf553d5978dacdb312" title="Fourth value. ">m_id4</a> &lt;&lt; std::dec  &lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// All transactions need to get committed or aborted before closing the application.</span></div>
<div class="line">    <span class="comment">// The code above is inside a block to ensure that we do not keep handles to database objects</span></div>
<div class="line">    <span class="comment">// while closing the transaction. This would result in an inconsistent state and produce an</span></div>
<div class="line">    <span class="comment">// error message.</span></div>
<div class="line">    trans-&gt;commit();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> MAIN_UTF8(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Parse command line options</span></div>
<div class="line">    Options options;</div>
<div class="line">    mi::examples::mdl::Configure_options configure_options;</div>
<div class="line">    <span class="keywordflow">if</span> (!options.parse(argc, argv))</div>
<div class="line">    {</div>
<div class="line">        options.print_usage(std::cout);</div>
<div class="line">        exit_failure(<span class="stringliteral">&quot;Failed to parse command line arguments.&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (options.m_help) {</div>
<div class="line">        options.print_usage(std::cout);</div>
<div class="line">        exit_success();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Apply the search path setup described on the command line</span></div>
<div class="line">    configure_options.additional_mdl_paths = options.m_mdl_paths;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (options.m_nostdpath)</div>
<div class="line">    {</div>
<div class="line">        configure_options.add_admin_space_search_paths = <span class="keyword">false</span>;</div>
<div class="line">        configure_options.add_user_space_search_paths = <span class="keyword">false</span>;</div>
<div class="line">        configure_options.add_example_search_path = <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Access the MDL SDK</span></div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::INeuray&gt;</a> neuray(mi::examples::mdl::load_and_get_ineuray());</div>
<div class="line">    <span class="keywordflow">if</span> (!neuray.is_valid_interface())</div>
<div class="line">        exit_failure(<span class="stringliteral">&quot;Failed to load the SDK.&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Configure the MDL SDK</span></div>
<div class="line">    <span class="keywordflow">if</span> (!mi::examples::mdl::configure(neuray.get(), configure_options))</div>
<div class="line">        exit_failure(<span class="stringliteral">&quot;Failed to initialize the SDK.&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifndef MDL_SOURCE_RELEASE</span></div>
<div class="line"><span class="preprocessor"></span>    <span class="comment">// Load the distilling plugin</span></div>
<div class="line">    <span class="keywordflow">if</span> (mi::examples::mdl::load_plugin(neuray.get(), <span class="stringliteral">&quot;mdl_distiller&quot;</span> <a class="code" href="group__mi__base__config.html#gad7232312ea690f7c9fd39ee34794d073" title="The operating system specific default filename extension for shared libraries (DLLs) ...">MI_BASE_DLL_FILE_EXT</a>) != 0)</div>
<div class="line">        exit_failure(<span class="stringliteral">&quot;Failed to load the mdl_distiller plugin.&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    <span class="comment">// Start the MDL SDK</span></div>
<div class="line">    <a class="code" href="group__mi__base__types.html#gafcdcb44319b0596ee8a9a44fddaec8c6" title="32-bit signed integer. ">mi::Sint32</a> ret = neuray-&gt;<a class="code" href="classmi_1_1neuraylib_1_1INeuray.html#afdd076cf54b3e1eabbd841bd1f77847b" title="Starts the operation of the MDL SDK library. ">start</a>();</div>
<div class="line">    <span class="keywordflow">if</span> (ret != 0)</div>
<div class="line">        exit_failure(<span class="stringliteral">&quot;Failed to initialize the SDK. Result code: %d&quot;</span>, ret);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// the main content of the example</span></div>
<div class="line">    code_gen(neuray.get(), options);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Shut down the MDL SDK</span></div>
<div class="line">    <span class="keywordflow">if</span> (neuray-&gt;<a class="code" href="classmi_1_1neuraylib_1_1INeuray.html#a01d0574d048798c76f8e29f91a4f6fea" title="Shuts down the library. ">shutdown</a>() != 0)</div>
<div class="line">        exit_failure(<span class="stringliteral">&quot;Failed to shutdown the SDK.&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Unload the MDL SDK</span></div>
<div class="line">    neuray = <span class="keyword">nullptr</span>;</div>
<div class="line">    <span class="keywordflow">if</span> (!mi::examples::mdl::unload())</div>
<div class="line">        exit_failure(<span class="stringliteral">&quot;Failed to unload the SDK.&quot;</span>);</div>
<div class="line"></div>
<div class="line">    exit_success();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Convert command line arguments to UTF8 on Windows</span></div>
<div class="line">COMMANDLINE_TO_UTF8</div>
<div class="line"></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> Options::print_usage(std::ostream&amp; s)</div>
<div class="line">{</div>
<div class="line">    s &lt;&lt; R<span class="stringliteral">&quot;(
code_gen [options] &lt;qualified_material_name&gt;

options:

  -h|--help                     Print this usage message and exit.
  -p|--mdl_path &lt;path&gt;          Add the given path to the MDL search path.
  -n|--nostdpath                Prevent adding the MDL system and user search
                                path(s) to the MDL search path.
  -o|--output &lt;file&gt;            Export the module to this file. Default: stdout
  -b|--backend &lt;backend&gt;        Select the back-end to generate code for. {DAG, HLSL, PTX, LLVM}
                                Default: HLSL
  -e|--expr_path &lt;path&gt;         Add an MDL expression path to generate, like \&quot;surface.scattering\&quot;.
                                Defaults to a set of expression paths.
  -d|--derivatives              Generate code with derivative support.
  -i|--instance_compilation     Use instance compilation instead of class compilation.
  -t|--text_results &lt;num&gt;       Number of float4 texture result slots in the state. Default: 16
  --ft                          Fold ternary operators when used on distribution functions.
  --fb                          Fold boolean parameters.
  --fe                          Fold enum parameters.
  --dian                        Disable ignoring anno::noinline() annotations.)&quot;;</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral"></span><span class="preprocessor">#ifndef MDL_SOURCE_RELEASE</span></div>
<div class="line"><span class="preprocessor"></span>    s &lt;&lt; R<span class="stringliteral">&quot;(
  --distill &lt;target&gt;            Distill the material before running the code generation.)&quot;;</span></div>
<div class="line"><span class="stringliteral"></span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    s &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// ------------------------------------------------------------------------------------------------</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> Options::parse(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; argc; ++i)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> std::string arg = argv[i];</div>
<div class="line">        <span class="keywordflow">if</span> (arg[0] == <span class="charliteral">&#39;-&#39;</span>) {</div>
<div class="line">            <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;-h&quot;</span> || arg == <span class="stringliteral">&quot;--help&quot;</span>)</div>
<div class="line">                m_help = <span class="keyword">true</span>;</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;-n&quot;</span> || arg == <span class="stringliteral">&quot;--nostdpath&quot;</span>)</div>
<div class="line">                m_nostdpath = <span class="keyword">true</span>;</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;-d&quot;</span> || arg == <span class="stringliteral">&quot;--derivatives&quot;</span>)</div>
<div class="line">                m_use_derivatives = <span class="keyword">true</span>;</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;-i&quot;</span> || arg == <span class="stringliteral">&quot;--instance_compilation&quot;</span>)</div>
<div class="line">                m_use_class_compilation = <span class="keyword">false</span>;</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;--ft&quot;</span>)</div>
<div class="line">                m_fold_ternary_on_df = <span class="keyword">true</span>;</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;--fb&quot;</span>)</div>
<div class="line">                m_fold_all_bool_parameters = <span class="keyword">true</span>;</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;--ft&quot;</span>)</div>
<div class="line">                m_fold_all_enum_parameters = <span class="keyword">true</span>;</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;--dian&quot;</span>)</div>
<div class="line">                m_ignore_noinline = <span class="keyword">false</span>;</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;-p&quot;</span> || arg == <span class="stringliteral">&quot;--mdl_path&quot;</span>)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (i == argc - 1)</div>
<div class="line">                {</div>
<div class="line">                    std::cerr &lt;&lt; <span class="stringliteral">&quot;error: Argument for -p|--mdl_path missing.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">                }</div>
<div class="line">                m_mdl_paths.push_back(argv[++i]);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;-o&quot;</span> || arg == <span class="stringliteral">&quot;--output&quot;</span>)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (i == argc - 1)</div>
<div class="line">                {</div>
<div class="line">                    std::cerr &lt;&lt; <span class="stringliteral">&quot;error: Argument for -o|--output missing.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">                }</div>
<div class="line">                m_output_file = argv[++i];</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;-b&quot;</span> || arg == <span class="stringliteral">&quot;--backend&quot;</span>)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (i == argc - 1)</div>
<div class="line">                {</div>
<div class="line">                    std::cerr &lt;&lt; <span class="stringliteral">&quot;error: Argument for -b|--backend missing.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">                }</div>
<div class="line">                m_backend = argv[++i];</div>
<div class="line">                <a class="code" href="group__mi__math__general.html#ga0f57cf4994b9de573e92535eb456bcfa" title="Generic transform function that applies a unary functor (return value). ">std::transform</a>(m_backend.begin(), m_backend.end(), m_backend.begin(),</div>
<div class="line">                    [](<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> c) { <span class="keywordflow">return</span> std::tolower(c); });</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;-e&quot;</span> || arg == <span class="stringliteral">&quot;--expr_path&quot;</span>)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (i == argc - 1)</div>
<div class="line">                {</div>
<div class="line">                    std::cerr &lt;&lt; <span class="stringliteral">&quot;error: Argument for -e|--expr_path missing.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">                }</div>
<div class="line">                std::string expr = argv[++i];</div>
<div class="line">                std::string func_name = expr;</div>
<div class="line">                <a class="code" href="group__mi__math__general.html#ga0f57cf4994b9de573e92535eb456bcfa" title="Generic transform function that applies a unary functor (return value). ">std::transform</a>(func_name.begin(), func_name.end(), func_name.begin(),</div>
<div class="line">                    [](<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> c) { <span class="keywordflow">return</span> char(c) == <span class="charliteral">&#39;.&#39;</span> ? <span class="charliteral">&#39;_&#39;</span> : c; });</div>
<div class="line">                m_desc_strs.push_back(std::unique_ptr&lt;std::string&gt;(<span class="keyword">new</span> std::string(expr)));</div>
<div class="line">                m_desc_strs.push_back(std::unique_ptr&lt;std::string&gt;(<span class="keyword">new</span> std::string(func_name)));</div>
<div class="line">                m_descs.push_back(TD(</div>
<div class="line">                    m_desc_strs[m_desc_strs.size() - 2].get()-&gt;c_str(),</div>
<div class="line">                    m_desc_strs.back().get()-&gt;c_str()));</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;-t&quot;</span> || arg == <span class="stringliteral">&quot;--text_results&quot;</span>)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (i == argc - 1)</div>
<div class="line">                {</div>
<div class="line">                    std::cerr &lt;&lt; <span class="stringliteral">&quot;error: Argument for -t|--text_results missing.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">                }</div>
<div class="line">                m_num_texture_results = argv[++i];</div>
<div class="line">            }</div>
<div class="line"><span class="preprocessor">    #ifndef MDL_SOURCE_RELEASE</span></div>
<div class="line"><span class="preprocessor"></span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arg == <span class="stringliteral">&quot;--distill&quot;</span>)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (i == argc - 1)</div>
<div class="line">                {</div>
<div class="line">                    std::cerr &lt;&lt; <span class="stringliteral">&quot;error: Argument for --distill missing.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">                }</div>
<div class="line">                m_distilling_target = argv[++i];</div>
<div class="line">            }</div>
<div class="line"><span class="preprocessor">    #endif</span></div>
<div class="line"><span class="preprocessor"></span>            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                std::cerr &lt;&lt; <span class="stringliteral">&quot;error: Unknown option \&quot;&quot;</span> &lt;&lt; arg &lt;&lt; <span class="stringliteral">&quot;\&quot;.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> (i != argc - 1)</div>
<div class="line">            {</div>
<div class="line">                std::cerr &lt;&lt; <span class="stringliteral">&quot;error: Unexpected argument \&quot;&quot;</span> &lt;&lt; arg &lt;&lt; <span class="stringliteral">&quot;\&quot;.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">            }</div>
<div class="line">            m_qualified_material_name = arg;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!m_help)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (m_qualified_material_name.empty())</div>
<div class="line">        {</div>
<div class="line">            std::cerr &lt;&lt; <span class="stringliteral">&quot;error: Qualified material name missing.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (m_backend != <span class="stringliteral">&quot;dag&quot;</span> &amp;&amp; m_backend != <span class="stringliteral">&quot;hlsl&quot;</span> &amp;&amp; m_backend != <span class="stringliteral">&quot;ptx&quot;</span> &amp;&amp; m_backend != <span class="stringliteral">&quot;llvm&quot;</span>)</div>
<div class="line">        {</div>
<div class="line">            std::cerr &lt;&lt; <span class="stringliteral">&quot;error: Back-end is missing or invalid.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"></div><!-- fragment --><div align="right"> [<a class="el" href="mi_neuray_example_compilation.html">Previous</a>] [<a class="el" href="mi_neuray_examples.html">Up</a>] [<a class="el" href="mi_neuray_example_execution_native.html">Next</a>] </div> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.4-->
<!-- start footer part -->
<div id="nav-path">
<span class="footeritem">5&#160;April&#160;2022,&#160;20:40, rev.358266</span>
<span class="footeritem"><a href="https://www.nvidia.com/en-us/about-nvidia/legal-info/" target="_blank" shape="rect">&copy; 2022 NVIDIA&nbsp;Corporation.</a> All rights reserved.</span>
</div>
</body>
</html>
