<!-- HTML header for doxygen 1.8.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>Example for Compilation of MDL Materials</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="images/arcicon.ico" rel="shortcut icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_custom_stylesheet_1_8_4.css" rel="stylesheet" type="text/css"/>
<link rel='stylesheet' href='webfonts/librebaskerville/stylesheet.css' type='text/css'/>
<link rel='stylesheet' href='webfonts/sourcesanspro/stylesheet.css' type='text/css'/>
<!--ARC-->
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="blackheader">
<span id="blackheader_title">MDL SDK API</span>
<span>
<img src="images/nvidia_logo_transpbg.gif" alt="nvidia_logo_transpbg.gif" style=" height:1.25em; width:6.806em;"/></span>
<span id="blackheader_uplink">
<a href='../index.html' class='top_page_nav'>Up</a>
</span>
</div>
<!--
<div id="titlearea">
   <span id="projectname">
     <a id="titlelink" href="../../index.html">
       MDL SDK API
     </a>
   </span>
     <a id="projectlogo" href="http://www.nvidia-arc.com">
       <img alt="NVIDIA logo" src="images/nvidia_logo.png" style="height:2em;">
       </a>
     <a href='../index.html' class='top_page_nav'>Up</a>
</div>
-->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('mi_neuray_example_compilation.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Example for Compilation of MDL Materials </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div align="right"> [<a class="el" href="mi_neuray_example_calls.html">Previous</a>] [<a class="el" href="mi_neuray_examples.html">Up</a>] [<a class="el" href="mi_neuray_example_code_gen.html">Next</a>] </div><p>This example introduces compiled materials and highlights differences between different compilation modes.</p>
<h1><a class="anchor" id="example_compilation_new"></a>
New Topics</h1>
<ul>
<li>Compiled materials</li>
<li>Different compilation modes</li>
<li>Target code generation</li>
</ul>
<h1><a class="anchor" id="example_compilation_descr"></a>
Detailed Description</h1>
<dl>
<dt><b> Compiled materials </b> </dt>
<dd><p class="startdd"><br/>
 A compiled material is a compact, optimized representation of a material instance including all call expressions in its arguments. In this optimization step call expressions for arguments are inlined (similar to function calls in programming languages), constant expressions are folded, common subexpression elimination is taking place, etc.</p>
<p class="enddd"></p>
</dd>
<dt><b> Different compilation modes </b> </dt>
<dd><p class="startdd"><br/>
 Please refer to <a class="el" href="mi_neuray_compiler.html#mi_neuray_compilation_modes">Instance-compilation and class-compilation</a> for an introduction into instance and class compilation modes.</p>
<p>In the output of this example, compare the difference between instance and class compilation mode of the initially created material instance. In class compilation mode, the expression for <code>"surface.scattering.tint"</code> is no longer a constant, but a parameter reference.</p>
<p>Now compare the changes in both representations when an argument like <code>"tint"</code> is changed. In instance compilation mode, the constant changes its value accordingly, and consequently, the hash over all temporaries and fields changes, too. In class compilation mode, only the value of argument 0 changes. All temporaries and fields of the compiled material, and consequently the hash value, remain unchanged.</p>
<p class="enddd"></p>
</dd>
<dt><b> Target code generation </b> </dt>
<dd><p class="startdd"><br/>
 Compiler backends allow to generate code from the abstract representation of compiled materials. There are different backends, e.g., for LLVM IR or CUDA PTX code. These backends can be obtained from <a class="el" href="classmi_1_1neuraylib_1_1IMdl__backend__api.html#a74baca56433d61f89de6b68019b6beb5" title="Returns an MDL backend generator. ">mi::neuraylib::IMdl_backend_api::get_backend()</a>.</p>
<p>Backends support general and backend-specific options to influence the code generation. See <a class="el" href="classmi_1_1neuraylib_1_1IMdl__backend.html" title="MDL backends allow to transform compiled material instances or function calls into target code...">mi::neuraylib::IMdl_backend</a> for details.</p>
<p>Note that target code is not generated for an entire compiled material, but for specific subexpressions of the compiled material, like <code>"surface.scattering.tint"</code>.</p>
<p class="enddd"></p>
</dd>
</dl>
<h1><a class="anchor" id="example_compilation"></a>
Example Source</h1>
<p><b>Source Code Location:</b> <code>examples/mdl_sdk/compilation/example_compilation.cpp</code></p>
<div class="fragment"><div class="line"><span class="comment">/******************************************************************************</span></div>
<div class="line"><span class="comment"> * Copyright 2022 NVIDIA Corporation. All rights reserved.</span></div>
<div class="line"><span class="comment"> *****************************************************************************/</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// examples/mdl_sdk/compilation/example_compilation.cpp</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Introduces compiled materials and highlights differences between different compilation modes.</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;iomanip&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;example_shared.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Command line options structure.</span></div>
<div class="line"><span class="keyword">struct </span>Options {</div>
<div class="line">    <span class="comment">// Materials to use.</span></div>
<div class="line">    std::string material_name;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Expression path to compile.</span></div>
<div class="line">    std::string expr_path;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// If true, changes the arguments of the instantiated material.</span></div>
<div class="line">    <span class="comment">// Will be set to false if the material name or expression path is changed.</span></div>
<div class="line">    <span class="keywordtype">bool</span> change_arguments;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// The constructor.</span></div>
<div class="line">    Options()</div>
<div class="line">        : material_name(<span class="stringliteral">&quot;::nvidia::sdk_examples::tutorials::example_compilation(color)&quot;</span>)</div>
<div class="line">        , expr_path(<span class="stringliteral">&quot;backface.scattering.tint&quot;</span>)</div>
<div class="line">        , change_arguments(true)</div>
<div class="line">    {</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">// Utility function to dump the hash, arguments, temporaries, and fields of a compiled material.</span></div>
<div class="line"><span class="keywordtype">void</span> dump_compiled_material(</div>
<div class="line">    <a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html" title="A transaction provides a consistent view on the database. ">mi::neuraylib::ITransaction</a>* transaction,</div>
<div class="line">    <a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html" title="Factory for various MDL interfaces and functions. ">mi::neuraylib::IMdl_factory</a>* mdl_factory,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classmi_1_1neuraylib_1_1ICompiled__material.html" title="This interface represents a compiled material. ">mi::neuraylib::ICompiled_material</a>* cm,</div>
<div class="line">    std::ostream&amp; s)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html">mi::base::Handle&lt;mi::neuraylib::IValue_factory&gt;</a> value_factory(</div>
<div class="line">        mdl_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html#a76919730caa41d98004f3edcff45d1df" title="Returns an MDL value factory for the given transaction. ">create_value_factory</a>( transaction));</div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html">mi::base::Handle&lt;mi::neuraylib::IExpression_factory&gt;</a> expression_factory(</div>
<div class="line">        mdl_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html#aaa79f7a5d2d2973f7d34e007f22fc949" title="Returns an MDL expression factory for the given transaction. ">create_expression_factory</a>( transaction));</div>
<div class="line"></div>
<div class="line">    <a class="code" href="structmi_1_1base_1_1Uuid.html" title="A 128 bit representation of a universally unique identifier (UUID or GUID). ">mi::base::Uuid</a> hash = cm-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ICompiled__material.html#aa90eb28622b79831f747745c7b0c6163" title="Returns a hash of the body and all temporaries. ">get_hash</a>();</div>
<div class="line">    <span class="keywordtype">char</span> buffer[36];</div>
<div class="line">    snprintf( buffer, <span class="keyword">sizeof</span>( buffer),</div>
<div class="line">        <span class="stringliteral">&quot;%08x %08x %08x %08x&quot;</span>, hash.m_id1, hash.m_id2, hash.m_id3, hash.m_id4);</div>
<div class="line">    s &lt;&lt; <span class="stringliteral">&quot;    hash overall = &quot;</span> &lt;&lt; buffer &lt;&lt; std::endl;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span>( <a class="code" href="group__mi__base__types.html#ga607bb87332bf166dbd67cb30ca30da3a" title="32-bit unsigned integer. ">mi::Uint32</a> i = <a class="code" href="group__mi__neuray__mdl__elements.html#gga4e2cebe47d60cf89b56196471b9ec162a54b9af4f48afe62567b3b03b03fc586f" title="First slot. ">mi::neuraylib::SLOT_FIRST</a>; i &lt;= <a class="code" href="group__mi__neuray__mdl__elements.html#gga4e2cebe47d60cf89b56196471b9ec162ad9e9c11a53ef2eb55a674a3ad2591202" title="Last slot. ">mi::neuraylib::SLOT_LAST</a>; ++i) {</div>
<div class="line">        hash = cm-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ICompiled__material.html#add323fa76aa11b71829ebfc0ada40f1b" title="Returns the hash of a particular material slot. ">get_slot_hash</a>( <a class="code" href="group__mi__neuray__mdl__elements.html#ga4e2cebe47d60cf89b56196471b9ec162" title="Material slots identify parts of a compiled material. ">mi::neuraylib::Material_slot</a>( i));</div>
<div class="line">        snprintf( buffer, <span class="keyword">sizeof</span>( buffer),</div>
<div class="line">            <span class="stringliteral">&quot;%08x %08x %08x %08x&quot;</span>, hash.m_id1, hash.m_id2, hash.m_id3, hash.m_id4);</div>
<div class="line">        s &lt;&lt; <span class="stringliteral">&quot;    hash slot &quot;</span> &lt;&lt; std::setw( 2) &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; = &quot;</span> &lt;&lt; buffer &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="group__mi__base__types.html#gaa8e6476e3c0fc948ef75264572568791" title="Unsigned integral type that is large enough to hold the size of all types. ">mi::Size</a> parameter_count = cm-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ICompiled__material.html#a32fdd71c7faf888b402287857b1c4380" title="Returns the number of parameters used by this compiled material. ">get_parameter_count</a>();</div>
<div class="line">    <span class="keywordflow">for</span>( <a class="code" href="group__mi__base__types.html#gaa8e6476e3c0fc948ef75264572568791" title="Unsigned integral type that is large enough to hold the size of all types. ">mi::Size</a> i = 0; i &lt; parameter_count; ++i) {</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IValue&gt;</a> argument( cm-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ICompiled__material.html#a592a6add4b9d93576f6b77bb3236cc25" title="Returns the value of an argument. ">get_argument</a>( i));</div>
<div class="line">        std::stringstream name;</div>
<div class="line">        name &lt;&lt; i;</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::IString&gt;</a> result(</div>
<div class="line">            value_factory-&gt;dump( argument.get(), name.str().c_str(), 1));</div>
<div class="line">        s &lt;&lt; <span class="stringliteral">&quot;    argument &quot;</span> &lt;&lt; result-&gt;get_c_str() &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="group__mi__base__types.html#gaa8e6476e3c0fc948ef75264572568791" title="Unsigned integral type that is large enough to hold the size of all types. ">mi::Size</a> temporary_count = cm-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ICompiled__material.html#a0855e3eeb8a54f46061c56554ae08ff7" title="Returns the number of temporaries used by this compiled material. ">get_temporary_count</a>();</div>
<div class="line">    <span class="keywordflow">for</span>( <a class="code" href="group__mi__base__types.html#gaa8e6476e3c0fc948ef75264572568791" title="Unsigned integral type that is large enough to hold the size of all types. ">mi::Size</a> i = 0; i &lt; temporary_count; ++i) {</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IExpression&gt;</a> temporary( cm-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ICompiled__material.html#aa86384c36521f150f3bd5d7cbe1e2fcb" title="Returns the expression of a temporary. ">get_temporary</a>( i));</div>
<div class="line">        std::stringstream name;</div>
<div class="line">        name &lt;&lt; i;</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::IString&gt;</a> result(</div>
<div class="line">            expression_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#af61dee867b056fc0bdee1edc4707aa60" title="Returns a textual representation of an expression. ">dump</a>( temporary.get(), name.str().c_str(), 1));</div>
<div class="line">        s &lt;&lt; <span class="stringliteral">&quot;    temporary &quot;</span> &lt;&lt; result-&gt;get_c_str() &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IExpression&gt;</a> body( cm-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ICompiled__material.html#a3dd4bc11edb0ce29f2e70cfb4914ffe9" title="Returns the direct call expression that represents the body of the compiled material. ">get_body</a>());</div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::IString&gt;</a> result( expression_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#af61dee867b056fc0bdee1edc4707aa60" title="Returns a textual representation of an expression. ">dump</a>( body.get(), 0, 1));</div>
<div class="line">    s &lt;&lt; <span class="stringliteral">&quot;    body &quot;</span> &lt;&lt; result-&gt;get_c_str() &lt;&lt; std::endl;</div>
<div class="line"></div>
<div class="line">    s &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Creates an instance of the given material definition and stores it in the DB.</span></div>
<div class="line"><span class="keywordtype">void</span> create_material_instance(</div>
<div class="line">    <a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html" title="Factory for various MDL interfaces and functions. ">mi::neuraylib::IMdl_factory</a>* mdl_factory,</div>
<div class="line">    <a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html" title="A transaction provides a consistent view on the database. ">mi::neuraylib::ITransaction</a>* transaction,</div>
<div class="line">    <a class="code" href="classmi_1_1neuraylib_1_1IMdl__impexp__api.html" title="API component for MDL related import and export operations. ">mi::neuraylib::IMdl_impexp_api</a>* mdl_impexp_api,</div>
<div class="line">    <a class="code" href="classmi_1_1neuraylib_1_1IMdl__execution__context.html" title="The execution context can be used to query status information like error and warning messages concern...">mi::neuraylib::IMdl_execution_context</a>* context,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* material_name,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* instance_name)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// split module and material name</span></div>
<div class="line">    std::string module_name, material_simple_name;</div>
<div class="line">    <span class="keywordflow">if</span> (!mi::examples::mdl::parse_cmd_argument_material_name(</div>
<div class="line">        material_name, module_name, material_simple_name, <span class="keyword">true</span>))</div>
<div class="line">        exit_failure();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Load the module.</span></div>
<div class="line">    mdl_impexp_api-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__impexp__api.html#a5e195d80915190eb40c5995ccfeaa4c9" title="Loads an MDL module from disk (or a builtin module) into the database. ">load_module</a>(transaction, module_name.c_str(), context);</div>
<div class="line">    <span class="keywordflow">if</span> (!print_messages(context))</div>
<div class="line">        exit_failure(<span class="stringliteral">&quot;Loading module &#39;%s&#39; failed.&quot;</span>, module_name.c_str());</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Get the database name for the module we loaded</span></div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::IString&gt;</a> module_db_name(</div>
<div class="line">        mdl_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html#a72a27c9e0d66e79391ff9a8e3ce4a119" title="Returns the DB name for the MDL name of a module (or file path for MDLE modules). ...">get_db_module_name</a>(module_name.c_str()));</div>
<div class="line"></div>
<div class="line">    <span class="comment">// attach the material name</span></div>
<div class="line">    std::string material_db_name</div>
<div class="line">        = std::string(module_db_name-&gt;get_c_str()) + <span class="stringliteral">&quot;::&quot;</span> + material_simple_name;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Get the material definition from the database</span></div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IFunction_definition&gt;</a> material_definition(</div>
<div class="line">        transaction-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html#adafe2621ae719c43076b79a5677b4934" title="Retrieves an element from the database. ">access</a>&lt;<a class="code" href="classmi_1_1neuraylib_1_1IFunction__definition.html" title="This interface represents a function definition. ">mi::neuraylib::IFunction_definition</a>&gt;(material_db_name.c_str()));</div>
<div class="line">    <span class="keywordflow">if</span> (!material_definition)</div>
<div class="line">        exit_failure(<span class="stringliteral">&quot;Accessing definition &#39;%s&#39; failed.&quot;</span>, material_db_name.c_str());</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Create a material instance from the material definition with the default arguments.</span></div>
<div class="line">    <a class="code" href="group__mi__base__types.html#gafcdcb44319b0596ee8a9a44fddaec8c6" title="32-bit signed integer. ">mi::Sint32</a> result;</div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IFunction_call&gt;</a> material_instance(</div>
<div class="line">        material_definition-&gt;create_function_call(0, &amp;result));</div>
<div class="line">    <span class="keywordflow">if</span> (result != 0)</div>
<div class="line">        exit_failure(<span class="stringliteral">&quot;Instantiating &#39;%s&#39; failed.&quot;</span>, material_db_name.c_str());</div>
<div class="line"></div>
<div class="line">    transaction-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html#ae1c0cccf93ff990b7af8d0d0379f7c09" title="Stores the element db_element in the database under the name name and with the privacy level privacy...">store</a>(material_instance.get(), instance_name);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Compiles the given material instance in the given compilation modes, dumps the result, and stores</span></div>
<div class="line"><span class="comment">// it in the DB.</span></div>
<div class="line"><span class="keywordtype">void</span> compile_material_instance(</div>
<div class="line">    <a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html" title="A transaction provides a consistent view on the database. ">mi::neuraylib::ITransaction</a>* transaction,</div>
<div class="line">    <a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html" title="Factory for various MDL interfaces and functions. ">mi::neuraylib::IMdl_factory</a>* mdl_factory,</div>
<div class="line">    <a class="code" href="classmi_1_1neuraylib_1_1IMdl__execution__context.html" title="The execution context can be used to query status information like error and warning messages concern...">mi::neuraylib::IMdl_execution_context</a>* context,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* instance_name,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* compiled_material_name,</div>
<div class="line">    <span class="keywordtype">bool</span> class_compilation)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::IMaterial_instance&gt;</a> material_instance(</div>
<div class="line">       transaction-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html#adafe2621ae719c43076b79a5677b4934" title="Retrieves an element from the database. ">access</a>&lt;<a class="code" href="classmi_1_1neuraylib_1_1IMaterial__instance.html" title="This interface represents a material instance. ">mi::neuraylib::IMaterial_instance</a>&gt;( instance_name));</div>
<div class="line"></div>
<div class="line">    <a class="code" href="group__mi__base__types.html#ga607bb87332bf166dbd67cb30ca30da3a" title="32-bit unsigned integer. ">mi::Uint32</a> flags = class_compilation</div>
<div class="line">        ? <a class="code" href="classmi_1_1neuraylib_1_1IMaterial__instance.html#ab0b7608e59f1ad96b00a2fbb5cc2d959a7474d76ee055edda39a494edf06cfc36" title="Selects class compilation instead of instance compilation. ">mi::neuraylib::IMaterial_instance::CLASS_COMPILATION</a></div>
<div class="line">        : <a class="code" href="classmi_1_1neuraylib_1_1IMaterial__instance.html#ab0b7608e59f1ad96b00a2fbb5cc2d959afdcc06252ec8a89909ddd69006031766" title="Default compilation options (e.g., instance compilation). ">mi::neuraylib::IMaterial_instance::DEFAULT_OPTIONS</a>;</div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::ICompiled_material&gt;</a> compiled_material(</div>
<div class="line">        material_instance-&gt;create_compiled_material( flags, context));</div>
<div class="line">    check_success( print_messages( context));</div>
<div class="line"></div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Dumping compiled material (&quot;</span> &lt;&lt; ( class_compilation ? <span class="stringliteral">&quot;class&quot;</span> : <span class="stringliteral">&quot;instance&quot;</span>)</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot; compilation) for \&quot;&quot;</span> &lt;&lt; instance_name &lt;&lt; <span class="stringliteral">&quot;\&quot;:&quot;</span> &lt;&lt; std::endl &lt;&lt; std::endl;</div>
<div class="line">    dump_compiled_material( transaction, mdl_factory, compiled_material.get(), std::cout);</div>
<div class="line">    std::cout &lt;&lt; std::endl;</div>
<div class="line">    transaction-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html#ae1c0cccf93ff990b7af8d0d0379f7c09" title="Stores the element db_element in the database under the name name and with the privacy level privacy...">store</a>( compiled_material.get(), compiled_material_name);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Changes the tint parameter of the given material instance to green.</span></div>
<div class="line"><span class="keywordtype">void</span> change_arguments(</div>
<div class="line">    <a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html" title="A transaction provides a consistent view on the database. ">mi::neuraylib::ITransaction</a>* transaction,</div>
<div class="line">    <a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html" title="Factory for various MDL interfaces and functions. ">mi::neuraylib::IMdl_factory</a>* mdl_factory,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* instance_name)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html">mi::base::Handle&lt;mi::neuraylib::IValue_factory&gt;</a> value_factory(</div>
<div class="line">        mdl_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html#a76919730caa41d98004f3edcff45d1df" title="Returns an MDL value factory for the given transaction. ">create_value_factory</a>( transaction));</div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html">mi::base::Handle&lt;mi::neuraylib::IExpression_factory&gt;</a> expression_factory(</div>
<div class="line">        mdl_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html#aaa79f7a5d2d2973f7d34e007f22fc949" title="Returns an MDL expression factory for the given transaction. ">create_expression_factory</a>( transaction));</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Edit the instance of the material definition &quot;compilation_material&quot;.</span></div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IFunction_call&gt;</a> material_instance(</div>
<div class="line">        transaction-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html#a35971d023789574ee31dd05768fc7fe1" title="Retrieves an element from the database and returns it ready for editing. ">edit</a>&lt;<a class="code" href="classmi_1_1neuraylib_1_1IFunction__call.html" title="This interface represents a function call. ">mi::neuraylib::IFunction_call</a>&gt;( instance_name));</div>
<div class="line">    check_success( material_instance.is_valid_interface());</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Create the new argument for the &quot;tint&quot; parameter from scratch with the new value, and set it.</span></div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IValue&gt;</a> tint_value(</div>
<div class="line">        value_factory-&gt;create_color( 0.0f, 1.0f, 0.0f));</div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IExpression&gt;</a> tint_expr(</div>
<div class="line">        expression_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IExpression__factory.html#a774749a982e8b8e8910e01e11ec39d59" title="Creates a constant (mutable). ">create_constant</a>( tint_value.get()));</div>
<div class="line">    check_success( material_instance-&gt;set_argument( <span class="stringliteral">&quot;tint&quot;</span>, tint_expr.get()) == 0);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Generates LLVM IR target code for a subexpression of a given compiled material.</span></div>
<div class="line"><span class="keywordtype">void</span> generate_llvm_ir(</div>
<div class="line">    <a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html" title="A transaction provides a consistent view on the database. ">mi::neuraylib::ITransaction</a>* transaction,</div>
<div class="line">    <a class="code" href="classmi_1_1neuraylib_1_1IMdl__backend__api.html" title="This interface can be used to obtain the MDL backends. ">mi::neuraylib::IMdl_backend_api</a>* mdl_backend_api,</div>
<div class="line">    <a class="code" href="classmi_1_1neuraylib_1_1IMdl__execution__context.html" title="The execution context can be used to query status information like error and warning messages concern...">mi::neuraylib::IMdl_execution_context</a>* context,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* compiled_material_name,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* path,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* fname)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::ICompiled_material&gt;</a> compiled_material(</div>
<div class="line">        transaction-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html#adafe2621ae719c43076b79a5677b4934" title="Retrieves an element from the database. ">access</a>&lt;<a class="code" href="classmi_1_1neuraylib_1_1ICompiled__material.html" title="This interface represents a compiled material. ">mi::neuraylib::ICompiled_material</a>&gt;( compiled_material_name));</div>
<div class="line">    check_success(compiled_material.is_valid_interface());</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IMdl_backend&gt;</a> be_llvm_ir(</div>
<div class="line">        mdl_backend_api-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__backend__api.html#a74baca56433d61f89de6b68019b6beb5" title="Returns an MDL backend generator. ">get_backend</a>(<a class="code" href="classmi_1_1neuraylib_1_1IMdl__backend__api.html#a28a914c7c51dd45974b16fa189a77b46ac0fa27a2d4a3941cd1c103ee20e9c596" title="Generate LLVM IR (LLVM 7.0 compatible). ">mi::neuraylib::IMdl_backend_api::MB_LLVM_IR</a>));</div>
<div class="line">    check_success(be_llvm_ir.is_valid_interface());</div>
<div class="line"></div>
<div class="line">    check_success(be_llvm_ir-&gt;set_option( <span class="stringliteral">&quot;num_texture_spaces&quot;</span>, <span class="stringliteral">&quot;16&quot;</span>) == 0);</div>
<div class="line">    check_success(be_llvm_ir-&gt;set_option( <span class="stringliteral">&quot;enable_simd&quot;</span>, <span class="stringliteral">&quot;on&quot;</span>) == 0);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::ITarget_code&gt;</a> code_llvm_ir(</div>
<div class="line">        be_llvm_ir-&gt;translate_material_expression(</div>
<div class="line">            transaction, compiled_material.get(), path, fname, context));</div>
<div class="line">    check_success(print_messages( context));</div>
<div class="line">    check_success(code_llvm_ir);</div>
<div class="line"></div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Dumping LLVM IR code for \&quot;&quot;</span> &lt;&lt; path &lt;&lt; <span class="stringliteral">&quot;\&quot; of \&quot;&quot;</span> &lt;&lt; compiled_material_name</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;\&quot;:&quot;</span> &lt;&lt; std::endl &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; code_llvm_ir-&gt;get_code() &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Generates CUDA PTX target code for a subexpression of a given compiled material.</span></div>
<div class="line"><span class="keywordtype">void</span> generate_cuda_ptx(</div>
<div class="line">    <a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html" title="A transaction provides a consistent view on the database. ">mi::neuraylib::ITransaction</a>* transaction,</div>
<div class="line">    <a class="code" href="classmi_1_1neuraylib_1_1IMdl__backend__api.html" title="This interface can be used to obtain the MDL backends. ">mi::neuraylib::IMdl_backend_api</a>* mdl_backend_api,</div>
<div class="line">    <a class="code" href="classmi_1_1neuraylib_1_1IMdl__execution__context.html" title="The execution context can be used to query status information like error and warning messages concern...">mi::neuraylib::IMdl_execution_context</a>* context,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* compiled_material_name,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* path,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* fname)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::ICompiled_material&gt;</a> compiled_material(</div>
<div class="line">        transaction-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html#adafe2621ae719c43076b79a5677b4934" title="Retrieves an element from the database. ">access</a>&lt;<a class="code" href="classmi_1_1neuraylib_1_1ICompiled__material.html" title="This interface represents a compiled material. ">mi::neuraylib::ICompiled_material</a>&gt;( compiled_material_name));</div>
<div class="line">    check_success(compiled_material.is_valid_interface());</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IMdl_backend&gt;</a> be_cuda_ptx(</div>
<div class="line">        mdl_backend_api-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__backend__api.html#a74baca56433d61f89de6b68019b6beb5" title="Returns an MDL backend generator. ">get_backend</a>(<a class="code" href="classmi_1_1neuraylib_1_1IMdl__backend__api.html#a28a914c7c51dd45974b16fa189a77b46a9050e3f647dae4f4b39e207399ebf322" title="Generate CUDA PTX code. ">mi::neuraylib::IMdl_backend_api::MB_CUDA_PTX</a>));</div>
<div class="line">    check_success(be_cuda_ptx.is_valid_interface());</div>
<div class="line"></div>
<div class="line">    check_success(be_cuda_ptx-&gt;set_option( <span class="stringliteral">&quot;num_texture_spaces&quot;</span>, <span class="stringliteral">&quot;16&quot;</span>) == 0);</div>
<div class="line">    check_success(be_cuda_ptx-&gt;set_option( <span class="stringliteral">&quot;sm_version&quot;</span>, <span class="stringliteral">&quot;50&quot;</span>) == 0);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::ITarget_code&gt;</a> code_cuda_ptx(</div>
<div class="line">        be_cuda_ptx-&gt;translate_material_expression(</div>
<div class="line">            transaction, compiled_material.get(), path, fname, context));</div>
<div class="line">    check_success( print_messages( context));</div>
<div class="line">    check_success( code_cuda_ptx);</div>
<div class="line"></div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Dumping CUDA PTX code for \&quot;&quot;</span> &lt;&lt; path &lt;&lt; <span class="stringliteral">&quot;\&quot; of \&quot;&quot;</span> &lt;&lt; compiled_material_name</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;\&quot;:&quot;</span> &lt;&lt; std::endl &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; code_cuda_ptx-&gt;get_code() &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Generates HLSL target code for a subexpression of a given compiled material.</span></div>
<div class="line"><span class="keywordtype">void</span> generate_hlsl(</div>
<div class="line">    <a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html" title="A transaction provides a consistent view on the database. ">mi::neuraylib::ITransaction</a>* transaction,</div>
<div class="line">    <a class="code" href="classmi_1_1neuraylib_1_1IMdl__backend__api.html" title="This interface can be used to obtain the MDL backends. ">mi::neuraylib::IMdl_backend_api</a>* mdl_backend_api,</div>
<div class="line">    <a class="code" href="classmi_1_1neuraylib_1_1IMdl__execution__context.html" title="The execution context can be used to query status information like error and warning messages concern...">mi::neuraylib::IMdl_execution_context</a>* context,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* compiled_material_name,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* path,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* fname)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::ICompiled_material&gt;</a> compiled_material(</div>
<div class="line">        transaction-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html#adafe2621ae719c43076b79a5677b4934" title="Retrieves an element from the database. ">access</a>&lt;<a class="code" href="classmi_1_1neuraylib_1_1ICompiled__material.html" title="This interface represents a compiled material. ">mi::neuraylib::ICompiled_material</a>&gt;( compiled_material_name));</div>
<div class="line">    check_success(compiled_material.is_valid_interface());</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IMdl_backend&gt;</a> be_hlsl(</div>
<div class="line">        mdl_backend_api-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__backend__api.html#a74baca56433d61f89de6b68019b6beb5" title="Returns an MDL backend generator. ">get_backend</a>(<a class="code" href="classmi_1_1neuraylib_1_1IMdl__backend__api.html#a28a914c7c51dd45974b16fa189a77b46aeec9f553f75f861556a7249bf7b888e1" title="Generate HLSL code . ">mi::neuraylib::IMdl_backend_api::MB_HLSL</a>));</div>
<div class="line">    check_success(be_hlsl.is_valid_interface());</div>
<div class="line"></div>
<div class="line">    check_success(be_hlsl-&gt;set_option( <span class="stringliteral">&quot;num_texture_spaces&quot;</span>, <span class="stringliteral">&quot;1&quot;</span>) == 0);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::ITarget_code&gt;</a> code_hlsl(</div>
<div class="line">        be_hlsl-&gt;translate_material_expression(</div>
<div class="line">            transaction, compiled_material.get(), path, fname, context));</div>
<div class="line">    check_success(print_messages( context));</div>
<div class="line">    check_success(code_hlsl);</div>
<div class="line"></div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Dumping HLSL code for \&quot;&quot;</span> &lt;&lt; path &lt;&lt; <span class="stringliteral">&quot;\&quot; of \&quot;&quot;</span> &lt;&lt; compiled_material_name</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;\&quot;:&quot;</span> &lt;&lt; std::endl &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; code_hlsl-&gt;get_code() &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifndef MDL_SOURCE_RELEASE</span></div>
<div class="line"><span class="preprocessor"></span><span class="comment">// Generates GLSL target code for a subexpression of a given compiled material.</span></div>
<div class="line"><span class="keywordtype">void</span> generate_glsl(</div>
<div class="line">    <a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html" title="A transaction provides a consistent view on the database. ">mi::neuraylib::ITransaction</a>* transaction,</div>
<div class="line">    <a class="code" href="classmi_1_1neuraylib_1_1IMdl__backend__api.html" title="This interface can be used to obtain the MDL backends. ">mi::neuraylib::IMdl_backend_api</a>* mdl_backend_api,</div>
<div class="line">    <a class="code" href="classmi_1_1neuraylib_1_1IMdl__execution__context.html" title="The execution context can be used to query status information like error and warning messages concern...">mi::neuraylib::IMdl_execution_context</a>* context,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* compiled_material_name,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* path,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* fname)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::ICompiled_material&gt;</a> compiled_material(</div>
<div class="line">        transaction-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html#adafe2621ae719c43076b79a5677b4934" title="Retrieves an element from the database. ">access</a>&lt;<a class="code" href="classmi_1_1neuraylib_1_1ICompiled__material.html" title="This interface represents a compiled material. ">mi::neuraylib::ICompiled_material</a>&gt;( compiled_material_name));</div>
<div class="line">    check_success(compiled_material.is_valid_interface());</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IMdl_backend&gt;</a> be_glsl(</div>
<div class="line">        mdl_backend_api-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__backend__api.html#a74baca56433d61f89de6b68019b6beb5" title="Returns an MDL backend generator. ">get_backend</a>( <a class="code" href="classmi_1_1neuraylib_1_1IMdl__backend__api.html#a28a914c7c51dd45974b16fa189a77b46adc379cf50d7577910850602786ca2819" title="Generate GLSL code . ">mi::neuraylib::IMdl_backend_api::MB_GLSL</a>));</div>
<div class="line">    check_success(be_glsl.is_valid_interface());</div>
<div class="line"></div>
<div class="line">    check_success(be_glsl-&gt;set_option( <span class="stringliteral">&quot;glsl_version&quot;</span>, <span class="stringliteral">&quot;450&quot;</span>) == 0);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;const mi::neuraylib::ITarget_code&gt;</a> code_glsl(</div>
<div class="line">        be_glsl-&gt;translate_material_expression(</div>
<div class="line">            transaction, compiled_material.get(), path, fname, context));</div>
<div class="line">    check_success(print_messages( context));</div>
<div class="line">    check_success(code_glsl);</div>
<div class="line"></div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Dumping GLSL code for \&quot;&quot;</span> &lt;&lt; path &lt;&lt; <span class="stringliteral">&quot;\&quot; of \&quot;&quot;</span> &lt;&lt; compiled_material_name</div>
<div class="line">              &lt;&lt; <span class="stringliteral">&quot;\&quot;:&quot;</span> &lt;&lt; std::endl &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; code_glsl-&gt;get_code() &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="line"><span class="preprocessor">#endif // MDL_SOURCE_RELEASE</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="keywordtype">void</span> usage( <span class="keywordtype">char</span> <span class="keyword">const</span> *prog_name)</div>
<div class="line">{</div>
<div class="line">    std::cout</div>
<div class="line">        &lt;&lt; <span class="stringliteral">&quot;Usage: &quot;</span> &lt;&lt; prog_name &lt;&lt; <span class="stringliteral">&quot; [options] [&lt;material_name&gt;]\n&quot;</span></div>
<div class="line">        &lt;&lt; <span class="stringliteral">&quot;Options:\n&quot;</span></div>
<div class="line">        &lt;&lt; <span class="stringliteral">&quot;  --mdl_path &lt;path&gt;   mdl search path, can occur multiple times.\n&quot;</span></div>
<div class="line">        &lt;&lt; <span class="stringliteral">&quot;  --expr_path         expression path to compile, defaults to &quot;</span></div>
<div class="line">           <span class="stringliteral">&quot;\&quot;backface.scattering.tint\&quot;.&quot;</span></div>
<div class="line">        &lt;&lt; <span class="stringliteral">&quot;  &lt;material_name&gt;     qualified name of materials to use, defaults to\n&quot;</span></div>
<div class="line">        &lt;&lt; <span class="stringliteral">&quot;                      \&quot;::nvidia::sdk_examples::tutorials::example_compilation\&quot;\n&quot;</span></div>
<div class="line">        &lt;&lt; std::endl;</div>
<div class="line">    exit_failure();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> MAIN_UTF8(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Parse command line options</span></div>
<div class="line">    Options options;</div>
<div class="line">    mi::examples::mdl::Configure_options configure_options;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; argc; ++i) {</div>
<div class="line">        <span class="keywordtype">char</span> <span class="keyword">const</span> *opt = argv[i];</div>
<div class="line">        <span class="keywordflow">if</span> (opt[0] == <span class="charliteral">&#39;-&#39;</span>) {</div>
<div class="line">            <span class="keywordflow">if</span> (strcmp(opt, <span class="stringliteral">&quot;--mdl_path&quot;</span>) == 0 &amp;&amp; i &lt; argc - 1) {</div>
<div class="line">                configure_options.additional_mdl_paths.push_back(argv[++i]);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(opt, <span class="stringliteral">&quot;--expr_path&quot;</span>) == 0 &amp;&amp; i &lt; argc - 1) {</div>
<div class="line">                options.expr_path = argv[++i];</div>
<div class="line">                options.change_arguments = <span class="keyword">false</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> {</div>
<div class="line">                std::cout &lt;&lt; <span class="stringliteral">&quot;Unknown option: \&quot;&quot;</span> &lt;&lt; opt &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">                usage(argv[0]);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> {</div>
<div class="line">            options.material_name = opt;</div>
<div class="line">            options.change_arguments = <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Access the MDL SDK</span></div>
<div class="line">    <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::INeuray&gt;</a> neuray(mi::examples::mdl::load_and_get_ineuray());</div>
<div class="line">    <span class="keywordflow">if</span> (!neuray.is_valid_interface())</div>
<div class="line">        exit_failure(<span class="stringliteral">&quot;Failed to load the SDK.&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Configure the MDL SDK</span></div>
<div class="line">    <span class="keywordflow">if</span> (!mi::examples::mdl::configure(neuray.get(), configure_options))</div>
<div class="line">        exit_failure(<span class="stringliteral">&quot;Failed to initialize the SDK.&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Start the MDL SDK</span></div>
<div class="line">    <a class="code" href="group__mi__base__types.html#gafcdcb44319b0596ee8a9a44fddaec8c6" title="32-bit signed integer. ">mi::Sint32</a> ret = neuray-&gt;<a class="code" href="classmi_1_1neuraylib_1_1INeuray.html#afdd076cf54b3e1eabbd841bd1f77847b" title="Starts the operation of the MDL SDK library. ">start</a>();</div>
<div class="line">    <span class="keywordflow">if</span> (ret != 0)</div>
<div class="line">        exit_failure(<span class="stringliteral">&quot;Failed to initialize the SDK. Result code: %d&quot;</span>, ret);</div>
<div class="line"></div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html">mi::base::Handle&lt;mi::neuraylib::IMdl_factory&gt;</a> mdl_factory(</div>
<div class="line">            neuray-&gt;<a class="code" href="classmi_1_1neuraylib_1_1INeuray.html#a4e107568bbb0e64f61fb4b59b93607fa" title="Returns an API component from the MDL SDK API. ">get_api_component</a>&lt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html" title="Factory for various MDL interfaces and functions. ">mi::neuraylib::IMdl_factory</a>&gt;());</div>
<div class="line"></div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IDatabase&gt;</a> database(</div>
<div class="line">            neuray-&gt;<a class="code" href="classmi_1_1neuraylib_1_1INeuray.html#a4e107568bbb0e64f61fb4b59b93607fa" title="Returns an API component from the MDL SDK API. ">get_api_component</a>&lt;<a class="code" href="classmi_1_1neuraylib_1_1IDatabase.html" title="This interface is used to interact with the distributed database. ">mi::neuraylib::IDatabase</a>&gt;());</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IScope&gt;</a> scope(database-&gt;get_global_scope());</div>
<div class="line">        <a class="code" href="classmi_1_1base_1_1Handle.html">mi::base::Handle&lt;mi::neuraylib::ITransaction&gt;</a> transaction(scope-&gt;create_transaction());</div>
<div class="line"></div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// Create an execution context for options and error message handling</span></div>
<div class="line">            <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IMdl_execution_context&gt;</a> context(</div>
<div class="line">                mdl_factory-&gt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__factory.html#a78a9a6489592c90ea49e0fe0ac8be235" title="Creates an execution context. ">create_execution_context</a>());</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Create MDL import-export API for importing MDL modules</span></div>
<div class="line">            <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IMdl_impexp_api&gt;</a> mdl_impexp_api(</div>
<div class="line">                neuray-&gt;<a class="code" href="classmi_1_1neuraylib_1_1INeuray.html#a4e107568bbb0e64f61fb4b59b93607fa" title="Returns an API component from the MDL SDK API. ">get_api_component</a>&lt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__impexp__api.html" title="API component for MDL related import and export operations. ">mi::neuraylib::IMdl_impexp_api</a>&gt;());</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Load the &quot;example&quot; module and create a material instance</span></div>
<div class="line">            std::string instance_name = <span class="stringliteral">&quot;instance of compilation_material&quot;</span>;</div>
<div class="line">            create_material_instance(</div>
<div class="line">                mdl_factory.get(),</div>
<div class="line">                transaction.get(),</div>
<div class="line">                mdl_impexp_api.get(),</div>
<div class="line">                context.get(),</div>
<div class="line">                options.material_name.c_str(),</div>
<div class="line">                instance_name.c_str());</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Compile the material instance in instance compilation mode</span></div>
<div class="line">            std::string instance_compilation_name</div>
<div class="line">                = std::string(<span class="stringliteral">&quot;instance compilation of &quot;</span>) + instance_name;</div>
<div class="line">            compile_material_instance(</div>
<div class="line">                transaction.get(), mdl_factory.get(), context.get(), instance_name.c_str(),</div>
<div class="line">                instance_compilation_name.c_str(), <span class="keyword">false</span>);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Compile the material instance in class compilation mode</span></div>
<div class="line">            std::string class_compilation_name</div>
<div class="line">                = std::string(<span class="stringliteral">&quot;class compilation of &quot;</span>) + instance_name;</div>
<div class="line">            compile_material_instance(</div>
<div class="line">                transaction.get(), mdl_factory.get(), context.get(), instance_name.c_str(),</div>
<div class="line">                class_compilation_name.c_str(), <span class="keyword">true</span>);</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Change some material argument and compile again in both modes. Note the differences</span></div>
<div class="line">            <span class="comment">// in instance compilation mode, whereas only the referenced parameter itself changes in</span></div>
<div class="line">            <span class="comment">// class compilation mode.</span></div>
<div class="line">            <span class="keywordflow">if</span> (options.change_arguments) {</div>
<div class="line">                change_arguments(transaction.get(), mdl_factory.get(), instance_name.c_str());</div>
<div class="line">                compile_material_instance(</div>
<div class="line">                    transaction.get(), mdl_factory.get(), context.get(), instance_name.c_str(),</div>
<div class="line">                    instance_compilation_name.c_str(), <span class="keyword">false</span>);</div>
<div class="line">                compile_material_instance(</div>
<div class="line">                    transaction.get(), mdl_factory.get(), context.get(), instance_name.c_str(),</div>
<div class="line">                    class_compilation_name.c_str(), <span class="keyword">true</span>);</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Use the various backends to generate target code for some material expression.</span></div>
<div class="line"></div>
<div class="line">            <a class="code" href="classmi_1_1base_1_1Handle.html" title="Handle class template for interfaces, automatizing the lifetime control via reference counting...">mi::base::Handle&lt;mi::neuraylib::IMdl_backend_api&gt;</a> mdl_backend_api(</div>
<div class="line">                neuray-&gt;<a class="code" href="classmi_1_1neuraylib_1_1INeuray.html#a4e107568bbb0e64f61fb4b59b93607fa" title="Returns an API component from the MDL SDK API. ">get_api_component</a>&lt;<a class="code" href="classmi_1_1neuraylib_1_1IMdl__backend__api.html" title="This interface can be used to obtain the MDL backends. ">mi::neuraylib::IMdl_backend_api</a>&gt;());</div>
<div class="line"></div>
<div class="line">            generate_llvm_ir(</div>
<div class="line">                transaction.get(), mdl_backend_api.get(), context.get(),</div>
<div class="line">                instance_compilation_name.c_str(),</div>
<div class="line">                options.expr_path.c_str(), <span class="stringliteral">&quot;tint&quot;</span>);</div>
<div class="line">            generate_llvm_ir(</div>
<div class="line">                transaction.get(), mdl_backend_api.get(), context.get(),</div>
<div class="line">                class_compilation_name.c_str(),</div>
<div class="line">                options.expr_path.c_str(), <span class="stringliteral">&quot;tint&quot;</span>);</div>
<div class="line">            generate_cuda_ptx(</div>
<div class="line">                transaction.get(), mdl_backend_api.get(), context.get(),</div>
<div class="line">                instance_compilation_name.c_str(),</div>
<div class="line">                options.expr_path.c_str(), <span class="stringliteral">&quot;tint&quot;</span>);</div>
<div class="line">            generate_cuda_ptx(</div>
<div class="line">                transaction.get(), mdl_backend_api.get(), context.get(),</div>
<div class="line">                class_compilation_name.c_str(),</div>
<div class="line">                options.expr_path.c_str(), <span class="stringliteral">&quot;tint&quot;</span>);</div>
<div class="line"><span class="preprocessor">#ifndef MDL_SOURCE_RELEASE</span></div>
<div class="line"><span class="preprocessor"></span>            generate_glsl(</div>
<div class="line">                transaction.get(), mdl_backend_api.get(), context.get(),</div>
<div class="line">                instance_compilation_name.c_str(),</div>
<div class="line">                options.expr_path.c_str(), <span class="stringliteral">&quot;tint&quot;</span>);</div>
<div class="line">            generate_glsl(</div>
<div class="line">                transaction.get(), mdl_backend_api.get(), context.get(),</div>
<div class="line">                class_compilation_name.c_str(),</div>
<div class="line">                options.expr_path.c_str(), <span class="stringliteral">&quot;tint&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/*MDL_SOURCE_RELEASE*/</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span>            generate_hlsl(</div>
<div class="line">                transaction.get(), mdl_backend_api.get(), context.get(),</div>
<div class="line">                instance_compilation_name.c_str(),</div>
<div class="line">                options.expr_path.c_str(), <span class="stringliteral">&quot;tint&quot;</span>);</div>
<div class="line">            generate_hlsl(</div>
<div class="line">                transaction.get(), mdl_backend_api.get(), context.get(),</div>
<div class="line">                class_compilation_name.c_str(),</div>
<div class="line">                options.expr_path.c_str(), <span class="stringliteral">&quot;tint&quot;</span>);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        transaction-&gt;<a class="code" href="classmi_1_1neuraylib_1_1ITransaction.html#aa4ff8152107db238986b364273bceb0c" title="Commits the transaction. ">commit</a>();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Shut down the MDL SDK</span></div>
<div class="line">    <span class="keywordflow">if</span> (neuray-&gt;<a class="code" href="classmi_1_1neuraylib_1_1INeuray.html#a01d0574d048798c76f8e29f91a4f6fea" title="Shuts down the library. ">shutdown</a>() != 0)</div>
<div class="line">        exit_failure(<span class="stringliteral">&quot;Failed to shutdown the SDK.&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Unload the MDL SDK</span></div>
<div class="line">    neuray = <span class="keyword">nullptr</span>;</div>
<div class="line">    <span class="keywordflow">if</span> (!mi::examples::mdl::unload())</div>
<div class="line">        exit_failure(<span class="stringliteral">&quot;Failed to unload the SDK.&quot;</span>);</div>
<div class="line"></div>
<div class="line">    exit_success();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Convert command line arguments to UTF8 on Windows</span></div>
<div class="line">COMMANDLINE_TO_UTF8</div>
</div><!-- fragment --><div align="right"> [<a class="el" href="mi_neuray_example_calls.html">Previous</a>] [<a class="el" href="mi_neuray_examples.html">Up</a>] [<a class="el" href="mi_neuray_example_code_gen.html">Next</a>] </div> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.4-->
<!-- start footer part -->
<div id="nav-path">
<span class="footeritem">5&#160;April&#160;2022,&#160;20:40, rev.358266</span>
<span class="footeritem"><a href="https://www.nvidia.com/en-us/about-nvidia/legal-info/" target="_blank" shape="rect">&copy; 2022 NVIDIA&nbsp;Corporation.</a> All rights reserved.</span>
</div>
</body>
</html>
